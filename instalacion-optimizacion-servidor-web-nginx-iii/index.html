<!DOCTYPE html><html amp lang="es" class="no-js"><head><title>Instalación y optimización de un servidor web con Nginx (III)</title><meta charset="utf-8"><script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async src="https://cdn.ampproject.org/v0.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script><link rel="canonical" href="https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/"><link rel="icon" href="/favicon.png" type="image/png" sizes="144x144"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1"><meta name="theme-color" content="#002f4c"><meta name="description" content="A lo largo de esta guía se pretende mostrar cómo instalar desde  cero un servidor web con Nginx, realizando las operaciones necesarias para lograr  el mayor rendimiento y seguridad posibles con programas tales como php-fpm, APC,  y el módulo pagespeed de Google para optimizar los recursos web."><meta name="keywords" content=" nginx, "><meta name="google-site-verification" content="FBg0GK1_H_PyCw6AD2iaBOclPbEC3LOV8hHXje5276w"><link rel="author" href="https://plus.google.com/+ElBauldelProgramador?rel=author"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@elbaulp"><meta name="twitter:creator" content="@elbaulp"><meta name="twitter:title" content="Instalación y optimización de un servidor web con Nginx (III)"><meta name="twitter:description" content="A lo largo de esta guía se pretende mostrar cómo instalar desde  cero un servidor web con Nginx, realizando las operaciones necesarias para lograr  el mayor rendimiento y seguridad posibles con programas tales como php-fpm, APC,  y el módulo pagespeed de Google para optimizar los recursos web."><meta property="twitter:image:src" content="https://elbauldelprogramador.com/img/Instalación-y-optimización-de-un-servidor-web-con-Nginx1.png"><meta property="og:locale" content="es-ES"><meta property="og:type" content="article"><meta property="og:site_name" content="Instalación y optimización de un servidor web con Nginx (III)"><meta property="og:url" content="https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/"><meta property="og:title" content="Instalación y optimización de un servidor web con Nginx (III)"><meta property="og:image" content="https://elbauldelprogramador.com/img/Instalación-y-optimización-de-un-servidor-web-con-Nginx1.png"><meta property="og:description" content="A lo largo de esta guía se pretende mostrar cómo instalar desde  cero un servidor web con Nginx, realizando las operaciones necesarias para lograr  el mayor rendimiento y seguridad posibles con programas tales como php-fpm, APC,  y el módulo pagespeed de Google para optimizar los recursos web."><meta property="og:site_name" content="Instalación y optimización de un servidor web con Nginx (III)"><meta property="fb:pages" content="139660486080346"><meta property="article:publisher" content="http://facebook.com/elbaulp"><meta property="article:author" content="http://facebook.com/elbaulp"><meta property="article:published_time" content="2016-01-01T00:00:00"><link rel="next" href="https://elbauldelprogramador.com/instalar-atom-el-editor-de-github-en-linux/" title="Instalar Atom, el editor de GitHub en Linux"><link rel="prev" href="https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii/" title="Instalación y optimización de un servidor web con Nginx (II)"><link rel="shortcut icon" href="https://elbauldelprogramador.com/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="https://elbauldelprogramador.com/favicon.png" type="image/x-icon"><link href="https://elbauldelprogramador.com/index.xml" rel="alternate" type="application/rss+xml" title="El Baúl del programador | Feed Principal"><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "WebSite", "name": "El Baúl del programador", "alternateName": "El Baúl", "url": "https://elbauldelprogramador.com" }</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Blog", "name": "El Baúl del programador", "audience": { "@type": "Audience", "audienceType": "Developers, informáticos, programadores" }, "author": { "@type": "Person", "name": "Alejandro Alcalde", "url" : "https://elbauldelprogramador.com", "sameAs" : [ "https://www.facebook.com/elbaulp", "https://www.twitter.com/elbaulp", "https://www.linkedin.com/in/algui91", "https://plus.google.com/+elbauldelprogramador", "http://stackoverflow.com/users/1612432/elbaulp" ] }, "creator": { "@type": "Person", "name": "Alejandro Alcalde", "url" : "https://elbauldelprogramador.com", "sameAs" : [ "https://www.facebook.com/elbaulp", "https://www.twitter.com/elbaulp", "https://www.linkedin.com/in/algui91", "https://plus.google.com/+elbauldelprogramador", "http://stackoverflow.com/users/1612432/elbaulp" ] } }</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Organization", "name": "El Baúl del Programador", "url": "https://elbauldelprogramador.com", "sameAs": ["http://www.facebook.com/elbaulp", "http://plus.google.com/+elbauldelprogramador", "https://twitter.com/elbaulp", "https://telegram.me/elbaulp"] }</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "BreadcrumbList", "itemListElement": [{ "@type": "ListItem", "position": 1, "item": { "@id": "https://elbauldelprogramador.com", "name": "home" } },{ "@type": "ListItem", "position": 3, "item": { "@id": "https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/", "name": "instalacion-optimizacion-servidor-web-nginx-iii" } }] }</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Article", "author": { "name" : "Alejandro Alcalde" }, "headline": "Instalación y optimización de un servidor web con Nginx (III)", "description": "A lo largo de esta guía se pretende mostrar cómo instalar desde cero un servidor web con Nginx, realizando las operaciones necesarias para lograr el mayor rendimiento y seguridad posibles con programas tales como php-fpm, APC, y el módulo pagespeed de Google para optimizar los recursos web.", "wordCount": 3292, "datePublished" : "2016-01-01T00:00:00", "dateModified" : "2017-10-05T12:23:49", "articleBody": "Tabla de contenidos Instalación y optimización de un servidor web con Nginx (I) Instalación y optimización de un servidor web con Nginx (II) Instalación y optimización de un servidor web con Nginx (III) En éste último artículo se verá cómo realizar optimizaciones al servidor web nginx, PHP y se cubrirá la instalación del sistema de caches APC y el módulo Page Speed de Google.\n\nOptimizando Pools en PHP La configuración por defecto de PHP no suele ser la óptima, dependiendo de nuestras necesidades y hardware deberemos ajustar algunos parámetros. En esta sección nos centraremos en el número de procesos y recursos que se dedicarán a una aplicación web. Estos parámetros se encuentran en el directorio /etc/php/fpm/pools.d, se debe tener una archivo por cada aplicación, en nuestro caso será www.conf. Los parámetros a ajustar son:\n pm: Decide cómo el controlador de procesos administra los procesos hijos, es recomendable establecerlo a dinámico. pm.max_children: Cuando pm es estático, el número de hijos a crear, cuando es dinámico, el máximo número de hijos que se podrán tener. pm.start_servers: Número de hijos a crear al inicio. pm.min_spare_servers: El número mínimo de procesos libres (Sin hacer nada). pm.max_spare_servers: Número máximo de procesos libres. pm.max_requests: El número de peticiones que cada hijo aceptará antes de reiniciarse, útil para evitar pérdidas de memoria.\nHay varias aproximaciones para determinar el valor adecuado de estos parámetros, en esta guía se verán 3, y todas con pm = dynamic.\nPrimer método El primero (Guillaume Moigneu) consiste en calcular pm.max_children basándonos en la fórmula:\n\\[pm.max\\_children = (RAM_{total} - RAM_{resto Proc})/ RAM_{mediaPHP}\\]\nDonde \\(RAM_{restoProc}\\) es la memoria usada por los otros procesos y \\(RAM_{mediaPHP}\\) es la media de memoria usada por los procesos de PHP. La memoria consumida por el resto de procesos se puede calcular mediante este comando:\nps -ylA --sort:rss | grep -v php5-fpm | awk \u0026#39;!/RSS/ { s+=$8 } END { printf \u0026#34;%s\\n\u0026#34;, \u0026#34;Memoria total usada por otros procesos\u0026#34;; printf \u0026#34;%dM\\n\u0026#34;, s/1024 }\u0026#39; Y la consumida por PHP:\nps -ylC php5-fpm --sort:rss | awk \u0026#39;!/RSS/ { s+=$8 } END { printf \u0026#34;%s\\n\u0026#34;, \u0026#34;Memoria consumida por PHP: \u0026#34;; printf \u0026#34;%dM\\n\u0026#34;, s/1024 }\u0026#39; Al número anterior lo dividimos por los procesos de PHP y obtenemos la media. Una vez calculado el valor de max_children, min_spare_servers y max_spare_servers se suelen calcular evaluando el rendimiento y start_servers, suele ser:\n\\[start\\_servers = \\frac{min\\_spare\\_servers + (max\\_spare\\_servers - min\\_spare\\_servers)}{2}\\]\nSegundo método El segundo método (myshell.co.uk) es calcularlo en base a:\n\\[pm.max\\_children = RAM_{total} / RAM_{maxPHP}\\]\nDonde \\(RAM_{maxPHP}\\) es el process PHP que ocupe más memoria. El resto de parámetros se calculan en base a éste.\nTercer método Por último, otro método (Perusio) es realizando la operación siguiente:\n\\[pm.max\\_children = 1.2 \\cdot RAM_{total}/RAM_{mediaPHP}\\]\nOptimizando Nginx FastCGI es un protocolo que hace de interfaz entre programas y servidores web. En esta sección veremos cómo configurar nginx para cachear páginas y aumentar su rendimiento.\nPara aprovechar todos los núcleos de un procesador, nginx necesita ajustar el parámetro worker_processes acorde al número de procesadores. Para determinar el número de procesadores podemos ejecutar el siguiente comando:\ncat /proc/cpuinfo| grep processor | wc -l En la directiva worker_connections dentro del bloque events escribiremos un 1024. Con esto nginx tendrá un proceso por núcleo y cada proceso podrá procesar hasta 1024 conexiones.\nEstableceremos ahora los parámetros que permitirán cachear los resultados para servirlos más rápido al cliente, para ello haremos uso de las directivas fastcgi_cache. En el bloque http necesitaremos:\nfastcgi_cache_path /var/cache/nginx levels=1:2 keys_zone=microcache:500m max_size=1000m inactive=60m; fastcgi_cache_key \u0026#34;$scheme$request_method$host$request_uri\u0026#34;; fastcgi_cache_use_stale updating error timeout invalid_header http_500; Lo cual establece el directorio donde se guardarán los objetos cacheados, los niveles de cache, un nombre y el espacio reservado (500Mb), así como un tope máximo (1Gb). La segunda directiva establece bajo qué nombre se almacenará la clave para la cache. Por último la tercera servirá contenido antiguo en la caché cuando haya errores en el servidor web, cuando se esté actualizando la caché, cuando haya errores del tipo 5xx o cuando la cabecera de la petición sea inválida.\nEl siguiente paso es decidir qué objetos se almacenarán en caché y cuales no. Para ello, dentro de un bloque server escribiremos:\nset $no_cache 0; if ($request_method = POST) { set $no_cache 1; } if ($query_string != \u0026#34;\u0026#34;) { set $no_cache 1; } location ~ \\.php$ { # .... fastcgi_cache_bypass $no_cache; fastcgi_no_cache $no_cache; fastcgi_cache microcache; fastcgi_cache_valid 60m; } En esta porción de código hemos declarado una variable que determinará qué peticiones se cachean y cuales no. No cachearemos ninguna petición POST ni nada que tenga consultas en la URL (?arg\u0026#8230;\u0026arg1;\u0026#8230;). Con ayuda de esta variable podremos decidir en el bloque location si cacheamos la petición (directivas bypass y no_cache), aquí hacemos referencia al nombre que dimos anteriormente al espacio de caché y fijamos un periodo de validez.\nPage Speed En esta sección veremos cómo compilar y configurar el módulo desarrollado por Google que optimizará al máximo todos los recursos de nuestra web, minimizando considerablemente el tiempo de respuesta y aplicando algunos cambios a los archivos para que cumplan con los estándares de rendimiento que Google usa para puntuar las páginas web.\nAlgunas de las características que ofrece son comprimir los archivos CSS y JavaScript de forma que ocupen lo menos posible. Unificar (cuando sea posible) la mayor cantidad de archivos CSS y JS en uno solo para reducir el número de peticiones al servidor. Optimizar las imágenes para reducir su tamaño. Cargar de forma asíncrona los programas JS. Mover los elementos bloqueantes que impiden que la página se renderize correctamente a lugares donde no sean perjudiciales para el renderizado. Éstas son solo algunas de las funcionalidades principales.\nPreparando el entorno Antes de poder compilar, será necesario instalar algunas dependencias:\napt-get install build-essential zlib1g-dev libpcre3 libpcre3-dev Una vez hecho, estamos en condiciones para descargar y compilar:\ncd ~ wget https://github.com/pagespeed/ngx_pagespeed/archive/v1.7.30.1-beta.zip unzip v1.7.30.1-beta.zip # or unzip v1.7.30.1-beta cd ngx_pagespeed-1.7.30.1-beta/ wget https://dl.google.com/dl/page-speed/psol/1.7.30.1.tar.gz tar -xzvf 1.7.30.1.tar.gz Hecho esto, será necesario recompilar nginx con este módulo, como comentamos al inicio de esta guía, para ello simplemente ejecutamos:\nnginx -V # Para ver con qué módulos está compilado el ejecutable actual configure arguments: --with-http_gzip_static_module --sbin-path=/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module cd ~/nginx-1.4.4/ # compilaremos nginx con el nuevo módulo (--ad-module) ./configure --with-http_gzip_static_module --sbin-path=/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module --add-module=$HOME/ngx_pagespeed-1.7.30.1-beta make -j 4 # compilamos service nginx destroy # detenemos la instancia actual de nginx make install # instalamos la nueva versión con pagespeed Configurando PageSpeed Solo resta configurar nginx para activar pagespeed con los filtros deseados. La documentación se puede encontrar en Configuring PageSpeed Filters. Por defecto los filtros habilitados son:\nadd_head combine_css combine_javascript convert_meta_tags extend_cache fallback_rewrite_css_urls flatten_css_imports inline_css inline_import_to_link inline_javascript rewrite_css rewrite_images rewrite_javascript rewrite_style_attributes_with_url Veamos cómo habilitar pagespeed en nginx, para ello crearemos un fichero y un directorio en /usr/local/nginx/conf/global/pagespeed.conf conteniendo:\npagespeed on; # Needs to exist and be writable by nginx. pagespeed FileCachePath /var/ngx_pagespeed_cache; # Ensure requests for pagespeed optimized resources go to the pagespeed handler # and no extraneous headers get set. location ~ \u0026#34;\\.pagespeed\\.([a-z]\\.)?[a-z]{2}\\.[^.]{10}\\.[^.]+\u0026#34; { add_header \u0026#34;\u0026#34; \u0026#34;\u0026#34;; } location ~ \u0026#34;^/ngx_pagespeed_static/\u0026#34; { } location ~ \u0026#34;^/ngx_pagespeed_beacon$\u0026#34; { } # This page shows statistics about the ngx_pagespeed module. location /ngx_pagespeed_statistics { allow 127.0.0.1; allow TuIP; deny all; } # Recent log messages. Like statistics, these are generally not to be shown # to the public, so this has access controls as well. pagespeed MessageBufferSize 100000; location /ngx_pagespeed_message { allow 127.0.0.1; # allow TuIP; deny all; } # This page lets you view a graphical console displaying statistics about # the ngx_pagespeed module. As with statistics and messages, you may # want access control. pagespeed Statistics on; pagespeed StatisticsLogging on; pagespeed LogDir /var/log/pagespeed; pagespeed StatisticsLoggingIntervalMs 60000; pagespeed StatisticsLoggingMaxFileSizeKb 1024; location /pagespeed_console { allow 127.0.0.1; # allow TuIP; deny all; } # Honoring no-transform Cache-Control Headers pagespeed DisableRewriteOnNoTransform off; pagespeed RewriteLevel CoreFilters; # Specifying the value for the PageSpeed header pagespeed XHeaderValue \u0026#34;Gracias a ngx_pagespeed\u0026#34;; Esto debería ser suficiente para la mayoría de webs, es posible habilitar más filtros usando la directiva pagespeed EnableFilters.\nPor último hay que añadir la configuración a nginx, dentro del bloque server que deseemos incluimos la línea include global/pagespeed.conf; y recargamos la configuración de nginx:\nservice nginx reload Podemos comprobar que todo funciona correctamente ojeando las cabeceras de la respuesta del servidor como se muestra en la figura:\n Como vemos, la cabecera de pagespeed está presente, luego está habilitado.\nAPC APC viene de Alternative PHP Cache y es un opcode libre y gratuito para PHP. Su objetivo es proporcionar un marco robusto, libre y abierto para optimizar código intermedio de PHP mediante su almacenamiento en caché.\nInstalando y configurando APC Para instalarlo basta con ejecutar:\napt-get install php-apc El archivo de configuración reside en /etc/php5/fpm/conf.d/apc.ini, un ejemplo de configuración es el siguiente:\napc.enabled=1 apc.shm_segments=1 apc.shm_size=128M ;Relative to the number of cached files (you may need to watch your stats for a day or two to find out a good number) apc.num_files_hint=768 ;Relative to the size of your site apc.user_entries_hint=4096 ;The number of seconds a cache entry is allowed to idle in a slot before APC dumps the cache apc.ttl=7200 apc.user_ttl=7200 apc.gc_ttl=3600 ;Setting this to 0 will give you the best performance, as APC will ;not have to check the IO for changes. However, you must clear ;the APC cache to recompile already cached files. If you are still ;developing, updating your site daily in WP-ADMIN, and running W3TC ;set this to 1 apc.stat=0 ;;This MUST be 0, WP can have errors otherwise! apc.include_once_override=0 ;Only set to 1 while debugging apc.enable_cli=0 ;Allow 2 seconds after a file is created before it is cached to prevent users from seeing half-written/weird pages apc.file_update_protection=2 ;Leave at 2M or lower. WordPress doest have any file sizes close to 2M apc.max_file_size=1M apc.cache_by_default=1 apc.use_request_time=1 apc.slam_defense=0 apc.mmap_file_mask=/tmp/apc.XXXXXX apc.stat_ctime=0 apc.canonicalize=1 apc.write_lock=1 apc.report_autofilter=0 apc.rfc1867=0 apc.rfc1867_prefix =upload_ apc.rfc1867_name=APC_UPLOAD_PROGRESS apc.rfc1867_freq=0 apc.rfc1867_ttl=3600 apc.lazy_classes=0 apc.lazy_functions=0 apc.localcache = \u0026#34;1\u0026#34; ;The size of the local process shadow-cache, should be set to a sufficiently large value, approximately half of apc.num_files_hint. apc.localcache.size = \u0026#34;384\u0026#34; APC proporciona una mejora considerable en cuanto al rendimiento, ya que no es necesario volver a interpretar el código PHP cada vez que el servidor recibe una petición, el código quedará compilado en cache listo para ser servido. Uno de los parámetros más importantes es apc.shm_size=, el cual establece el tamaño reservado para la caché.\nConsideraciones sobre seguridad Algunos valores por defecto de la configuración de nginx no son adecuados en términos de seguridad, basándonos en las recomendaciones de NIX Craft podemos ajustar éstos parámetros según nuestras necesidades para obtener una mayor seguridad frente a ataques. Todos estos parámetros irán en el bloque http de nginx.\n## Start: Size Limits \u0026amp; Buffer Overflows ## client_body_buffer_size 8K; client_header_buffer_size 1k; client_max_body_size 1m; large_client_header_buffers 2 1k; ## END: Size Limits \u0026amp; Buffer Overflows ## ## Start: Timeouts ## client_body_timeout 10; client_header_timeout 10; keepalive_timeout 5 5; send_timeout 10; ## End: Timeouts ## ### Directive describes the zone, in which the session states are stored i.e. store in slimits. ### ### 1m can handle 32000 sessions with 32 bytes/session, set to 5m x 32000 session ### limit_conn_zone $binary_remote_addr zone=addr:5m; ### Control maximum number of simultaneous connections for one session i.e. ### ### restricts the amount of connections from a single ip address ### limit_conn addr 10; Una breve explicación del propósito de cada directiva:\n client_body_buffer_size: El tamaño máximo del buffer de petición del cliente. client_header_buffer_size: Normalmente el tamaño de las cabeceras de la mayoría de peticiones son inferiores a 1k, si hay problemas deberemos subir el valor. client_max_body_size: Si vamos a aceptar que se suban archivos a nuestra web, este valor debería ser dado en Megas, de lo contrario podremos establecer un valor bajo, como 1k. large_client_header_buffers: Número máximo y tamaño de los buffers para peticiones que tengan cabeceras de mayor tamaño enviadas por el cliente. Útil para combatir bad bots y ataques DoS. client_body_timeout: Establece el tiempo de espera para leer el cuerpo de la petición del cliente. Si tras pasar el tiempo el cliente no envía nada, nginx devolverá un error 408 (Request timeout). client_header_timeout: Similar al anterior pero para la cabecera. keepalive_timeout: El primer parámetro asigna el tiempo de espera para mantener la conexión activa con el cliente, el servidor cerrará la conxión tras pasar éste tiempo. El segundo parámetro establece el valor de la cabecera Keep-Alive:timeout=time en la respuesta del servidor, esta cabecera puede hacer que algunos navegadore cierren la conexión para que no sea el servidor el que tenga que hacerlo. send_timeout: Asigna el tiempo de espera al cliente. limit_conn_zone: Controla el número de conexiones simultaneas de un mismo cliente. Con esto concluyen los tres artículos sobre instalación y optimización de un servidor web con nginx, espero que haya resultado útil.\nTabla de contenidos Instalación y optimización de un servidor web con Nginx (I) Instalación y optimización de un servidor web con Nginx (II) Instalación y optimización de un servidor web con Nginx (III) ", "image": { "@type": "ImageObject", "url": "https://elbauldelprogramador.com/img/Instalación-y-optimización-de-un-servidor-web-con-Nginx1.png", "width": 800, "height": 420 }, "mainEntityOfPage" : "https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/", "publisher" : { "@type": "Organization", "name" : "Alejandro Alcalde", "logo" : { "@type" : "ImageObject", "url" : "http://elbauldelprogramador.com/img/logo.png", "height" : 60, "width" : 600 } } }</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "BlogPosting", "articleBody": "Tabla de contenidos Instalación y optimización de un servidor web con Nginx (I) Instalación y optimización de un servidor web con Nginx (II) Instalación y optimización de un servidor web con Nginx (III) En éste último artículo se verá cómo realizar optimizaciones al servidor web nginx, PHP y se cubrirá la instalación del sistema de caches APC y el módulo Page Speed de Google.\n\nOptimizando Pools en PHP La configuración por defecto de PHP no suele ser la óptima, dependiendo de nuestras necesidades y hardware deberemos ajustar algunos parámetros. En esta sección nos centraremos en el número de procesos y recursos que se dedicarán a una aplicación web. Estos parámetros se encuentran en el directorio /etc/php/fpm/pools.d, se debe tener una archivo por cada aplicación, en nuestro caso será www.conf. Los parámetros a ajustar son:\n pm: Decide cómo el controlador de procesos administra los procesos hijos, es recomendable establecerlo a dinámico. pm.max_children: Cuando pm es estático, el número de hijos a crear, cuando es dinámico, el máximo número de hijos que se podrán tener. pm.start_servers: Número de hijos a crear al inicio. pm.min_spare_servers: El número mínimo de procesos libres (Sin hacer nada). pm.max_spare_servers: Número máximo de procesos libres. pm.max_requests: El número de peticiones que cada hijo aceptará antes de reiniciarse, útil para evitar pérdidas de memoria.\nHay varias aproximaciones para determinar el valor adecuado de estos parámetros, en esta guía se verán 3, y todas con pm = dynamic.\nPrimer método El primero (Guillaume Moigneu) consiste en calcular pm.max_children basándonos en la fórmula:\n\\[pm.max\\_children = (RAM_{total} - RAM_{resto Proc})/ RAM_{mediaPHP}\\]\nDonde \\(RAM_{restoProc}\\) es la memoria usada por los otros procesos y \\(RAM_{mediaPHP}\\) es la media de memoria usada por los procesos de PHP. La memoria consumida por el resto de procesos se puede calcular mediante este comando:\nps -ylA --sort:rss | grep -v php5-fpm | awk \u0026#39;!/RSS/ { s+=$8 } END { printf \u0026#34;%s\\n\u0026#34;, \u0026#34;Memoria total usada por otros procesos\u0026#34;; printf \u0026#34;%dM\\n\u0026#34;, s/1024 }\u0026#39; Y la consumida por PHP:\nps -ylC php5-fpm --sort:rss | awk \u0026#39;!/RSS/ { s+=$8 } END { printf \u0026#34;%s\\n\u0026#34;, \u0026#34;Memoria consumida por PHP: \u0026#34;; printf \u0026#34;%dM\\n\u0026#34;, s/1024 }\u0026#39; Al número anterior lo dividimos por los procesos de PHP y obtenemos la media. Una vez calculado el valor de max_children, min_spare_servers y max_spare_servers se suelen calcular evaluando el rendimiento y start_servers, suele ser:\n\\[start\\_servers = \\frac{min\\_spare\\_servers + (max\\_spare\\_servers - min\\_spare\\_servers)}{2}\\]\nSegundo método El segundo método (myshell.co.uk) es calcularlo en base a:\n\\[pm.max\\_children = RAM_{total} / RAM_{maxPHP}\\]\nDonde \\(RAM_{maxPHP}\\) es el process PHP que ocupe más memoria. El resto de parámetros se calculan en base a éste.\nTercer método Por último, otro método (Perusio) es realizando la operación siguiente:\n\\[pm.max\\_children = 1.2 \\cdot RAM_{total}/RAM_{mediaPHP}\\]\nOptimizando Nginx FastCGI es un protocolo que hace de interfaz entre programas y servidores web. En esta sección veremos cómo configurar nginx para cachear páginas y aumentar su rendimiento.\nPara aprovechar todos los núcleos de un procesador, nginx necesita ajustar el parámetro worker_processes acorde al número de procesadores. Para determinar el número de procesadores podemos ejecutar el siguiente comando:\ncat /proc/cpuinfo| grep processor | wc -l En la directiva worker_connections dentro del bloque events escribiremos un 1024. Con esto nginx tendrá un proceso por núcleo y cada proceso podrá procesar hasta 1024 conexiones.\nEstableceremos ahora los parámetros que permitirán cachear los resultados para servirlos más rápido al cliente, para ello haremos uso de las directivas fastcgi_cache. En el bloque http necesitaremos:\nfastcgi_cache_path /var/cache/nginx levels=1:2 keys_zone=microcache:500m max_size=1000m inactive=60m; fastcgi_cache_key \u0026#34;$scheme$request_method$host$request_uri\u0026#34;; fastcgi_cache_use_stale updating error timeout invalid_header http_500; Lo cual establece el directorio donde se guardarán los objetos cacheados, los niveles de cache, un nombre y el espacio reservado (500Mb), así como un tope máximo (1Gb). La segunda directiva establece bajo qué nombre se almacenará la clave para la cache. Por último la tercera servirá contenido antiguo en la caché cuando haya errores en el servidor web, cuando se esté actualizando la caché, cuando haya errores del tipo 5xx o cuando la cabecera de la petición sea inválida.\nEl siguiente paso es decidir qué objetos se almacenarán en caché y cuales no. Para ello, dentro de un bloque server escribiremos:\nset $no_cache 0; if ($request_method = POST) { set $no_cache 1; } if ($query_string != \u0026#34;\u0026#34;) { set $no_cache 1; } location ~ \\.php$ { # .... fastcgi_cache_bypass $no_cache; fastcgi_no_cache $no_cache; fastcgi_cache microcache; fastcgi_cache_valid 60m; } En esta porción de código hemos declarado una variable que determinará qué peticiones se cachean y cuales no. No cachearemos ninguna petición POST ni nada que tenga consultas en la URL (?arg\u0026#8230;\u0026arg1;\u0026#8230;). Con ayuda de esta variable podremos decidir en el bloque location si cacheamos la petición (directivas bypass y no_cache), aquí hacemos referencia al nombre que dimos anteriormente al espacio de caché y fijamos un periodo de validez.\nPage Speed En esta sección veremos cómo compilar y configurar el módulo desarrollado por Google que optimizará al máximo todos los recursos de nuestra web, minimizando considerablemente el tiempo de respuesta y aplicando algunos cambios a los archivos para que cumplan con los estándares de rendimiento que Google usa para puntuar las páginas web.\nAlgunas de las características que ofrece son comprimir los archivos CSS y JavaScript de forma que ocupen lo menos posible. Unificar (cuando sea posible) la mayor cantidad de archivos CSS y JS en uno solo para reducir el número de peticiones al servidor. Optimizar las imágenes para reducir su tamaño. Cargar de forma asíncrona los programas JS. Mover los elementos bloqueantes que impiden que la página se renderize correctamente a lugares donde no sean perjudiciales para el renderizado. Éstas son solo algunas de las funcionalidades principales.\nPreparando el entorno Antes de poder compilar, será necesario instalar algunas dependencias:\napt-get install build-essential zlib1g-dev libpcre3 libpcre3-dev Una vez hecho, estamos en condiciones para descargar y compilar:\ncd ~ wget https://github.com/pagespeed/ngx_pagespeed/archive/v1.7.30.1-beta.zip unzip v1.7.30.1-beta.zip # or unzip v1.7.30.1-beta cd ngx_pagespeed-1.7.30.1-beta/ wget https://dl.google.com/dl/page-speed/psol/1.7.30.1.tar.gz tar -xzvf 1.7.30.1.tar.gz Hecho esto, será necesario recompilar nginx con este módulo, como comentamos al inicio de esta guía, para ello simplemente ejecutamos:\nnginx -V # Para ver con qué módulos está compilado el ejecutable actual configure arguments: --with-http_gzip_static_module --sbin-path=/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module cd ~/nginx-1.4.4/ # compilaremos nginx con el nuevo módulo (--ad-module) ./configure --with-http_gzip_static_module --sbin-path=/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module --add-module=$HOME/ngx_pagespeed-1.7.30.1-beta make -j 4 # compilamos service nginx destroy # detenemos la instancia actual de nginx make install # instalamos la nueva versión con pagespeed Configurando PageSpeed Solo resta configurar nginx para activar pagespeed con los filtros deseados. La documentación se puede encontrar en Configuring PageSpeed Filters. Por defecto los filtros habilitados son:\nadd_head combine_css combine_javascript convert_meta_tags extend_cache fallback_rewrite_css_urls flatten_css_imports inline_css inline_import_to_link inline_javascript rewrite_css rewrite_images rewrite_javascript rewrite_style_attributes_with_url Veamos cómo habilitar pagespeed en nginx, para ello crearemos un fichero y un directorio en /usr/local/nginx/conf/global/pagespeed.conf conteniendo:\npagespeed on; # Needs to exist and be writable by nginx. pagespeed FileCachePath /var/ngx_pagespeed_cache; # Ensure requests for pagespeed optimized resources go to the pagespeed handler # and no extraneous headers get set. location ~ \u0026#34;\\.pagespeed\\.([a-z]\\.)?[a-z]{2}\\.[^.]{10}\\.[^.]+\u0026#34; { add_header \u0026#34;\u0026#34; \u0026#34;\u0026#34;; } location ~ \u0026#34;^/ngx_pagespeed_static/\u0026#34; { } location ~ \u0026#34;^/ngx_pagespeed_beacon$\u0026#34; { } # This page shows statistics about the ngx_pagespeed module. location /ngx_pagespeed_statistics { allow 127.0.0.1; allow TuIP; deny all; } # Recent log messages. Like statistics, these are generally not to be shown # to the public, so this has access controls as well. pagespeed MessageBufferSize 100000; location /ngx_pagespeed_message { allow 127.0.0.1; # allow TuIP; deny all; } # This page lets you view a graphical console displaying statistics about # the ngx_pagespeed module. As with statistics and messages, you may # want access control. pagespeed Statistics on; pagespeed StatisticsLogging on; pagespeed LogDir /var/log/pagespeed; pagespeed StatisticsLoggingIntervalMs 60000; pagespeed StatisticsLoggingMaxFileSizeKb 1024; location /pagespeed_console { allow 127.0.0.1; # allow TuIP; deny all; } # Honoring no-transform Cache-Control Headers pagespeed DisableRewriteOnNoTransform off; pagespeed RewriteLevel CoreFilters; # Specifying the value for the PageSpeed header pagespeed XHeaderValue \u0026#34;Gracias a ngx_pagespeed\u0026#34;; Esto debería ser suficiente para la mayoría de webs, es posible habilitar más filtros usando la directiva pagespeed EnableFilters.\nPor último hay que añadir la configuración a nginx, dentro del bloque server que deseemos incluimos la línea include global/pagespeed.conf; y recargamos la configuración de nginx:\nservice nginx reload Podemos comprobar que todo funciona correctamente ojeando las cabeceras de la respuesta del servidor como se muestra en la figura:\n Como vemos, la cabecera de pagespeed está presente, luego está habilitado.\nAPC APC viene de Alternative PHP Cache y es un opcode libre y gratuito para PHP. Su objetivo es proporcionar un marco robusto, libre y abierto para optimizar código intermedio de PHP mediante su almacenamiento en caché.\nInstalando y configurando APC Para instalarlo basta con ejecutar:\napt-get install php-apc El archivo de configuración reside en /etc/php5/fpm/conf.d/apc.ini, un ejemplo de configuración es el siguiente:\napc.enabled=1 apc.shm_segments=1 apc.shm_size=128M ;Relative to the number of cached files (you may need to watch your stats for a day or two to find out a good number) apc.num_files_hint=768 ;Relative to the size of your site apc.user_entries_hint=4096 ;The number of seconds a cache entry is allowed to idle in a slot before APC dumps the cache apc.ttl=7200 apc.user_ttl=7200 apc.gc_ttl=3600 ;Setting this to 0 will give you the best performance, as APC will ;not have to check the IO for changes. However, you must clear ;the APC cache to recompile already cached files. If you are still ;developing, updating your site daily in WP-ADMIN, and running W3TC ;set this to 1 apc.stat=0 ;;This MUST be 0, WP can have errors otherwise! apc.include_once_override=0 ;Only set to 1 while debugging apc.enable_cli=0 ;Allow 2 seconds after a file is created before it is cached to prevent users from seeing half-written/weird pages apc.file_update_protection=2 ;Leave at 2M or lower. WordPress doest have any file sizes close to 2M apc.max_file_size=1M apc.cache_by_default=1 apc.use_request_time=1 apc.slam_defense=0 apc.mmap_file_mask=/tmp/apc.XXXXXX apc.stat_ctime=0 apc.canonicalize=1 apc.write_lock=1 apc.report_autofilter=0 apc.rfc1867=0 apc.rfc1867_prefix =upload_ apc.rfc1867_name=APC_UPLOAD_PROGRESS apc.rfc1867_freq=0 apc.rfc1867_ttl=3600 apc.lazy_classes=0 apc.lazy_functions=0 apc.localcache = \u0026#34;1\u0026#34; ;The size of the local process shadow-cache, should be set to a sufficiently large value, approximately half of apc.num_files_hint. apc.localcache.size = \u0026#34;384\u0026#34; APC proporciona una mejora considerable en cuanto al rendimiento, ya que no es necesario volver a interpretar el código PHP cada vez que el servidor recibe una petición, el código quedará compilado en cache listo para ser servido. Uno de los parámetros más importantes es apc.shm_size=, el cual establece el tamaño reservado para la caché.\nConsideraciones sobre seguridad Algunos valores por defecto de la configuración de nginx no son adecuados en términos de seguridad, basándonos en las recomendaciones de NIX Craft podemos ajustar éstos parámetros según nuestras necesidades para obtener una mayor seguridad frente a ataques. Todos estos parámetros irán en el bloque http de nginx.\n## Start: Size Limits \u0026amp; Buffer Overflows ## client_body_buffer_size 8K; client_header_buffer_size 1k; client_max_body_size 1m; large_client_header_buffers 2 1k; ## END: Size Limits \u0026amp; Buffer Overflows ## ## Start: Timeouts ## client_body_timeout 10; client_header_timeout 10; keepalive_timeout 5 5; send_timeout 10; ## End: Timeouts ## ### Directive describes the zone, in which the session states are stored i.e. store in slimits. ### ### 1m can handle 32000 sessions with 32 bytes/session, set to 5m x 32000 session ### limit_conn_zone $binary_remote_addr zone=addr:5m; ### Control maximum number of simultaneous connections for one session i.e. ### ### restricts the amount of connections from a single ip address ### limit_conn addr 10; Una breve explicación del propósito de cada directiva:\n client_body_buffer_size: El tamaño máximo del buffer de petición del cliente. client_header_buffer_size: Normalmente el tamaño de las cabeceras de la mayoría de peticiones son inferiores a 1k, si hay problemas deberemos subir el valor. client_max_body_size: Si vamos a aceptar que se suban archivos a nuestra web, este valor debería ser dado en Megas, de lo contrario podremos establecer un valor bajo, como 1k. large_client_header_buffers: Número máximo y tamaño de los buffers para peticiones que tengan cabeceras de mayor tamaño enviadas por el cliente. Útil para combatir bad bots y ataques DoS. client_body_timeout: Establece el tiempo de espera para leer el cuerpo de la petición del cliente. Si tras pasar el tiempo el cliente no envía nada, nginx devolverá un error 408 (Request timeout). client_header_timeout: Similar al anterior pero para la cabecera. keepalive_timeout: El primer parámetro asigna el tiempo de espera para mantener la conexión activa con el cliente, el servidor cerrará la conxión tras pasar éste tiempo. El segundo parámetro establece el valor de la cabecera Keep-Alive:timeout=time en la respuesta del servidor, esta cabecera puede hacer que algunos navegadore cierren la conexión para que no sea el servidor el que tenga que hacerlo. send_timeout: Asigna el tiempo de espera al cliente. limit_conn_zone: Controla el número de conexiones simultaneas de un mismo cliente. Con esto concluyen los tres artículos sobre instalación y optimización de un servidor web con nginx, espero que haya resultado útil.\nTabla de contenidos Instalación y optimización de un servidor web con Nginx (I) Instalación y optimización de un servidor web con Nginx (II) Instalación y optimización de un servidor web con Nginx (III) ", "wordCount": "3292", "mainEntityOfPage": "https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/", "headline": "Instalación y optimización de un servidor web con Nginx (III)", "datePublished" : "2016-01-01T00:00:00", "dateModified" : "2017-10-05T12:23:49", "description": "A lo largo de esta guía se pretende mostrar cómo instalar desde cero un servidor web con Nginx, realizando las operaciones necesarias para lograr el mayor rendimiento y seguridad posibles con programas tales como php-fpm, APC, y el módulo pagespeed de Google para optimizar los recursos web.", "url": "https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/", "image": { "@type": "ImageObject", "url": "https://elbauldelprogramador.com/img/Instalación-y-optimización-de-un-servidor-web-con-Nginx1.png", "width": 800, "height": 420 }, "author": { "@type": "Person", "name": "Alejandro Alcalde", "url" : "https://elbauldelprogramador.com", "sameAs" : [ "https://www.facebook.com/elbaulp", "https://www.twitter.com/elbaulp", "https://www.linkedin.com/in/algui91", "https://plus.google.com/+elbauldelprogramador", "http://stackoverflow.com/users/1612432/elbaulp" ] }, "publisher": { "@type": "Organization", "name": "El Baúl del programador", "url": "https://elbauldelprogramador.com", "logo": { "@type": "ImageObject", "url": "https://elbauldelprogramador.com/img/bio-photo.png", "width": 150 }, "sameAs": ["http://www.facebook.com/elbaulp", "http://plus.google.com/+elbauldelprogramador", "https://twitter.com/elbaulp", "https://telegram.me/elbaulp"] } } }</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}a{-webkit-tap-highlight-color:transparent}h1,h2,h3,h4,h5,h6{font-family:'Libre Baskerville',serif;font-weight:800;font-style:normal}.text-center{text-align:center}.flex-grid article{opacity:0}.flex-grid article.shown{-ms-filter:none;-webkit-filter:none;filter:none;opacity:1}.flex-grid article.animate{-webkit-transform:translateY(200px);transform:translateY(200px);-webkit-animation:moveUp .65s ease forwards;animation:moveUp .65s ease forwards}@-webkit-keyframes pulse{from{opacity:.4;top:0}50%{-ms-filter:none;-webkit-filter:none;filter:none;opacity:1;top:-10px}to{opacity:.4;top:0}}@keyframes pulse{from{opacity:.4;top:0}50%{-ms-filter:none;-webkit-filter:none;filter:none;opacity:1;top:-10px}to{opacity:.4;top:0}}@-webkit-keyframes moveUp{100%{-webkit-transform:translateY(0);transform:translateY(0);-ms-filter:none;-webkit-filter:none;filter:none;opacity:1}}@keyframes moveUp{100%{-webkit-transform:translateY(0);transform:translateY(0);-ms-filter:none;-webkit-filter:none;filter:none;opacity:1}}.icons-home{text-align:center}.icons-home a{display:inline-block;padding:.938rem;margin:.125rem;border-radius:50%;border:.125rem solid #fff;line-height:0;-webkit-transition:all .7s;transition:all .7s}.icons-home a .icon{fill:#fff;width:18px;height:18px}@media only screen and (min-width:37.5rem){.icons-home a .icon{width:30px;height:30px}}.icons-home a:hover{background:#fff}.icons-home a:hover .icon{fill:#002f4c}.down{position:absolute;bottom:50px;width:100%;display:block;text-align:center}.down .icon{position:absolute;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);width:100px;height:100px;fill:#fff;-webkit-animation:pulse 1.3s infinite;animation:pulse 1.3s infinite}.flag-en,.flag-es{width:32px;height:32px;vertical-align:middle}@media only screen and (max-width:20rem){.flag-en,.flag-es{width:19px;height:19px}}body{left:0;right:0;margin:auto}.overlay,a,amp-sidebar,body{-webkit-transition:all .25s ease;transition:all .25s ease}.dosearch,a.slideButton{position:fixed;display:block;width:40px;height:40px;top:10px;z-index:17}.slideButton{right:10px}.dosearch{right:2.5rem;border-radius:.188rem;padding:.125rem .188rem}.icon-menu{cursor:pointer;padding:.313rem;border-radius:.188rem;width:1.875rem;height:1.875rem;fill:#002f4c}.icon-search{width:2rem;height:2rem}.overlay{cursor:pointer}#close{display:none;fill:#fff}amp-sidebar{position:fixed;height:100%;width:15rem;top:0;right:-15rem;background-color:#002f4c;-webkit-box-shadow:inset -10px -1px 15px -9px rgba(0,0,0,.5);box-shadow:inset -10px -1px 15px -9px rgba(0,0,0,.5)}amp-sidebar h2{text-align:center;margin:0 0 .625rem;font-family:'Libre Baskerville',serif;font-weight:800;font-style:normal;font-size:1.25rem;color:#fff}amp-sidebar nav ul{padding:0}amp-sidebar nav li{margin:0;list-style-type:none}amp-sidebar nav li a{width:100%;display:block;padding:1.25rem;text-decoration:none;font-family:'Libre Baskerville',serif;font-weight:300;font-style:normal;color:#fff;border-top:1px solid #fff}amp-sidebar nav li a:hover{color:#002f4c;background:#fff}amp-sidebar nav .feed{border-bottom:1px solid #fff}amp-sidebar.slide{right:0}.slide #close{right:15.625rem;position:fixed;pointer-events:none}.overlay{position:fixed;width:100%;height:100%;top:0;right:0;pointer-events:none;background:0 0;z-index:17}.overlay.slide{pointer-events:auto;right:240px;background:rgba(0,0,0,.6)}.search{max-width:50rem;margin:0 auto}.search input#search-query{width:100%;padding:1rem}html{background-color:#fff}.img-rounded{border-radius:50%}.support-us{max-width:35rem;margin:0 auto;background-color:#f2f2f2}.support-us #ad-slot{max-width:18.75rem;margin:0 auto}.support-us p,.support-us ul li{font-size:.813rem;margin:0;padding:.313rem 0}.image-credit,figcaption{width:auto;max-width:35rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0;text-align:center;font-style:italic;font-size:.625rem;margin-top:.313rem}.image-credit::after,figcaption::after{content:'';display:table;clear:both}.image-credit a.externalLink:after,figcaption a.externalLink:after{display:none}.paginator-container{width:50rem;text-align:center;margin:0 auto}.paginator-container .paginator{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-flow:row nowrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row nowrap}.paginator-container .paginator a{-ms-flex:auto;-webkit-box-flex:1;flex:auto;text-decoration:none;font-size:3.125rem;color:#002f4c}.near-posts{width:auto;max-width:50rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0;text-align:center;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-flow:row nowrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row nowrap;-webkit-box-align:center;-ms-align-items:center;-ms-flex-align:center;align-items:center;border-top:2px dashed #002f4c;padding-top:.625rem}.near-posts::after{content:'';display:table;clear:both}.near-posts .post-item{-ms-flex:1 1 .625rem;-webkit-box-flex:1;flex:1 1 .625rem;font-size:.938rem;border-bottom:none}@media only screen and (min-width:37.5rem){.near-posts .post-item{font-size:1.25rem}}amp-youtube{max-width:50rem;margin:0 auto}body,html{height:100%}.header-post{background-color:#002f4c}.header-post .content{width:95%;text-align:center;padding:5rem 0 1rem}.bar-header{background:#fff;padding:.625rem 1.25rem;-webkit-box-shadow:0 -3px 9px #000;box-shadow:0 -3px 9px #000;position:fixed;width:100%;z-index:10;top:0}.bar-header .logo{margin:0;line-height:2.188rem}.bar-header .logo a#logo{color:#002f4c;text-decoration:none;font-size:1.75rem}.bar-header .logo a#logo:before{content:url(/img/logo.png);vertical-align:middle}.bar-header .logo a#logo:after{-webkit-transition:all .4s;transition:all .4s;content:'El Baúl'}@media only screen and (min-width:37.5rem){.bar-header .logo a#logo:after{content:'El Baúl del Programador'}}.bar-header a{text-decoration:none}.header-post{width:100%}.header-post .content{margin:auto;max-width:50rem}.header-post .subheader{padding:20px}.header-post .subheader a{border:2px solid #fff;border-radius:20px;padding:0 10px}@media only screen and (min-width:37.5rem){.header-post .subheader a{padding:0 10px}}.header-post .date{font-family:'Libre Baskerville',serif;font-weight:300;font-style:normal;font-size:1rem}.header-post h1{font-size:1.875rem;margin:0 0 30px;text-shadow:3px 3px #00263d}@media only screen and (min-width:37.5rem){.header-post h1{font-size:2.813rem}}.header-post .subtitle{font-family:'Libre Baskerville',serif;font-weight:300;font-style:normal;font-size:.938rem}.header-post .date,.header-post .subtitle,.header-post h1{color:#fff;text-align:center}.header-post a,.header-post p{color:#fff;text-decoration:none;font-family:'Libre Baskerville',serif;font-weight:300;font-style:normal;font-size:.938rem}main{padding-top:6.25rem;background-color:#fff}.row{width:auto;max-width:64.375rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0}.row::after{content:'';display:table;clear:both}.row-post{width:auto;max-width:50rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0}.row-post::after{content:'';display:table;clear:both}.row-post .box-item{-ms-flex:1 0 200px;-webkit-box-flex:1;flex:1 0 200px}.flex-grid{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-flow:row wrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap}.title-category{width:auto;max-width:62.5rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0;font-size:2.5rem;margin-top:0;text-transform:uppercase;padding:0 .938rem}.title-category::after{content:'';display:table;clear:both}.box-item{-ms-flex:1 0 300px;-webkit-box-flex:1;flex:1 0 300px;margin:0 .938rem 3.125rem;display:inline-block;border:1px solid #eee;border-radius:5px;min-height:17.813rem;-webkit-transition:all .3s;transition:all .3s;position:relative}.box-item:hover{-webkit-box-shadow:1px 2px 10px #eee;box-shadow:1px 2px 10px #eee}.box-item a{text-decoration:none}.box-item a:hover .box-item{-webkit-box-shadow:10px 10px 10px #eee;box-shadow:10px 10px 10px #eee}.box-item .box-body{font-family:'Libre Baskerville',serif;font-weight:400;font-style:normal;padding:1.563rem}.box-item .box-body time{font-size:.875rem;color:#b2bac2}.box-item .box-body h2{margin:.313rem 0 .938rem;font-size:1.25rem;font-family:'Libre Baskerville',serif;font-weight:800;font-style:normal;color:#002f4c}.box-item .box-body p{margin:0 0 1.25rem;color:#576366;font-size:.875rem;line-height:1.375rem}.box-item .box-body .tags a{color:#002f4c;padding:.313rem .625rem;border-radius:3px;display:inline-block;margin:0 0 .313rem;z-index:50}.ribbon{position:absolute;right:-5px;top:-5px;z-index:1;overflow:hidden;width:75px;height:75px;text-align:right}.ribbon span{font-size:.75rem;font-family:'Libre Baskerville',serif;font-weight:800;font-style:normal;color:#fff;text-transform:uppercase;text-align:center;line-height:20px;-webkit-transform:rotate(45deg);transform:rotate(45deg);-webkit-transform:rotate(45deg);width:100px;display:block;background:#b31917;position:absolute;top:19px;right:-21px}.ribbon span:before{content:"";position:absolute;left:0;top:100%;z-index:-1;border-left:3px solid #002f4c;border-right:3px solid transparent;border-bottom:3px solid transparent;border-top:3px solid #002f4c}.ribbon span:after{content:"";position:absolute;right:0;top:100%;z-index:-1;border-left:3px solid transparent;border-right:3px solid #002f4c;border-bottom:3px solid transparent;border-top:3px solid #002f4c}h1#taxo-item{margin:0 auto;text-align:center;padding-bottom:1.5rem}.tag-title:before{display:block;content:" ";margin-top:-60px;height:75px;visibility:hidden}.post{background:#fff}.page{margin-top:3.75rem}.post-content div#taxo{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-flow:row wrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;-ms-justify-content:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.post-content .tags{margin-top:1.875rem}.post-content .tags a{font-size:.875rem;color:#002f4c;display:inline-block;border:1px solid #002f4c;border-radius:.313rem;padding:.25rem .625rem;margin-right:.125rem;margin-bottom:.5rem;text-decoration:none}.post-content figure{margin:0 auto}.post-content amp-img{margin:0 auto;margin-bottom:.313rem}.post-content amp-img img{-o-object-fit:scale-down;object-fit:scale-down}.post-content .button-post,.post-content .tags,.post-content h1,.post-content h2,.post-content h3,.post-content h4,.post-content h5,.post-content h6,.post-content iframe,.post-content ol,.post-content p,.post-content ul{color:#002f4c;width:auto;max-width:35rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0;padding:0 1.25rem;font-family:'Libre Baskerville',serif;font-weight:400;font-style:normal;font-size:1rem;line-height:1.875;letter-spacing:.01rem}.post-content .button-post::after,.post-content .tags::after,.post-content h1::after,.post-content h2::after,.post-content h3::after,.post-content h4::after,.post-content h5::after,.post-content h6::after,.post-content iframe::after,.post-content ol::after,.post-content p::after,.post-content ul::after{content:'';display:table;clear:both}.post-content li{padding:.625rem 0}.post-content ul{margin-bottom:0}.post-content li,.post-content p{color:#212121}.post-content li code,.post-content p code{color:#002f4c;word-wrap:break-word}.post-content a{color:#002f4c;border-bottom:1px dashed #002f4c;font-family:'Libre Baskerville',serif;font-weight:400;font-style:normal;text-decoration:none;-webkit-transition:all .3s;transition:all .3s}.post-content a:hover{background:#002f4c;color:#fff}.post-content .externalLink:after{display:inline-block;content:'';color:#002f4c;background-image:url(../img/external.svg);background-size:100%;margin-left:.313rem;width:1.125rem;height:1.125rem}.post-content iframe{margin-top:1.875rem;width:100%}.post-content #twitter-widget-0,.post-content .instagram-media{margin:auto}.post-content h1,.post-content h2,.post-content h3,.post-content h4,.post-content h5,.post-content h6{font-family:'Libre Baskerville',serif;font-weight:800;font-style:normal}.post-content h1{font-size:1.563rem;line-height:1.4}.post-content h2{font-size:1.375rem;line-height:1.4}.post-content h3{font-size:1.125rem;line-height:1.4}.post-content ol,.post-content ul{padding-left:2.5rem}.post-content ul.post-list{padding:0}.post-content ul.post-list.svg-serie p{padding:0}@media only screen and (max-width:37.5rem){.post-content ul.post-list{padding:0 1.25rem}}.post-content blockquote{width:auto;max-width:45.625rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0;border-left:.313rem solid #002f4c;padding:0 1.875rem;margin:3.125rem auto}.post-content blockquote::after{content:'';display:table;clear:both}.post-content blockquote p{color:rgba(0,0,0,.6);margin:0}@media only screen and (max-width:37.5rem){.post-content blockquote p{font-size:1.125rem;line-height:1.5;padding:0}}.post-content hr{width:auto;max-width:47.5rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0;border:1px solid #f2f2f2;margin:50px auto}.post-content hr::after{content:'';display:table;clear:both}.post-content>table{margin:3.125rem auto}@media only screen and (max-width:37.5rem){.post-content>table{display:none}}.post-content>table td,.post-content>table th{border:.125rem solid #ccc;padding:.313rem}.post-content td>pre{padding:0;margin:0}.post-content td.gutter.gl{padding-right:1.563rem;line-height:1.5rem}.post-content #guides-container{width:auto;max-width:64.375rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0}.post-content #guides-container::after{content:'';display:table;clear:both}.post-content #guides-container img{margin:5px}.tag-title{font-family:'Libre Baskerville',serif;font-weight:300;font-style:normal;font-size:2.25rem;width:auto;max-width:35rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0}.tag-title::after{content:'';display:table;clear:both}@media only screen and (max-width:37.5rem){.tag-title{font-size:1.75rem;margin-top:1.25rem;padding:0 1.25rem}}.post-list{list-style:none;margin:1.563rem auto}@media only screen and (max-width:37.5rem){.post-list{padding:0 1.25rem}}.post-list a{display:block;border-bottom:1px solid #dadada;padding:.625rem 0;text-decoration:none;-webkit-transition:all .5s;transition:all .5s}.post-list a:hover{color:#001726;border-bottom:1px solid #001726;background:#fff}.post-list .entry-date{float:right}@media only screen and (max-width:37.5rem){.post-list .entry-date{display:none}}.box-item h2{margin:.313rem 0 .938rem;font-size:1.25rem;font-family:'Libre Baskerville',serif;font-weight:800;font-style:normal;color:#002f4c}.box-item p{margin:0 0 1.25rem;color:#576366;font-size:.875rem;line-height:1.375rem}.box-item div.tags a{color:#002f4c;padding:.313rem .625rem;border-radius:3px;display:inline-block;margin:0 0 .313rem;z-index:50}.share{width:auto;max-width:560px;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0;text-align:center;border-top:1px solid #f2f2f2;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-justify-content:space-between;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.share::after{content:'';display:table;clear:both}article .share{border-top:none}.share svg{margin:.938rem;width:35px;height:35px}@media only screen and (max-width:37.5rem){.share svg{width:16px;height:16px}}.share a{text-decoration:none;border:none}.author .share{width:auto;max-width:560px;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0;text-align:center;border-top:1px solid #f2f2f2}.author .share::after{content:'';display:table;clear:both}article .author .share{border-top:none}.author .share a{text-decoration:none;border:none}.subscribe{position:fixed;top:10px;z-index:17;right:5.625rem;min-height:2.5rem}.subscribe a{text-decoration:none}.subscribe svg{margin:0 .5rem;width:32px;height:32px}@media only screen and (max-width:48rem){.subscribe{-ms-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;text-align:center;margin-bottom:1rem;margin-top:-1rem;position:relative;right:0;min-height:0;top:0;z-index:0}}.icon-twitter{fill:#1da1f2}.icon-facebook{fill:#3b5998}.icon-google-plus{fill:#db4437}.icon-mail{fill:#2f56a7}.icon-rss{fill:#f79635}.icon-github{fill:#333}.icon-stack-overflow{fill:#f48024}.icon-linkedin{fill:#0077b5}.icon-telegram{fill:#54b3e6}.icon-medium1{fill:#d0d0d0}.icon-medium2{fill:#a1a1a1}.icon-medium3{fill:grey}.icon-medium4{fill:#575757}figure#medium{max-width:8rem}pre{width:100%;margin:1rem 0;font-size:.875rem}@media only screen and (min-width:37.5rem){pre{margin:1.563rem 0}}pre code{width:auto;max-width:35rem;float:none;display:block;margin-right:auto;margin-left:auto;padding-left:0;padding-right:0;padding:0 1.25rem;overflow-x:auto}pre code::after{content:'';display:table;clear:both}pre span{line-height:1.5rem;font-family:Monaco,Consolas,Menlo,monospace}.highlight .hll{background-color:#ffc}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{color:#000;font-weight:700}.highlight .o{color:#000;font-weight:700}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:700;font-style:italic}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:700;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .ge{color:#000;font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:700}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{color:#000;font-weight:700}.highlight .kd{color:#000;font-weight:700}.highlight .kn{color:#000;font-weight:700}.highlight .kp{color:#000;font-weight:700}.highlight .kr{color:#000;font-weight:700}.highlight .kt{color:#458;font-weight:700}.highlight .m{color:#099}.highlight .s{color:#d01040}.highlight .na{color:teal}.highlight .nb{color:#0086b3}.highlight .nc{color:#458;font-weight:700}.highlight .no{color:teal}.highlight .nd{color:#3c5d5d;font-weight:700}.highlight .ni{color:purple}.highlight .ne{color:#900;font-weight:700}.highlight .nf{color:#900;font-weight:700}.highlight .nl{color:#900;font-weight:700}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{color:#000;font-weight:700}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d01040}.highlight .sc{color:#d01040}.highlight .sd{color:#d01040}.highlight .s2{color:#d01040}.highlight .se{color:#d01040}.highlight .sh{color:#d01040}.highlight .si{color:#d01040}.highlight .sx{color:#d01040}.highlight .sr{color:#009926}.highlight .s1{color:#d01040}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}.author{background:#f2f2f2;display:table;width:100%;padding-top:.313rem}.author .details{margin:auto;max-width:35rem;padding:0 1.25rem;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-flow:row nowrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row nowrap}.author .details #author-photo{-ms-flex:1 0 5.625rem;-webkit-box-flex:1;flex:1 0 5.625rem;max-width:5.625rem;margin:.625rem}@media only screen and (max-width:37.5rem){.author .details{text-align:center;-ms-flex-flow:row wrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap}.author .details #author-photo{margin:0 auto}}.author amp-img,.author img{border-radius:50%;display:block;margin:auto}.author .def{color:grey;font-size:.625rem;font-family:'Libre Baskerville',serif;font-weight:300;font-style:normal;margin:.625rem}@media only screen and (min-width:37.5rem){.author .def{margin:0}}.author .name{margin:0}.author .name a{font-family:'Libre Baskerville',serif;font-weight:800;font-style:normal;text-decoration:none;border-bottom:none;color:#000;font-size:.875rem}.author .name a:hover{color:#002f4c}.author .desc{font-family:'Libre Baskerville',serif;font-weight:300;font-style:normal;margin:.625rem;font-size:.75rem}.author .email{text-decoration:none;color:#002f4c}.author .social{width:24px;height:24px}.comments{padding:1.25rem}footer{background:#002f4c;padding:1.563rem 0;margin-top:.938rem}footer a,footer p{text-decoration:none;font-family:'Libre Baskerville',serif;font-weight:300;font-style:normal;color:#fff;text-align:center;margin:0}.box-body .tags a{color:#002f4c;border:1px solid #002f4c}.post-dev .ribbon span{background-color:#e64a19}.post-dev .ribbon span:before{border-left:3px solid #a13411;border-top:3px solid #a13411}.post-dev .ribbon span:after{border-right:3px solid #a13411;border-top:3px solid #a13411}.post-articulos .ribbon span{background-color:#f57c00}.post-articulos .ribbon span:before{border-left:3px solid #ab5700;border-top:3px solid #ab5700}.post-articulos .ribbon span:after{border-right:3px solid #ab5700;border-top:3px solid #ab5700}.post-android .ribbon span{background-color:#689f38}.post-android .ribbon span:before{border-left:3px solid #496f27;border-top:3px solid #496f27}.post-android .ribbon span:after{border-right:3px solid #496f27;border-top:3px solid #496f27}.post-linux .ribbon span{background-color:#2196f3}.post-linux .ribbon span:before{border-left:3px solid #0a6bb7;border-top:3px solid #0a6bb7}.post-linux .ribbon span:after{border-right:3px solid #0a6bb7;border-top:3px solid #0a6bb7}.post-security-now .ribbon span{background-color:#00bcd4}.post-security-now .ribbon span:before{border-left:3px solid #008494;border-top:3px solid #008494}.post-security-now .ribbon span:after{border-right:3px solid #008494;border-top:3px solid #008494}.post-seguridad .ribbon span{background-color:#00bcd4}.post-seguridad .ribbon span:before{border-left:3px solid #008494;border-top:3px solid #008494}.post-seguridad .ribbon span:after{border-right:3px solid #008494;border-top:3px solid #008494}.post-security .ribbon span{background-color:#00bcd4}.post-security .ribbon span:before{border-left:3px solid #008494;border-top:3px solid #008494}.post-security .ribbon span:after{border-right:3px solid #008494;border-top:3px solid #008494}.post-BaseDeDatos .ribbon span{background-color:#009688}.post-BaseDeDatos .ribbon span:before{border-left:3px solid #00695f;border-top:3px solid #00695f}.post-BaseDeDatos .ribbon span:after{border-right:3px solid #00695f;border-top:3px solid #00695f}.post-datascience .ribbon span{background-color:#3f173f}.post-datascience .ribbon span:before{border-left:3px solid #2c102c;border-top:3px solid #2c102c}.post-datascience .ribbon span:after{border-right:3px solid #2c102c;border-top:3px solid #2c102c}.post-servidores .ribbon span{background-color:#0097a7}.post-servidores .ribbon span:before{border-left:3px solid #006a75;border-top:3px solid #006a75}.post-servidores .ribbon span:after{border-right:3px solid #006a75;border-top:3px solid #006a75}.post-latex .ribbon span{background-color:#b31917}.post-latex .ribbon span:before{border-left:3px solid #7d1210;border-top:3px solid #7d1210}.post-latex .ribbon span:after{border-right:3px solid #7d1210;border-top:3px solid #7d1210}.post-descargas .ribbon span{background-color:#f05033}.post-descargas .ribbon span:before{border-left:3px solid #be290e;border-top:3px solid #be290e}.post-descargas .ribbon span:after{border-right:3px solid #be290e;border-top:3px solid #be290e}</style></head><body><header class="bar-header"><h1 class="logo"><a id="logo" href="https://elbauldelprogramador.com/"></a> <a href="/"><svg class="icon flag-es"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#flag-es"></use></svg> </a><a href="/en/"><svg class="icon flag-en"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#flag-en"></use></svg></a></h1></header><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 805 1024"><path class="path1" d="M741.714 755.429q0 22.857-16 38.857l-77.714 77.714q-16 16-38.857 16t-38.857-16l-168-168-168 168q-16 16-38.857 16t-38.857-16l-77.714-77.714q-16-16-16-38.857t16-38.857l168-168-168-168q-16-16-16-38.857t16-38.857l77.714-77.714q16-16 38.857-16t38.857 16l168 168 168-168q16-16 38.857-16t38.857 16l77.714 77.714q16 16 16 38.857t-16 38.857l-168 168 168 168q16 16 16 38.857z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-google-plus" viewBox="0 0 951 1024"><path class="path1" d="M420 454.857q0 20.571 18.286 40.286t44.286 38.857 51.714 42 44 59.429 18.286 81.143q0 51.429-27.429 98.857-41.143 69.714-120.571 102.571t-170.286 32.857q-75.429 0-140.857-23.714t-98-78.571q-21.143-34.286-21.143-74.857 0-46.286 25.429-85.714t67.714-65.714q74.857-46.857 230.857-57.143-18.286-24-27.143-42.286t-8.857-41.714q0-20.571 12-48.571-26.286 2.286-38.857 2.286-84.571 0-142.571-55.143t-58-139.714q0-46.857 20.571-90.857t56.571-74.857q44-37.714 104.286-56t124.286-18.286h238.857l-78.857 50.286h-74.857q42.286 36 64 76t21.714 91.429q0 41.143-14 74t-33.714 53.143-39.714 37.143-34 35.143-14 37.714zM336.571 400q21.714 0 44.571-9.429t37.714-24.857q30.286-32.571 30.286-90.857 0-33.143-9.714-71.429t-27.714-74-48.286-59.143-66.857-23.429q-24 0-47.143 11.143t-37.429 30q-26.857 33.714-26.857 91.429 0 26.286 5.714 55.714t18 58.857 29.714 52.857 42.857 38.286 55.143 14.857zM337.714 898.857q33.143 0 63.714-7.429t56.571-22.286 41.714-41.714 15.714-62.286q0-14.286-4-28t-8.286-24-15.429-23.714-16.857-20-22-19.714-20.857-16.571-23.714-17.143-20.857-14.857q-9.143-1.143-27.429-1.143-30.286 0-60 4t-61.429 14.286-55.429 26.286-39.143 42.571-15.429 60.286q0 40 20 70.571t52.286 47.429 68 25.143 72.857 8.286zM800.571 398.286h121.714v61.714h-121.714v125.143h-60v-125.143h-121.143v-61.714h121.143v-124h60v124z"/></symbol><symbol id="icon-rss" viewBox="0 0 56.693 56.693" enable-background="new 0 0 56.693 56.693" xml:space="preserve"><path d="M3.428,31.085c6.19,0,12.009,2.418,16.382,6.816c4.381,4.398,6.793,10.256,6.793,16.492h9.539   c0-18.113-14.676-32.848-32.714-32.848V31.085z M3.443,14.174c22.061,0,40.01,18.047,40.01,40.231h9.539   c0-27.445-22.229-49.77-49.549-49.77V14.174z M16.634,47.741c0,3.648-2.959,6.607-6.607,6.607S3.42,51.39,3.42,47.741   c0-3.65,2.958-6.607,6.606-6.607S16.634,44.091,16.634,47.741z"/></symbol><symbol id="icon-mail" viewBox="0 0 56.7 56.7" xml:space="preserve"><path d="M53.1719,14.5953l0.0011-0.0011l-0.0011,0.0008v-1.184c0-2.2468-1.8384-4.0852-4.0853-4.0852l-0.0012,0.0011l-0.0024,0.0018         l0.0036-0.0029H7.3962l0.0161,0.0131l-0.0161-0.012c-2.2468,0-4.0853,1.8384-4.0853,4.0853v27.9073         c0,2.2468,1.8384,4.0851,4.0853,4.0851h1.4543h38.6578v-0.001c4.2856-0.0498,5.5728-1.1102,5.6702-4.0809L53.1719,14.5953z          M46.0429,10.3258L28.1753,23.487L10.4239,10.3258H46.0429z M9.8608,20.5521l16.5508,11.4004l0.0166,0.0115L9.8513,43.4907         L9.8608,20.5521z M10.2886,44.4046l17.0151-11.8314l0.2985,0.2077c0.1716,0.1194,0.3714,0.1792,0.5712,0.1792         c0.1982,0,0.8773-0.39,0.8773-0.39l17.0197,11.8345H10.2886z M46.4973,43.4836L29.9305,31.9641l9.2394-6.3642l7.3274-5.0472V43.4836         z"/></symbol><symbol id="icon-github" viewBox="-91 49.217 56.693 56.693" enable-background="new -91 49.217 56.693 56.693" xml:space="preserve"><g><path d="M-38.1773,78.2347c0.0102,0.0012,0.0215,0.0023,0.0316,0.0023c0.079,0,0.1513-0.0576,0.166-0.1389             c0.0169-0.0915-0.0441-0.1796-0.1355-0.1976c-2.3114-0.4257-4.0026-0.8966-9.7083-0.8491c0.3557-1.3155,0.5476-2.8715,0.586-4.7144             c-0.009-4.9966-2.4006-6.7637-2.8602-7.5937c0.6775-3.7827-0.1129-5.5047-0.4799-6.0953c-1.355-0.4822-4.7143,1.2399-6.5492,2.4537             c-2.9923-0.8751-9.3157-0.7905-11.687,0.2258c-4.3755-3.1335-6.6904-2.6536-6.6904-2.6536s-1.4962,2.6818-0.3952,6.6057             c-1.4397,1.8349-2.5124,3.1335-2.5124,6.5752c0,1.9388,0.2281,3.6743,0.743,5.1896c-2.29-0.0056-7.0897,0.3026-9.3379,0.8582             c-0.0903,0.0226-0.1456,0.1152-0.1242,0.2055c0.0192,0.0768,0.0892,0.1287,0.1649,0.1287c0.0135,0,0.0271-0.0012,0.0406-0.0045             c2.2686-0.5612,7.2286-0.8661,9.3785-0.848c0.1231,0.3264,0.2609,0.6425,0.4133,0.9485c-5.5273,0.1468-7.0174,0.9361-9.3379,1.5154             c-0.1682,0.0429-0.3331,0.0836-0.4934,0.1231c-0.0903,0.0225-0.1468,0.1151-0.1242,0.2054             c0.0192,0.0768,0.088,0.1287,0.1649,0.1287c0.0135,0,0.0271-0.0011,0.0406-0.0045c0.1603-0.0406,0.3252-0.0813,0.4946-0.1242             c2.3273-0.5815,3.8377-1.3754,9.4316-1.5097c1.644,2.9855,4.8148,4.843,10.1625,5.3568c-0.7633,0.5792-1.6802,1.6791-1.8066,2.9505             c-0.9598,0.6211-2.8896,0.8254-4.3903,0.3524c-2.1025-0.664-2.9076-4.8272-6.0557-4.2344             c-0.6821,0.1287-0.5466,0.5782,0.0428,0.9598c0.9598,0.621,1.8632,1.3979,2.5599,3.0521c0.5352,1.2703,1.6599,3.54,5.2168,3.54             c1.4114,0,2.4006-0.1694,2.4006-0.1694S-68.8,93.7168-68.8,94.977c0,1.4532-1.9614,1.8632-1.9614,2.5621             c0,0.2766,0.6493,0.3026,1.171,0.3026c1.0309,0,3.1764-0.8605,3.1764-2.3713c0-1.2003,0.0192-5.236,0.0192-5.9418             c0-1.5436,0.8277-2.0325,0.8277-2.0325s0.1028,8.2396-0.1976,9.3439c-0.3523,1.2986-0.988,1.1145-0.988,1.6938             c0,0.8616,2.5824,0.2112,3.4383-1.6802c0.6617-1.4725,0.3726-9.5551,0.3726-9.5551l0.7057-0.0146c0,0,0.0396,3.7003,0.0158,5.3918             c-0.0248,1.7513-0.1434,3.9668,0.8965,5.0113c0.6832,0.6865,2.8986,1.8914,2.8986,0.7904c0-0.6403-1.2139-1.1664-1.2139-2.8986             c0-1.8846,0-7.4424,0-7.9697c0.9688,0,0.8232,2.6208,0.8232,2.6208l0.0711,4.869c0,0-0.2134,1.7739,1.9185,2.5169             c0.7521,0.2631,2.3622,0.3343,2.4379-0.1072c0.0756-0.4426-1.9388-1.101-1.9569-2.4752c-0.0113-0.8378,0.0373-1.3268,0.0373-4.9684             c0-3.6415-0.489-4.9875-2.1929-6.0602c5.2586-0.5409,8.5129-1.8417,10.0994-5.3264c1.8225,0.0599,5.6387,0.2462,10.0741,1.6023             c0.0158,0.0057,0.0328,0.0079,0.0497,0.0079c0.0723,0,0.1389-0.0474,0.1615-0.1197c0.027-0.0903-0.0226-0.1852-0.1129-0.2123             c-4.3745-1.3381-8.0744-1.547-10.0278-1.6125c0.123-0.3026,0.236-0.6199,0.3365-0.953             C-42.1821,77.3382-40.4864,77.8079-38.1773,78.2347z M-78.0168,83.7743c-0.2105,0-0.3811-0.1138-0.3811-0.2541             c0-0.1403,0.1706-0.254,0.3811-0.254c0.2104,0,0.3811,0.1138,0.3811,0.254C-77.6357,83.6605-77.8064,83.7743-78.0168,83.7743z              M-77.2123,84.1649c0-0.1403,0.1706-0.2541,0.381-0.2541c0.2105,0,0.3811,0.1138,0.3811,0.2541s-0.1706,0.254-0.3811,0.254             C-77.0417,84.4189-77.2123,84.3052-77.2123,84.1649z M-76.4878,85.0259c0-0.1403,0.1707-0.2541,0.3811-0.2541             s0.3811,0.1138,0.3811,0.2541c0,0.1403-0.1707,0.254-0.3811,0.254S-76.4878,85.1662-76.4878,85.0259z M-75.4715,86.2539             c-0.2105,0-0.3812-0.1138-0.3812-0.2541s0.1707-0.2541,0.3812-0.2541c0.2104,0,0.3811,0.1138,0.3811,0.2541             S-75.261,86.2539-75.4715,86.2539z M-74.7469,87.1713c-0.2105,0-0.3811-0.1137-0.3811-0.254s0.1706-0.2541,0.3811-0.2541             c0.2104,0,0.381,0.1138,0.381,0.2541S-74.5365,87.1713-74.7469,87.1713z M-73.7684,87.9524c-0.2104,0-0.381-0.1138-0.381-0.2541             c0-0.1403,0.1706-0.254,0.381-0.254c0.2105,0,0.3811,0.1138,0.3811,0.254C-73.3873,87.8386-73.5579,87.9524-73.7684,87.9524z              M-72.3992,88.4605c-0.2105,0-0.3811-0.1138-0.3811-0.2541c0-0.1403,0.1706-0.254,0.3811-0.254             c0.2104,0,0.3811,0.1138,0.3811,0.254C-72.0181,88.3467-72.1887,88.4605-72.3992,88.4605z M-71.0254,88.4605             c-0.2105,0-0.3811-0.1138-0.3811-0.2541c0-0.1403,0.1706-0.254,0.3811-0.254c0.2104,0,0.381,0.1138,0.381,0.254             C-70.6443,88.3467-70.8149,88.4605-71.0254,88.4605z M-69.6468,88.244c-0.2104,0-0.3811-0.1137-0.3811-0.254             s0.1707-0.254,0.3811-0.254c0.2105,0,0.3812,0.1137,0.3812,0.254S-69.4363,88.244-69.6468,88.244z M-58.853,82.8356             c-1.1366,0.0377-2.3154,0.0568-3.5027,0.0568c-1.199,0-2.3565-0.0195-3.4398-0.0582c-5.7773-0.2026-8.9593-2.6409-8.9593-6.8653             c0-0.4387,0.0928-1.9808,1.2881-3.4138c1.1617-1.3927,2.9417-2.1292,5.1478-2.1292c0.1503,0,0.4193,0.0166,0.9651,0.0504             c1.1697,0.0728,3.1276,0.1945,5.0663,0.1945c1.7554,0,3.531-0.1296,4.4849-0.1994c0.4465-0.0328,0.6258-0.0455,0.7411-0.0455             c4.6929,0,6.3649,2.9985,6.3649,5.8044C-50.6965,79.1217-52.1116,82.6148-58.853,82.8356z"/><path d="M-79.1647,86.4891c0.9093,0,0.0154-1.4104-0.0001-2.0701C-79.1689,85.0611-80.074,86.4891-79.1647,86.4891z"/><path d="M-61.4556,80.4198c-0.0936,0-0.1694,0.0759-0.1694,0.1694c0,0.3732-0.4386,0.7904-1.0256,0.7904             c-0.0847,0-0.1662-0.0093-0.2441-0.0261c-0.1949-0.0419-0.367-0.13-0.5078-0.2336c-0.0282-0.0207-0.0551-0.0421-0.0807-0.0638             c-0.0768-0.0651-0.1416-0.1336-0.1927-0.1989c-0.0851-0.1087-0.1321-0.2083-0.1321-0.268c0-0.0935-0.0758-0.1694-0.1694-0.1694             s-0.1694,0.0759-0.1694,0.1694c0,0.0483,0.0099,0.1022,0.0288,0.1595c0.0285,0.0859,0.0774,0.1796,0.1441,0.2737             c0.0667,0.0941,0.1513,0.1886,0.251,0.2764c0.0997,0.0877,0.2147,0.1686,0.3422,0.2356c0.1594,0.0836,0.3384,0.1453,0.5319,0.171             c0.0645,0.0085,0.1306,0.0131,0.1981,0.0131c0.3518,0,0.6569-0.114,0.8889-0.2868c0.0331-0.0247,0.0648-0.0506,0.0948-0.0775             c0.0601-0.0539,0.114-0.1119,0.161-0.1729c0.1174-0.1524,0.1917-0.3228,0.2132-0.4913c0.0043-0.0337,0.0065-0.0673,0.0065-0.1007             C-61.2862,80.4956-61.3621,80.4198-61.4556,80.4198z"/><path d="M-63.1533,79.5132c0.0419,0.0621,0.0955,0.1157,0.1576,0.1576c0.0233,0.0157,0.0478,0.0298,0.0733,0.0421             c0.051,0.0246,0.1061,0.042,0.1641,0.0508c0.029,0.0044,0.0587,0.0067,0.0889,0.0067c0.1208,0,0.2331-0.0367,0.3262-0.0997             c0.0388-0.0262,0.0743-0.0569,0.1057-0.0915c0.0437-0.0481,0.0758-0.1055,0.1016-0.1663c0.0297-0.07,0.0499-0.1451,0.0499-0.226             c0-0.3222-0.2612-0.5835-0.5834-0.5835c-0.1611,0-0.3069,0.0653-0.4125,0.171c-0.0046,0.0046-0.008,0.0103-0.0125,0.0151             c-0.03,0.0321-0.0555,0.0679-0.0777,0.1061c-0.0311,0.0536-0.056,0.1112-0.0688,0.1738c-0.0078,0.038-0.0118,0.0773-0.0118,0.1176             s0.0041,0.0796,0.0118,0.1176C-63.2255,79.3806-63.1952,79.4511-63.1533,79.5132z"/><path d="M-67.4734,73.3949c-0.1194-0.1469-0.2485-0.277-0.3856-0.3879s-0.2822-0.2028-0.4336-0.2729s-0.3093-0.1188-0.4719-0.1434             c-0.0813-0.0123-0.1638-0.0186-0.2473-0.0186c-1.3356,0-2.4183,1.6135-2.4183,3.6039s1.0827,3.3781,2.4183,3.3781             c0.0835,0,0.166-0.0054,0.2473-0.0161c0.1626-0.0213,0.3204-0.0635,0.4719-0.1251c0.1514-0.0616,0.2965-0.1425,0.4336-0.2414             c0.137-0.0988,0.2661-0.2155,0.3856-0.3485c0.1194-0.133,0.2292-0.2823,0.3278-0.4464c0.345-0.5743,0.5522-1.3298,0.5522-2.2006             s-0.2072-1.6695-0.5522-2.2925C-67.2441,73.7054-67.354,73.5418-67.4734,73.3949z"/><path d="M-55.9415,72.5719c-1.3356,0-2.4183,1.6135-2.4183,3.6039s1.0826,3.3781,2.4183,3.3781s2.4183-1.3877,2.4183-3.3781             S-54.6058,72.5719-55.9415,72.5719z"/></g></symbol><symbol id="icon-stack" viewBox="-91 49.217 56.693 56.693" enable-background="new -91 49.217 56.693 56.693" xml:space="preserve"><g><rect x="-71.7079" y="71.981" transform="matrix(0.8613 0.508 -0.508 0.8613 29.0038 41.8064)" width="19.2464" height="4.1104"/><rect x="-74.6274" y="79.2883" transform="matrix(0.9657 0.2596 -0.2596 0.9657 18.8887 19.6645)" width="19.2462" height="4.1107"/><rect x="-75.8359" y="86.3297" transform="matrix(0.9958 0.0917 -0.0917 0.9958 7.83 6.4478)" width="19.246" height="4.111"/><rect x="-76.1525" y="92.4966" width="19.2466" height="4.111"/><path d="M-53.6363,99.8858h-25.2446v-16.805h-3.2878v20.0301h0.0327c0,0.0156,0.9598,0.0156,0.9598,0.0156h30.7952v-0.0156    c0.0324,0,0.0324-0.9601,0.0324-0.9601V83.0808h-3.2877V99.8858z"/><rect x="-65.4299" y="65.428" transform="matrix(-0.5634 -0.8262 0.8262 -0.5634 -143.0016 59.4012)" width="19.247" height="4.1099"/><rect x="-49.6262" y="54.5705" transform="matrix(0.9853 -0.171 0.171 0.9853 -11.6767 -7.1886)" width="4.1108" height="19.2461"/></g></symbol><symbol id="icon-linkedin" viewBox="0 0 56.693 56.693" enable-background="new 0 0 56.693 56.693" xml:space="preserve"><g><path d="M30.071,27.101v-0.077c-0.016,0.026-0.033,0.052-0.05,0.077H30.071z"/><path d="M49.265,4.667H7.145c-2.016,0-3.651,1.596-3.651,3.563v42.613c0,1.966,1.635,3.562,3.651,3.562h42.12             c2.019,0,3.654-1.597,3.654-3.562V8.23C52.919,6.262,51.283,4.667,49.265,4.667z M18.475,46.304h-7.465V23.845h7.465V46.304z              M14.743,20.777h-0.05c-2.504,0-4.124-1.725-4.124-3.88c0-2.203,1.67-3.88,4.223-3.88c2.554,0,4.125,1.677,4.175,3.88             C18.967,19.052,17.345,20.777,14.743,20.777z M45.394,46.304h-7.465V34.286c0-3.018-1.08-5.078-3.781-5.078             c-2.062,0-3.29,1.389-3.831,2.731c-0.197,0.479-0.245,1.149-0.245,1.821v12.543h-7.465c0,0,0.098-20.354,0-22.459h7.465v3.179             c0.992-1.53,2.766-3.709,6.729-3.709c4.911,0,8.594,3.211,8.594,10.11V46.304z"/></g></symbol><symbol id="icon-whatsapp" viewBox="0 0 56.693 56.693" xml:space="preserve"><g><path class="st0" d="M46.3802,10.7138c-4.6512-4.6565-10.8365-7.222-17.4266-7.2247c-13.5785,0-24.63,11.0506-24.6353,24.6333             c-0.0019,4.342,1.1325,8.58,3.2884,12.3159l-3.495,12.7657l13.0595-3.4257c3.5982,1.9626,7.6495,2.9971,11.7726,2.9985h0.01             c0.0008,0-0.0006,0,0.0002,0c13.5771,0,24.6293-11.0517,24.635-24.6347C53.5914,21.5595,51.0313,15.3701,46.3802,10.7138z              M28.9537,48.6163h-0.0083c-3.674-0.0014-7.2777-0.9886-10.4215-2.8541l-0.7476-0.4437l-7.7497,2.0328l2.0686-7.5558             l-0.4869-0.7748c-2.0496-3.26-3.1321-7.028-3.1305-10.8969c0.0044-11.2894,9.19-20.474,20.4842-20.474             c5.469,0.0017,10.6101,2.1344,14.476,6.0047c3.8658,3.8703,5.9936,9.0148,5.9914,14.4859             C49.4248,39.4307,40.2395,48.6163,28.9537,48.6163z"/><path class="st0" d="M40.1851,33.281c-0.6155-0.3081-3.6419-1.797-4.2061-2.0026c-0.5642-0.2054-0.9746-0.3081-1.3849,0.3081             c-0.4103,0.6161-1.59,2.0027-1.9491,2.4136c-0.359,0.4106-0.7182,0.4623-1.3336,0.1539c-0.6155-0.3081-2.5989-0.958-4.95-3.0551             c-1.83-1.6323-3.0653-3.6479-3.4245-4.2643c-0.359-0.6161-0.0382-0.9492,0.27-1.2562c0.2769-0.2759,0.6156-0.7189,0.9234-1.0784             c0.3077-0.3593,0.4103-0.6163,0.6155-1.0268c0.2052-0.4109,0.1027-0.7704-0.0513-1.0784             c-0.1539-0.3081-1.3849-3.3379-1.8978-4.5706c-0.4998-1.2001-1.0072-1.0375-1.3851-1.0566             c-0.3585-0.0179-0.7694-0.0216-1.1797-0.0216s-1.0773,0.1541-1.6414,0.7702c-0.5642,0.6163-2.1545,2.1056-2.1545,5.1351             c0,3.0299,2.2057,5.9569,2.5135,6.3676c0.3077,0.411,4.3405,6.6282,10.5153,9.2945c1.4686,0.6343,2.6152,1.013,3.5091,1.2966             c1.4746,0.4686,2.8165,0.4024,3.8771,0.2439c1.1827-0.1767,3.6419-1.489,4.1548-2.9267c0.513-1.438,0.513-2.6706,0.359-2.9272             C41.211,33.7433,40.8006,33.5892,40.1851,33.281z"/></g></symbol><symbol id="icon-inbox" viewBox="0 0 56.7 56.7" xml:space="preserve"><g><path d="M23.0224,17.7972c-0.1953-0.1953-0.5117-0.1953-0.707,0l-3.0322,3.0317c-0.0938,0.0938-0.1465,0.2207-0.1465,0.3535             s0.0527,0.2598,0.1465,0.3535l8.8838,8.8833c0.0977,0.0977,0.2256,0.1465,0.3535,0.1465s0.2559-0.0488,0.3535-0.1465             l17.7549-17.7549c0.1953-0.1953,0.1953-0.5117,0-0.707l-3.0317-3.0322c-0.0938-0.0938-0.2207-0.1465-0.3535-0.1465             S42.9838,8.8314,42.89,8.9251L28.5204,23.2952L23.0224,17.7972z"/><path d="M53.0978,23.701c-0.0001-0.0004-0.0005-0.0007-0.0007-0.0011c-0.2549-0.7663-0.7205-1.4108-1.348-1.8636l-7.4805-5.3976             l-1.4325,1.4325l7.6515,5.5209l0.0911,0.0657c0.0811,0.0586,0.1426,0.1412,0.2119,0.2148c0.0166,0.0176,0.035,0.033,0.0508,0.0515             c0.0707,0.2159-0.0034,0.4578-0.2056,0.5809L5.6591,51.6898c0.4562,0.1978,0.9576,0.31,1.4856,0.31h42.4102             c2.0679,0,3.7505-1.6821,3.7505-3.75V24.8773C53.3053,24.5067,53.2374,24.1219,53.0978,23.701z"/><path d="M5.9092,23.6724c0.069-0.0732,0.1304-0.1557,0.2111-0.2141L27.3253,8.1575c0.6133-0.4424,1.4355-0.4424,2.0488,0             l7.4755,5.394l1.4325-1.4326l-7.738-5.5835c-1.3125-0.9473-3.0762-0.9473-4.3887,0L4.9499,21.8367             c-0.6257,0.452-1.0917,1.0956-1.3472,1.8622c-0.0002,0.0005-0.0007,0.001-0.0009,0.0015c-0.1392,0.4199-0.207,0.8047-0.207,1.1768             v23.3726c0,1.1402,0.5223,2.1506,1.3278,2.8389L27.83,37.0193L5.9092,23.6724z"/></g></symbol><symbol id="icon-telegram" viewBox="0 0 300 300" xml:space="preserve"><g id="XMLID_496_"><path d="M5.299,144.645l69.126,25.8l26.756,86.047c1.712,5.511,8.451,7.548,12.924,3.891l38.532-31.412
                 c4.039-3.291,9.792-3.455,14.013-0.391l69.498,50.457c4.785,3.478,11.564,0.856,12.764-4.926L299.823,29.22
                 c1.31-6.316-4.896-11.585-10.91-9.259L5.218,129.402C-1.783,132.102-1.722,142.014,5.299,144.645z M96.869,156.711l135.098-83.207
                 c2.428-1.491,4.926,1.792,2.841,3.726L123.313,180.87c-3.919,3.648-6.447,8.53-7.163,13.829l-3.798,28.146
                 c-0.503,3.758-5.782,4.131-6.819,0.494l-14.607-51.325C89.253,166.16,91.691,159.907,96.869,156.711z"/></g></symbol><symbol id="flag-es" viewBox="0 0 640 480" xml:space="preserve"><rect width="750" height="500" fill="#c60b1e"/><rect width="750" height="250" fill="#ffc400" y="125"/></symbol><symbol id="flag-en" viewBox="0 0 640 480"><defs><clipPath id="a"><path fill-opacity=".67" d="M-85.333 0h682.67v512h-682.67z"/></clipPath></defs><g clip-path="url(#a)" transform="translate(80) scale(.94)"><g stroke-width="1pt"><path fill="#006" d="M-256 0H768.02v512.01H-256z"/><path d="M-256 0v57.244l909.535 454.768H768.02V454.77L-141.515 0H-256zM768.02 0v57.243L-141.515 512.01H-256v-57.243L653.535 0H768.02z" fill="#fff"/><path d="M170.675 0v512.01h170.67V0h-170.67zM-256 170.67v170.67H768.02V170.67H-256z" fill="#fff"/><path d="M-256 204.804v102.402H768.02V204.804H-256zM204.81 0v512.01h102.4V0h-102.4zM-256 512.01L85.34 341.34h76.324l-341.34 170.67H-256zM-256 0L85.34 170.67H9.016L-256 38.164V0zm606.356 170.67L691.696 0h76.324L426.68 170.67h-76.324zM768.02 512.01L426.68 341.34h76.324L768.02 473.848v38.162z" fill="#c00"/></g></g></symbol></defs></svg><div id="fade" class="overlay"></div><amp-sidebar id="sidebar" layout="nodisplay" side="right"><a on="tap:sidebar.close" class="amp-close-image" role="button" tabindex="0"><svg id="open" class="icon-menu"><use xlink:href="#icon-close"></use></svg></a><nav id="navigation"><h2>Menú</h2><ul><li><a href="https://elbauldelprogramador.com/categories/">Categorías</a></li><li><a href="https://elbauldelprogramador.com/tags/">Tags</a></li><li><a href="https://elbauldelprogramador.com/cursos/">Cursos</a></li><li><a href="https://elbauldelprogramador.com/manuales-gratuitos/">Manuales</a></li><li><a href="https://elbauldelprogramador.com/categories/security-now/">Security Now!</a></li><li><a href="https://elbauldelprogramador.com/libros-recomendados/">Libros</a></li><li><a href="https://elbauldelprogramador.com/apoyanos/">Apoyanos</a></li><li><a href="https://elbauldelprogramador.com/contacto/">Contacto</a></li></ul></nav></amp-sidebar><a id="search" class="dosearch" href="https://elbauldelprogramador.com/buscar"><svg class="icon-search"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-search"></use></svg> </a><a on="tap:sidebar.toggle" id="slide" class="slideButton fade"><svg id="close" class="icon-menu"><use xlink:href="#icon-close"></use></svg> <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg></a><header class="header-post" role="banner"><div class="content"><time datetime="2017-10-05T12:23:49JST" class="date">Actualizado el Oct 5, 2017</time><h1 class="post-title">Instalación y optimización de un servidor web con Nginx (III)</h1><p class="subtitle">A lo largo de esta guía se pretende mostrar cómo instalar desde cero un servidor web con Nginx, realizando las operaciones necesarias para lograr el mayor rendimiento y seguridad posibles con programas tales como php-fpm, APC, y el módulo pagespeed de Google para optimizar los recursos web.</p><p>Tiempo aprox ~ 11 m. (2133 palabras.)</p></div></header><section class="post"><article role="article" id="post" class="post-content"><section class="author"><div class="details"><div id="author-photo"><amp-img layout="responsive" width="150px" height="150px" class="img-rounded" src="/img/alejandro.jpg"></amp-img></div><div><p class="def">Autor</p><h3 class="name"><a title="Ver todos los artículos de Alejandro Alcalde" id="author-name" href="https://elbauldelprogramador.com/author/alex/">Alejandro Alcalde</a></h3><p class="desc">Graduado en Ingeniería Informática en la ETSIIT, Granada. Creador de El Baúl del Programador</p><p class="desc"><a href="https://elbauldelprogramador.com/author/alex/">Más artículos de Alejandro Alcalde</a></p><div class="share"><a href="mailto:contacto@elbauldelprogramador.com"><svg class="social icon-mail"><use xlink:href="#icon-inbox"></use></svg></a><a href="http://twitter.com/elbaulp" target="_blank"><svg class="social icon-twitter"><use xlink:href="#icon-twitter"></use></svg></a><a href="http://facebook.com/elbaulp" target="_blank"><svg class="social icon-facebook"><use xlink:href="#icon-facebook"></use></svg></a><a href="http://plus.google.com/+elbauldelprogramador" target="_blank"><svg class="social icon-google-plus"><use xlink:href="#icon-google-plus"></use></svg></a><a href="http://github.com/elbaulp" target="_blank"><svg class="social icon-github"><use xlink:href="#icon-github"></use></svg></a><a href="http://stackoverflow.com/users/1612432/elbaulp" target="_blank"><svg class="social icon-stack-overflow"><use xlink:href="#icon-stack"></use></svg></a><a href="https://www.linkedin.com/in/algui91" target="_blank"><svg class="social icon-linkedin"><use xlink:href="#icon-linkedin"></use></svg></a><a href="https://telegram.me/elbaulp" target="_blank"><svg class="social icon-telegram"><use xlink:href="#icon-telegram"></use></svg></a></div></div></div></section><p></p><blockquote><strong>¿Has visto algún error?</strong>: Por favor, ayúdame a corregirlo <a href="/contacto/">contactando</a> conmigo.</blockquote><p></p><div id="toc"><h1>Índice</h1><nav id="TableOfContents"><ul><li><a href="#tabla-de-contenidos">Tabla de contenidos</a><ul><li><a href="#optimizando">Optimizando</a><ul><li><a href="#pools-en-php">Pools en PHP</a><ul><li><a href="#primer-método">Primer método</a></li><li><a href="#segundo-método">Segundo método</a></li><li><a href="#tercer-método">Tercer método</a></li></ul></li><li><a href="#optimizando-nginx">Optimizando Nginx</a></li><li><a href="#page-speed">Page Speed</a><ul><li><a href="#preparando-el-entorno">Preparando el entorno</a></li><li><a href="#configurando-pagespeed">Configurando PageSpeed</a></li></ul></li></ul></li><li><a href="#apc">APC</a><ul><li><a href="#instalando-y-configurando-apc">Instalando y configurando APC</a></li></ul></li><li><a href="#consideraciones-sobre-seguridad">Consideraciones sobre seguridad</a></li></ul></li><li><a href="#tabla-de-contenidos-1">Tabla de contenidos</a></li></ul></nav></div><h1 id="tabla-de-contenidos">Tabla de contenidos</h1><ul><li><a href="https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i" title="Instalación y optimización de un servidor web con Nginx (I)">Instalación y optimización de un servidor web con Nginx (I)</a></li><li><a href="https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii" title="Instalación y optimización de un servidor web con Nginx (II)">Instalación y optimización de un servidor web con Nginx (II)</a></li><li>Instalación y optimización de un servidor web con Nginx (III)</li></ul><p>En éste último artículo se verá cómo realizar optimizaciones al servidor web nginx, PHP y se cubrirá la instalación del sistema de caches APC y el módulo Page Speed de Google.</p><p></p><hr><div class="support-us"><p><strong>¿Te gusta el blog? Ayúdame a seguir escribiendo</strong></p><ul><li>Añádeme a la “Lista blanca” de tu <strong>bloqueador de anuncios</strong></li><li><a href="https://elbauldelprogramador.com/why-am-i-removing-google-analytics/">Por qué renuncio a <strong>Google Analytics</strong></a></li><li><a href="https://www.amazon.es/?&amp;tag=bmab-21&amp;camp=4586&amp;creative=670922&amp;linkCode=ur1&amp;adid=01FEFB5JJ9GNJJX2T2CR&amp;">Usa mi enlace de <strong>Ámazon</strong></a></li><li><a href="https://elbauldelprogramador.com/manuales-gratuitos/">Descarga una <strong>guía gratuita</strong></a></li><li><a href="https://elbauldelprogramador.com/apoyanos/">Más formas de <strong>apoyarme</strong></a></li></ul><div id="ad-slot"><amp-ad width="300" height="250" type="adsense" data-ad-client="ca-pub-9043332344373532" data-ad-slot="2633319248" layout="responsive"></amp-ad></div></div><hr><p></p><h2 id="optimizando">Optimizando</h2><h3 id="pools-en-php">Pools en PHP</h3><p>La configuración por defecto de PHP no suele ser la óptima, dependiendo de nuestras necesidades y hardware deberemos ajustar algunos parámetros. En esta sección nos centraremos en el número de procesos y recursos que se dedicarán a una aplicación web. Estos parámetros se encuentran en el directorio <em>/etc/php/fpm/pools.d</em>, se debe tener una archivo por cada aplicación, en nuestro caso será <em>www.conf</em>. Los parámetros a ajustar son:</p><ul><li><strong>pm</strong>: Decide cómo el controlador de procesos administra los procesos hijos, es recomendable establecerlo a dinámico.</li><li><strong>pm.max_children</strong>: Cuando pm es estático, el número de hijos a crear, cuando es dinámico, el máximo número de hijos que se podrán tener.</li><li><strong>pm.start_servers</strong>: Número de hijos a crear al inicio.</li><li><strong>pm.min_spare_servers</strong>: El número mínimo de procesos libres (Sin hacer nada).</li><li><strong>pm.max_spare_servers</strong>: Número máximo de procesos libres.</li></ul><p><strong>pm.max_requests</strong>: El número de peticiones que cada hijo aceptará antes de reiniciarse, útil para evitar pérdidas de memoria.</p><p>Hay varias aproximaciones para determinar el valor adecuado de estos parámetros, en esta guía se verán 3, y todas con <em>pm = dynamic</em>.</p><h4 id="primer-método">Primer método</h4><p>El primero (<a href="http://nls.io/optimize-nginx-and-php-fpm-max_children/" title="Optimize nginx and PHP-FPM (max_children)" target="_blank">Guillaume Moigneu</a>) consiste en calcular <em>pm.max_children</em> basándonos en la fórmula:</p><p>\[pm.max\_children = (RAM_{total} - RAM_{resto Proc})/ RAM_{mediaPHP}\]</p><p>Donde \(RAM_{restoProc}\) es la memoria usada por los otros procesos y \(RAM_{mediaPHP}\) es la media de memoria usada por los procesos de PHP. La memoria consumida por el resto de procesos se puede calcular mediante este comando:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ps -ylA --sort:rss <span class="p">|</span> grep -v php5-fpm <span class="p">|</span> awk <span class="s1">&#39;!/RSS/ { s+=$8 } END { printf &#34;%s\n&#34;, &#34;Memoria total usada por otros procesos&#34;; printf &#34;%dM\n&#34;, s/1024 }&#39;</span></code></pre></div><p>Y la consumida por PHP:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ps -ylC php5-fpm --sort:rss  <span class="p">|</span> awk <span class="s1">&#39;!/RSS/ { s+=$8 } END { printf &#34;%s\n&#34;, &#34;Memoria consumida por PHP: &#34;; printf &#34;%dM\n&#34;, s/1024 }&#39;</span></code></pre></div><p>Al número anterior lo dividimos por los procesos de PHP y obtenemos la media. Una vez calculado el valor de <em>max_children</em>, <em>min_spare_servers</em> y <em>max_spare_servers</em> se suelen calcular evaluando el rendimiento y <em>start_servers</em>, suele ser:</p><p>\[start\_servers = \frac{min\_spare\_servers + (max\_spare\_servers - min\_spare\_servers)}{2}\]</p><h4 id="segundo-método">Segundo método</h4><p>El segundo método (<a href="http://myshell.co.uk/index.php/adjusting-child-processes-for-php-fpm-nginx/" title="Adjusting child processes for PHP-FPM (Nginx)" target="_blank">myshell.co.uk</a>) es calcularlo en base a:</p><p>\[pm.max\_children = RAM_{total} / RAM_{maxPHP}\]</p><p>Donde \(RAM_{maxPHP}\) es el process PHP que ocupe más memoria. El resto de parámetros se calculan en base a éste.</p><h4 id="tercer-método">Tercer método</h4><p>Por último, otro método (<a href="https://github.com/perusio/php-fpm-example-config" title="Example configuration of php-fpm" target="_blank">Perusio</a>) es realizando la operación siguiente:</p><p>\[pm.max\_children = 1.2 \cdot RAM_{total}/RAM_{mediaPHP}\]</p><h3 id="optimizando-nginx">Optimizando Nginx</h3><p>FastCGI es un protocolo que hace de interfaz entre programas y servidores web. En esta sección veremos cómo configurar nginx para cachear páginas y aumentar su rendimiento.</p><p>Para aprovechar todos los núcleos de un procesador, nginx necesita ajustar el parámetro <em>worker_processes</em> acorde al número de procesadores. Para determinar el número de procesadores podemos ejecutar el siguiente comando:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">cat /proc/cpuinfo<span class="p">|</span> grep processor <span class="p">|</span> wc -l</code></pre></div><p>En la directiva <em>worker_connections</em> dentro del bloque <em>events</em> escribiremos un 1024. Con esto nginx tendrá un proceso por núcleo y cada proceso podrá procesar hasta 1024 conexiones.</p><p>Estableceremos ahora los parámetros que permitirán cachear los resultados para servirlos más rápido al cliente, para ello haremos uso de las directivas <em>fastcgi_cache</em>. En el bloque <em>http</em> necesitaremos:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">fastcgi_cache_path /var/cache/nginx <span class="nv">levels</span><span class="o">=</span><span class="m">1</span>:2 <span class="nv">keys_zone</span><span class="o">=</span>microcache:500m <span class="nv">max_size</span><span class="o">=</span>1000m <span class="nv">inactive</span><span class="o">=</span>60m<span class="p">;</span>
fastcgi_cache_key <span class="s2">&#34;</span><span class="nv">$scheme$request_method$host$request_uri</span><span class="s2">&#34;</span><span class="p">;</span>
fastcgi_cache_use_stale updating error timeout invalid_header http_500<span class="p">;</span></code></pre></div><p>Lo cual establece el directorio donde se guardarán los objetos cacheados, los niveles de cache, un nombre y el espacio reservado (500Mb), así como un tope máximo (1Gb). La segunda directiva establece bajo qué nombre se almacenará la clave para la cache. Por último la tercera servirá contenido antiguo en la caché cuando haya errores en el servidor web, cuando se esté actualizando la caché, cuando haya errores del tipo 5xx o cuando la cabecera de la petición sea inválida.</p><p>El siguiente paso es decidir qué objetos se almacenarán en caché y cuales no. Para ello, dentro de un bloque <em>server</em> escribiremos:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">set</span> <span class="nv">$no_cache</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="nv">$request_method</span> <span class="o">=</span> POST<span class="o">)</span> <span class="o">{</span> <span class="nb">set</span> <span class="nv">$no_cache</span> <span class="m">1</span><span class="p">;</span> <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="nv">$query_string</span> !<span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="o">)</span> <span class="o">{</span> <span class="nb">set</span> <span class="nv">$no_cache</span> <span class="m">1</span><span class="p">;</span> <span class="o">}</span>
    location ~ <span class="se">\.</span>php$ <span class="o">{</span>
      <span class="c1"># ....
</span><span class="c1"></span>      fastcgi_cache_bypass <span class="nv">$no_cache</span><span class="p">;</span>
      fastcgi_no_cache <span class="nv">$no_cache</span><span class="p">;</span>
      fastcgi_cache microcache<span class="p">;</span>
      fastcgi_cache_valid 60m<span class="p">;</span>
    <span class="o">}</span></code></pre></div><p>En esta porción de código hemos declarado una variable que determinará qué peticiones se cachean y cuales no. No cachearemos ninguna petición POST ni nada que tenga consultas en la URL (?arg&#8230;&arg1;&#8230;). Con ayuda de esta variable podremos decidir en el bloque <em>location</em> si cacheamos la petición (directivas bypass y no_cache), aquí hacemos referencia al nombre que dimos anteriormente al espacio de caché y fijamos un periodo de validez.</p><h3 id="page-speed">Page Speed</h3><p>En esta sección veremos cómo compilar y configurar el módulo desarrollado por Google que optimizará al máximo todos los recursos de nuestra web, minimizando considerablemente el tiempo de respuesta y aplicando algunos cambios a los archivos para que cumplan con los estándares de rendimiento que Google usa para puntuar las páginas web.</p><p>Algunas de las características que ofrece son comprimir los archivos CSS y JavaScript de forma que ocupen lo menos posible. Unificar (cuando sea posible) la mayor cantidad de archivos CSS y JS en uno solo para reducir el número de peticiones al servidor. Optimizar las imágenes para reducir su tamaño. Cargar de forma asíncrona los programas JS. Mover los elementos bloqueantes que impiden que la página se renderize correctamente a lugares donde no sean perjudiciales para el renderizado. Éstas son solo algunas de las funcionalidades principales.</p><h4 id="preparando-el-entorno">Preparando el entorno</h4><p>Antes de poder compilar, será necesario instalar algunas dependencias:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">apt-get install build-essential zlib1g-dev libpcre3 libpcre3-dev</code></pre></div><p>Una vez hecho, estamos en condiciones para descargar y compilar:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> ~
wget https://github.com/pagespeed/ngx_pagespeed/archive/v1.7.30.1-beta.zip
unzip v1.7.30.1-beta.zip <span class="c1"># or unzip v1.7.30.1-beta
</span><span class="c1"></span><span class="nb">cd</span> ngx_pagespeed-1.7.30.1-beta/
wget https://dl.google.com/dl/page-speed/psol/1.7.30.1.tar.gz
tar -xzvf <span class="m">1</span>.7.30.1.tar.gz</code></pre></div><p>Hecho esto, será necesario recompilar nginx con este módulo, como comentamos al inicio de esta guía, para ello simplemente ejecutamos:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">nginx -V <span class="c1"># Para ver con qué módulos está compilado el ejecutable actual
</span><span class="c1"></span>configure arguments: --with-http_gzip_static_module --sbin-path<span class="o">=</span>/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module
<span class="nb">cd</span> ~/nginx-1.4.4/ <span class="c1"># compilaremos nginx con el nuevo módulo (--ad-module)
</span><span class="c1"></span>./configure --with-http_gzip_static_module --sbin-path<span class="o">=</span>/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module --add-module<span class="o">=</span><span class="nv">$HOME</span>/ngx_pagespeed-1.7.30.1-beta
make -j <span class="m">4</span> <span class="c1"># compilamos
</span><span class="c1"></span>service nginx destroy <span class="c1"># detenemos la instancia actual de nginx
</span><span class="c1"></span>make install # instalamos la nueva versión con pagespeed</code></pre></div><h4 id="configurando-pagespeed">Configurando PageSpeed</h4><p>Solo resta configurar nginx para activar <em>pagespeed</em> con los filtros deseados. La documentación se puede encontrar en <a href="https://developers.google.com/speed/pagespeed/module/config_filters" title="Configuring PageSpeed Filters" target="_blank">Configuring PageSpeed Filters</a>. Por defecto los filtros habilitados son:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">add_head
combine_css
combine_javascript
convert_meta_tags
extend_cache
fallback_rewrite_css_urls
flatten_css_imports
inline_css
inline_import_to_link
inline_javascript
rewrite_css
rewrite_images
rewrite_javascript
rewrite_style_attributes_with_url</code></pre></div><p>Veamos cómo habilitar pagespeed en nginx, para ello crearemos un fichero y un directorio en <em>/usr/local/nginx/conf/global/pagespeed.conf</em> conteniendo:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">pagespeed on<span class="p">;</span>

<span class="c1"># Needs to exist and be writable by nginx.
</span><span class="c1"></span>pagespeed FileCachePath /var/ngx_pagespeed_cache<span class="p">;</span>

<span class="c1"># Ensure requests for pagespeed optimized resources go to the pagespeed handler
</span><span class="c1"># and no extraneous headers get set.
</span><span class="c1"></span>location ~ <span class="s2">&#34;\.pagespeed\.([a-z]\.)?[a-z]{2}\.[^.]{10}\.[^.]+&#34;</span> <span class="o">{</span>
      add_header <span class="s2">&#34;&#34;</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
<span class="o">}</span>
location ~ <span class="s2">&#34;^/ngx_pagespeed_static/&#34;</span> <span class="o">{</span> <span class="o">}</span>
location ~ <span class="s2">&#34;^/ngx_pagespeed_beacon</span>$<span class="s2">&#34;</span> <span class="o">{</span> <span class="o">}</span>

<span class="c1"># This page shows statistics about the ngx_pagespeed module.
</span><span class="c1"></span>location /ngx_pagespeed_statistics <span class="o">{</span>
    allow <span class="m">127</span>.0.0.1<span class="p">;</span>
    allow TuIP<span class="p">;</span>
    deny all<span class="p">;</span>
<span class="o">}</span>

<span class="c1"># Recent log messages. Like statistics, these are generally not to be shown
</span><span class="c1"># to the public, so this has access controls as well.
</span><span class="c1"></span>pagespeed MessageBufferSize <span class="m">100000</span><span class="p">;</span>
location /ngx_pagespeed_message <span class="o">{</span>
    allow <span class="m">127</span>.0.0.1<span class="p">;</span>
<span class="c1">#    allow TuIP;
</span><span class="c1"></span>    deny all<span class="p">;</span>
<span class="o">}</span>

<span class="c1"># This page lets you view a graphical console displaying statistics about
</span><span class="c1"># the ngx_pagespeed module.  As with statistics and messages, you may
</span><span class="c1"># want access control.
</span><span class="c1"></span>pagespeed Statistics on<span class="p">;</span>
pagespeed StatisticsLogging on<span class="p">;</span>
pagespeed LogDir /var/log/pagespeed<span class="p">;</span>
pagespeed StatisticsLoggingIntervalMs <span class="m">60000</span><span class="p">;</span>
pagespeed StatisticsLoggingMaxFileSizeKb <span class="m">1024</span><span class="p">;</span>
location /pagespeed_console <span class="o">{</span>
    allow <span class="m">127</span>.0.0.1<span class="p">;</span>
<span class="c1">#    allow TuIP;
</span><span class="c1"></span>    deny all<span class="p">;</span>
<span class="o">}</span>

<span class="c1"># Honoring no-transform Cache-Control Headers
</span><span class="c1"></span>pagespeed DisableRewriteOnNoTransform off<span class="p">;</span>
pagespeed RewriteLevel CoreFilters<span class="p">;</span>

<span class="c1"># Specifying the value for the PageSpeed header
</span><span class="c1"></span>pagespeed XHeaderValue <span class="s2">&#34;Gracias a ngx_pagespeed&#34;</span><span class="p">;</span></code></pre></div><p>Esto debería ser suficiente para la mayoría de webs, es posible habilitar más filtros usando la directiva <em>pagespeed EnableFilters</em>.</p><p>Por último hay que añadir la configuración a nginx, dentro del bloque <em>server</em> que deseemos incluimos la línea <em>include global/pagespeed.conf;</em> y recargamos la configuración de nginx:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">service nginx reload</code></pre></div><p>Podemos comprobar que todo funciona correctamente ojeando las cabeceras de la respuesta del servidor como se muestra en la figura:</p><figure><a href="/img/2014/02/pagespeed.png"><amp-img sizes="(min-width: 255px) 255px, 100vw" on="tap:lightbox1" role="button" tabindex="0" layout="responsive" src="/img/2014/02/pagespeed.png" title="Configuración pagespeed nginx" alt="Configuración pagespeed nginx" width="255px" height="135px"></a></figure><p>Como vemos, la cabecera de pagespeed está presente, luego está habilitado.</p><h2 id="apc">APC</h2><p>APC viene de Alternative PHP Cache y es un opcode libre y gratuito para PHP. Su objetivo es proporcionar un marco robusto, libre y abierto para optimizar código intermedio de PHP mediante su almacenamiento en caché.</p><h3 id="instalando-y-configurando-apc">Instalando y configurando APC</h3><p>Para instalarlo basta con ejecutar:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">apt-get install php-apc</code></pre></div><p>El archivo de configuración reside en <em>/etc/php5/fpm/conf.d/apc.ini</em>, un ejemplo de configuración es el siguiente:</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">apc.enabled<span class="o">=</span><span class="m">1</span>
apc.shm_segments<span class="o">=</span><span class="m">1</span>
apc.shm_size<span class="o">=</span>128M
<span class="p">;</span>Relative to the number of cached files <span class="o">(</span>you may need to watch your stats <span class="k">for</span> a day or two to find out a good number<span class="o">)</span>
apc.num_files_hint<span class="o">=</span><span class="m">768</span>

<span class="p">;</span>Relative to the size of your site
apc.user_entries_hint<span class="o">=</span><span class="m">4096</span>

<span class="p">;</span>The number of seconds a cache entry is allowed to idle in a slot before APC dumps the cache
apc.ttl<span class="o">=</span><span class="m">7200</span>
apc.user_ttl<span class="o">=</span><span class="m">7200</span>
apc.gc_ttl<span class="o">=</span><span class="m">3600</span>

<span class="p">;</span>Setting this to <span class="m">0</span> will give you the best performance, as APC will
<span class="p">;</span>not have to check the IO <span class="k">for</span> changes. However, you must clear
<span class="p">;</span>the APC cache to recompile already cached files. If you are still
<span class="p">;</span>developing, updating your site daily in WP-ADMIN, and running W3TC
<span class="p">;</span><span class="nb">set</span> this to <span class="m">1</span>
apc.stat<span class="o">=</span><span class="m">0</span>

<span class="p">;;</span>This MUST be <span class="m">0</span>, WP can have errors otherwise!
apc.include_once_override<span class="o">=</span><span class="m">0</span>

<span class="p">;</span>Only <span class="nb">set</span> to <span class="m">1</span> <span class="k">while</span> debugging
apc.enable_cli<span class="o">=</span><span class="m">0</span>

<span class="p">;</span>Allow <span class="m">2</span> seconds after a file is created before it is cached to prevent users from seeing half-written/weird pages
apc.file_update_protection<span class="o">=</span><span class="m">2</span>

<span class="p">;</span>Leave at 2M or lower. WordPress doest have any file sizes close to 2M
apc.max_file_size<span class="o">=</span>1M

apc.cache_by_default<span class="o">=</span><span class="m">1</span>
apc.use_request_time<span class="o">=</span><span class="m">1</span>
apc.slam_defense<span class="o">=</span><span class="m">0</span>
apc.mmap_file_mask<span class="o">=</span>/tmp/apc.XXXXXX
apc.stat_ctime<span class="o">=</span><span class="m">0</span>
apc.canonicalize<span class="o">=</span><span class="m">1</span>
apc.write_lock<span class="o">=</span><span class="m">1</span>
apc.report_autofilter<span class="o">=</span><span class="m">0</span>
apc.rfc1867<span class="o">=</span><span class="m">0</span>
apc.rfc1867_prefix <span class="o">=</span>upload_
apc.rfc1867_name<span class="o">=</span>APC_UPLOAD_PROGRESS
apc.rfc1867_freq<span class="o">=</span><span class="m">0</span>
apc.rfc1867_ttl<span class="o">=</span><span class="m">3600</span>
apc.lazy_classes<span class="o">=</span><span class="m">0</span>
apc.lazy_functions<span class="o">=</span><span class="m">0</span>

apc.localcache <span class="o">=</span> <span class="s2">&#34;1&#34;</span>
<span class="p">;</span>The size of the <span class="nb">local</span> process shadow-cache, should be <span class="nb">set</span> to a sufficiently large value, approximately half of apc.num_files_hint.
apc.localcache.size <span class="o">=</span> <span class="s2">&#34;384&#34;</span></code></pre></div><p><a href="https://elbauldelprogramador.com/solucionar-fallo-de-segmentacion-en-php-cuando-se-usa-apc/" title="Solucionar fallo de segmentación en PHP cuando se usa APC">APC</a> proporciona una mejora considerable en cuanto al rendimiento, ya que no es necesario volver a interpretar el código PHP cada vez que el servidor recibe una petición, el código quedará compilado en cache listo para ser servido. Uno de los parámetros más importantes es <em>apc.shm_size=</em>, el cual establece el tamaño reservado para la caché.</p><h2 id="consideraciones-sobre-seguridad">Consideraciones sobre seguridad</h2><p>Algunos valores por defecto de la configuración de nginx no son adecuados en términos de seguridad, basándonos en las recomendaciones de <a href="http://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html" title="Top 20 Nginx WebServer Best Security Practices" target="_blank">NIX Craft</a> podemos ajustar éstos parámetros según nuestras necesidades para obtener una mayor seguridad frente a ataques. Todos estos parámetros irán en el bloque <em>http</em> de nginx.</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">## Start: Size Limits &amp; Buffer Overflows ##
</span><span class="c1"></span>      client_body_buffer_size  8K<span class="p">;</span>
      client_header_buffer_size 1k<span class="p">;</span>
      client_max_body_size 1m<span class="p">;</span>
      large_client_header_buffers <span class="m">2</span> 1k<span class="p">;</span>
    <span class="c1">## END: Size Limits &amp; Buffer Overflows ##
</span><span class="c1"></span>
    <span class="c1">## Start: Timeouts ##
</span><span class="c1"></span>      client_body_timeout   <span class="m">10</span><span class="p">;</span>
      client_header_timeout <span class="m">10</span><span class="p">;</span>
      keepalive_timeout     <span class="m">5</span> <span class="m">5</span><span class="p">;</span>
      send_timeout          <span class="m">10</span><span class="p">;</span>
    <span class="c1">## End: Timeouts ##
</span><span class="c1"></span>
    <span class="c1">### Directive describes the zone, in which the session states are stored i.e. store in slimits. ###
</span><span class="c1"></span>    <span class="c1">### 1m can handle 32000 sessions with 32 bytes/session, set to 5m x 32000 session ###
</span><span class="c1"></span>      limit_conn_zone <span class="nv">$binary_remote_addr</span> <span class="nv">zone</span><span class="o">=</span>addr:5m<span class="p">;</span>

    <span class="c1">### Control maximum number of simultaneous connections for one session i.e. ###
</span><span class="c1"></span>    <span class="c1">### restricts the amount of connections from a single ip address ###
</span><span class="c1"></span>      limit_conn addr <span class="m">10</span><span class="p">;</span></code></pre></div><p>Una breve explicación del propósito de cada directiva:</p><ul><li><strong>client_body_buffer_size</strong>: El tamaño máximo del buffer de petición del cliente.</li><li><strong>client_header_buffer_size</strong>: Normalmente el tamaño de las cabeceras de la mayoría de peticiones son inferiores a 1k, si hay problemas deberemos subir el valor.</li><li><strong>client_max_body_size</strong>: Si vamos a aceptar que se suban archivos a nuestra web, este valor debería ser dado en Megas, de lo contrario podremos establecer un valor bajo, como 1k.</li><li><strong>large_client_header_buffers</strong>: Número máximo y tamaño de los buffers para peticiones que tengan cabeceras de mayor tamaño enviadas por el cliente. Útil para combatir bad bots y ataques DoS.</li><li><strong>client_body_timeout</strong>: Establece el tiempo de espera para leer el cuerpo de la petición del cliente. Si tras pasar el tiempo el cliente no envía nada, nginx devolverá un error 408 (Request timeout).</li><li><strong>client_header_timeout</strong>: Similar al anterior pero para la cabecera.</li><li><strong>keepalive_timeout</strong>: El primer parámetro asigna el tiempo de espera para mantener la conexión activa con el cliente, el servidor cerrará la conxión tras pasar éste tiempo. El segundo parámetro establece el valor de la cabecera <em>Keep-Alive:timeout=time</em> en la respuesta del servidor, esta cabecera puede hacer que algunos navegadore cierren la conexión para que no sea el servidor el que tenga que hacerlo.</li><li><strong>send_timeout</strong>: Asigna el tiempo de espera al cliente.</li><li><strong>limit_conn_zone</strong>: Controla el número de conexiones simultaneas de un mismo cliente.</li></ul><p>Con esto concluyen los tres artículos sobre instalación y optimización de un servidor web con nginx, espero que haya resultado útil.</p><h1 id="tabla-de-contenidos-1">Tabla de contenidos</h1><ul><li><a href="https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i" title="Instalación y optimización de un servidor web con Nginx (I)">Instalación y optimización de un servidor web con Nginx (I)</a></li><li><a href="https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii" title="Instalación y optimización de un servidor web con Nginx (II)">Instalación y optimización de un servidor web con Nginx (II)</a></li><li>Instalación y optimización de un servidor web con Nginx (III)</li></ul><section class="share"><section id="sharing"><h3>Compártelo</h3><a aria-label="En Twitter" href="https://twitter.com/intent/tweet?text=Instalaci%c3%b3n%20y%20optimizaci%c3%b3n%20de%20un%20servidor%20web%20con%20Nginx%20%28III%29+https%3a%2f%2felbauldelprogramador.com%2finstalacion-optimizacion-servidor-web-nginx-iii%2f+ Vía @elbaulp" title="En Twitter"><svg class="icon icon-twitter"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-twitter"></use></svg> </a><a aria-label="En Facebook" href="https://www.facebook.com/dialog/feed?app_id=145634995501895&display=popup&caption=Instalaci%C3%B3n&#43;y&#43;optimizaci%C3%B3n&#43;de&#43;un&#43;servidor&#43;web&#43;con&#43;Nginx&#43;%28III%29&amp;link=https%3A%2F%2Felbauldelprogramador.com%2Finstalacion-optimizacion-servidor-web-nginx-iii%2F" target="_blank" title="En Facebook"><svg class="icon icon-facebook"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-facebook"></use></svg> </a><a aria-label="En G&#43;" href="https://plus.google.com/share?url=https%3a%2f%2felbauldelprogramador.com%2finstalacion-optimizacion-servidor-web-nginx-iii%2f" title="En G&#43;"><svg class="icon icon-google-plus"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-google-plus"></use></svg></a></section><section><h3>Suscríbete</h3><a aria-label="Suscribir al boletín de noticias" href="http://eepurl.com/IZ5sX" title="Suscribir al boletín de noticias"><svg class="icon icon-mail"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-mail"></use></svg> </a><a aria-label="Suscribir al RSS" href="https://elbauldelprogramador.com/rssfeed" title="Suscribir al RSS"><svg class="icon icon-rss"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-rss"></use></svg> </a><a aria-label="Síguenos en Twitter" title="Síguenos en Twitter" href="http://twitter.com/elbaulp" target="_blank"><svg class="social icon-twitter"><use xlink:href="#icon-twitter"></use></svg></a><a aria-label="Síguenos en Facebook" title="Síguenos en Facebook" href="http://facebook.com/elbaulp" target="_blank"><svg class="social icon-facebook"><use xlink:href="#icon-facebook"></use></svg></a><a aria-label="Síguenos en G&#43;" title="Síguenos en G&#43;" href="http://plus.google.com/+ElBaulDelProgramador" target="_blank"><svg class="social icon-google-plus"><use xlink:href="#icon-google-plus"></use></svg></a><a aria-label="Síguenos en Telegram" href="https://telegram.me/elbaulp" target="_blank"><svg class="social icon-telegram"><use xlink:href="#icon-telegram"></use></svg></a></section></section><div class="tags"><strong>Categorías:</strong><div id="taxo"><a id="cats" href="https://elbauldelprogramador.com/categories/linux">linux</a> <a id="cats" href="https://elbauldelprogramador.com/categories/servidores">servidores</a></div><strong>Etiquetas:</strong><div id="taxo"><a id="tags" href="https://elbauldelprogramador.com/tags/nginx">nginx</a></div></div><h1>Quizá también te interese leer...</h1><ul><li><a href="/como-configurar-un-balanceador-de-carga-en-entornos-cloud/">Cómo configurar un balanceador de carga en entornos cloud</a></li><li><a href="/bloquear-ataques-de-fuerza-bruta-en-nginx-y-wordpress-con-fail2ban/">Bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban</a></li><li><a href="/como-hablitar-la-pagina-de-estado-en-nginx/">Cómo habilitar la página de estado en Nginx</a></li><li><a href="/como-crear-un-front-controller-en-php/">Cómo crear un Front Controller en PHP</a></li><li><a href="/instalacion-optimizacion-servidor-web-nginx-ii/">Instalación y optimización de un servidor web con Nginx (II)</a></li></ul><div class="near-posts"><a id="link-next" href="https://elbauldelprogramador.com/instalar-atom-el-editor-de-github-en-linux/" class="post-item">«« Instalar Atom, el editor de GitHub en Linux</a> <a id="link-prev" href="https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii/" class="post-item">Instalación y optimización de un servidor web con Nginx (II) »»</a></div></article><section class="comments"><amp-iframe height="300" sandbox="allow-scripts allow-same-origin allow-modals allow-popups allow-forms" resizable frameborder="0" src="https://cdn.rawgit.com/elbaulp/algui91-hugo/c1c11891b012e22c2e6ea7c399d6b03f7cdda04e/static/disqus-amp.html?url=https%3a%2f%2felbauldelprogramador.com%2finstalacion-optimizacion-servidor-web-nginx-iii%2f&disqus_title=Instalaci%c3%b3n%20y%20optimizaci%c3%b3n%20de%20un%20servidor%20web%20con%20Nginx%20%28III%29"><div overflow tabindex="0" role="button" aria-label="Read more">Read more!</div></amp-iframe></section></section><script type="text/javascript" async src="/js/mj/MathJax.js?config=TeX-AMS_CHTML"></script><footer><p>License: <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a></p><p>An adaptation for Hugo of Cards's <a href="http://willianjusten.com.br">Willian Justen</a> Theme for Jekyll</p></footer></body></html>