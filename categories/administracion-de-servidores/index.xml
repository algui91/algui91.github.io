<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Administracion De Servidores on El Baúl del programador</title>
        <link>https://elbauldelprogramador.com/categories/administracion-de-servidores/</link>
        <description>Recent content in Administracion De Servidores on El Baúl del programador</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>es-ES</language>
        <lastBuildDate>Fri, 01 Jan 2016 00:00:00 +0000</lastBuildDate>
        <image>
            <url>https://elbauldelprogramador.com/img/bio-photo-rss.png</url>
            <link>https://elbauldelprogramador.com/categories/administracion-de-servidores/</link>
            <title>Administracion De Servidores on El Baúl del programador</title>
            <width>144</width>
            <height>144</height>
        </image>
        <atom:link href="https://elbauldelprogramador.com/categories/administracion-de-servidores/" rel="self" type="application/rss+xml" />
        
        <item>
            <title>Dig - Chuleta básica de comandos</title>
            <link>https://elbauldelprogramador.com/dig-chuleta-basica-de-comandos/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/dig-chuleta-basica-de-comandos/</guid>
            <description>&lt;p&gt;&lt;strong&gt;Dig (Domain Information Groper)&lt;/strong&gt; es un comando de gran utilidad para realizar consultas a registros DNS. Se usa mucho &amp;#8212; entre otras cosas &amp;#8212; para el diagnóstico de &lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns/&#34; title=&#34;Cómo configurar un servidor DNS – Parte 1 (Introducción)&#34;&gt;Servidores DNS&lt;/a&gt;. Desde que administro yo mismo el servidor del blog lo he usado bastante, y hoy voy a dar unas nociones básicas de cómo usarlo.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;actualización&#34;&gt;[Actualización]&lt;/h1&gt;

&lt;p&gt;En un comentario hecho en la página de &lt;a href=&#34;https://plus.google.com/b/108003822606696308728/108003822606696308728/posts/idbcxhy5vzG&#34; target=&#34;_blank&#34;&gt;Google+ del blog&lt;/a&gt; un usuario indicó que es posible obtener una salida simplificada de todos los comandos de abajo con la opción &lt;em&gt;+short&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;El ejemplo más básico es:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;dig ejemplo.com&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;obtener-distintos-tipos-de-registros-dns&#34;&gt;Obtener distintos tipos de registros DNS&lt;/h1&gt;

&lt;p&gt;La sintaxis es:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;dig @servidor-dns ejemplo.com tipo-de-registro&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Ejemplo de uso:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;dig @208.67.222.222 google.com A
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; QUESTION SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.          IN  A
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; ANSWER SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.231
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.226
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.230
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.228
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.238
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.229
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.227
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.225
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.232
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.224
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  A   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.233&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;obtener-los-servidores-de-nombres&#34;&gt;Obtener los servidores de nombres&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;dig @208.67.222.222 google.com NS
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; QUESTION SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.            IN  NS
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; ANSWER SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.     &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172749&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  IN  NS  ns2.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172749&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  IN  NS  ns1.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172749&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  IN  NS  ns3.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172749&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  IN  NS  ns4.google.com.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;obtener-registros-mx-de-correo&#34;&gt;Obtener registros MX (De correo)&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;dig @208.67.222.222 google.com MX
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; QUESTION SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.            IN  MX
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; ANSWER SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.     &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;469&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;&#34;&gt; alt1.aspmx.l.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;469&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;&#34;&gt; aspmx.l.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;469&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;&lt;span class=&#34;&#34;&gt; alt3.aspmx.l.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;469&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;&#34;&gt; alt4.aspmx.l.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;469&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;&#34;&gt; alt2.aspmx.l.google.com.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;obtener-registros-txt&#34;&gt;Obtener registros TXT&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;dig @208.67.222.222 google.com TXT
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; QUESTION SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.          IN  TXT
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; ANSWER SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.        &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    IN  TXT &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;v=spf1 include:_spf.google.com ip4:216.73.93.70/31 ip4:216.73.93.72/31 ~all&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;obtener-todos-los-tipos-de-registros-en-una-misma-consulta&#34;&gt;Obtener todos los tipos de registros en una misma consulta&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;dig any google.com
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; QUESTION SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.           IN  ANY
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; ANSWER SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.        &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;407&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;&lt;span class=&#34;&#34;&gt; alt3.aspmx.l.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;407&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;&#34;&gt; alt2.aspmx.l.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;407&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;&#34;&gt; alt1.aspmx.l.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;407&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;&#34;&gt; aspmx.l.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;407&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  MX  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;&#34;&gt; alt4.aspmx.l.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172781&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  IN  NS  ns2.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172781&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  IN  NS  ns1.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172781&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  IN  NS  ns3.google.com.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;google.com.      &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172781&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  IN  NS  ns4.google.com.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;realizar-una-consulta-inversa&#34;&gt;Realizar una consulta inversa&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;dig -x &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.194.34.233
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; QUESTION SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;233&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.34.194.173.in-addr.arpa.  IN  PTR
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; ANSWER SECTION:
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;233&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.34.194.173.in-addr.arpa. &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;83265&lt;/span&gt;&lt;span class=&#34;&#34;&gt; IN  PTR mad01s09-in-f9.1e100.net.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Puedes encontrar una descripción un poco más extensa sobre el funcionamiento de la consulta inversa en la &lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns3/&#34;&gt;tercera&lt;/a&gt; parte del artículo &lt;em&gt;Cómo configurar un servidor DNS&lt;/em&gt;&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;dig – Linux DNS Lookup utility cheat sheet&lt;/em&gt; »» &lt;a href=&#34;http://linuxaria.com/pills/dig-linux-dns-lookup-utility-cheat-sheet&#34; target=&#34;_blank&#34;&gt;linuxaria&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Instalación y optimización de un servidor web con Nginx (I)</title>
            <link>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i/</guid>
            <description>&lt;blockquote&gt;
&lt;p&gt;La siguiente serie de artículos son el fruto de un trabajo realizado para la facultad en la asignatura Ingeniería de Servidores de la Universidad de Granada (ETSIIT [Escuela Técnica Superior de Ingenierías Informática y de Telecomunicación] )&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;em&gt;A lo largo de esta guía se pretende mostrar cómo instalar desde cero un servidor web con Nginx, realizando las operaciones necesarias para lograr el mayor rendimiento y seguridad posibles con programas tales como php-fpm, APC, y el módulo pagespeed de Google para optimizar los recursos web.&lt;/em&gt;&lt;/p&gt;

&lt;h1 id=&#34;tabla-de-contenidos&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (II)&#34;&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (III)&#34;&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hace tiempo se vío en este blog &lt;a href=&#34;https://elbauldelprogramador.com/como-instalar-nginx-con-php5-fpm/&#34; title=&#34;Cómo instalar y configurar Nginx con php5-fpm&#34;&gt;cómo instalar y configurar Nginx con php5-fpm&lt;/a&gt;, en los próximos artículos se intentará explicar de forma más detallada cómo llevar a cabo éste proceso junto con algunas mejoras adicionales en términos de optimización. Es necesario informar al lector que todas las recomendaciones aquí explicadas se basan únicamente en la experiencias del autor.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h2 id=&#34;compilar-e-instalar-nginx&#34;&gt;Compilar e instalar Nginx&lt;/h2&gt;

&lt;h3 id=&#34;preparando-el-entorno&#34;&gt;Preparando el entorno&lt;/h3&gt;

&lt;p&gt;Lo primero que debemos hacer es instalar las dependencias necesarias para la compilación, para ello:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;apt-get install build-essential libssl-dev libpcre3-dev&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Tras esto descargamos la última versión de nginx, al momento de escribir este texto la 1.4.4:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;wget http://nginx.org/download/nginx-1.4.4.tar.gz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Descomprimimos el archivo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;tar xzvf nginx-1.4.4.tar.gz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Antes de compilar cambiaremos un valor en el código fuente como medida de seguridad por ocultación. El valor a cambiar es la cadena asignada a la cabecera que indica el servidor usado en las peticiones HTTP. En concreto el archivo a cambiar es el alojado en &lt;code&gt;src/http/ngx_http_header_filter_module.c&lt;/code&gt;, concretamente en la línea 48:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ngx_http_server_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Server: nginx&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CRLF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ngx_http_server_full_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Server: &amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NGINX_VER&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CRLF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Cambiamos estas dos líneas a algo del estilo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ngx_http_server_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Server: Mi servidor Web&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CRLF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ngx_http_server_full_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Server: Mi servidor Web&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CRLF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Ya solo queda compilarlo e instalarlo, de momento necesitaremos los módulos siguientes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;--with-http_gzip_static_module --sbin-path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;/usr/local/sbin -with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Aquí estamos habilitando la compresión de las páginas con gzip, SSL para conexiones seguras, deshabilitando el módulo de correo POP3, IMAP y SMTP. Dependiendo de las necesidades de nuestro servidor, deberemos activar o desactivar algunos módulos. Más tarde necesitaremos recompilar para añadir el módulo &lt;strong&gt;pagespeed&lt;/strong&gt;. La lista de todos los módulos disponibles se puede consultar en la &lt;a href=&#34;http://wiki.nginx.org/Modules&#34; title=&#34;Módulos nginx&#34; target=&#34;_blank&#34;&gt;documentación de nginx&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;compilar&#34;&gt;Compilar&lt;/h3&gt;

&lt;p&gt;Ya está todo listo para compilar e instalar, dentro del directorio de nginx ejecutamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;./configure --with-http_gzip_static_module --sbin-path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;/usr/local/sbin &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;--with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;--without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Tras esto deberíamos ver un resumen de la operación realizada:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;Configuration summary
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  + using system PCRE library
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  + using system OpenSSL library
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  + md5: using OpenSSL library
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  + sha1: using OpenSSL library
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  + using system zlib library
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx path prefix: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/usr/local/nginx&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx binary file: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/usr/local/sbin&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx configuration prefix: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/usr/local/nginx/conf&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx configuration file: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/usr/local/nginx/conf/nginx.conf&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx pid file: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/usr/local/nginx/logs/nginx.pid&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx error log file: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/usr/local/nginx/logs/error.log&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx http access log file: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/usr/local/nginx/logs/access.log&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx http client request body temporary files: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;client_body_temp&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx http proxy temporary files: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;proxy_temp&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx http fastcgi temporary files: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;fastcgi_temp&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx http uwsgi temporary files: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;uwsgi_temp&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;  nginx http scgi temporary files: &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;scgi_temp&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Para compilar e instalar:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;make -j &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; make install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Tras esto, es necesario descargar el script que permite iniciar, detener, reiniciar y recargar nginx mediante el comando &lt;strong&gt;service&lt;/strong&gt;, podemos descargarlo desde&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;wget https://raw.github.com/JasonGiedymin/nginx-init-ubuntu/master/nginx
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;mv nginx /etc/init.d/nginx
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;sudo chmod +x /etc/init.d/nginx
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;sudo chown root:root /etc/init.d/nginx
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;update-rc.d nginx defaults&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Con esto hemos descargaro el script, lo hemos movido al directorio en el que será llamado al inicio del sistema, dado permisos de ejecución y asignado a root como propietario. Hecho esto, para iniciar nuestro servidor web hay que ejecutar el comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;service nginx start&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Como se muestra en la siguiente figura nginx, podemos comprobar que nginx está funcionando correctamente dirigiéndonos a la dirección &lt;em&gt;localhost&lt;/em&gt;, donde veremos lo siguiente:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&#34;https://elbauldelprogramador.com/img/2014/02/instalacionNginx.png&#34;&gt;&lt;img sizes=&#34;(min-width: 554px) 554px, 100vw&#34; on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2014/02/instalacionNginx.png&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34; alt=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34; width=&#34;554px&#34; height=&#34;192px&#34; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;h3 id=&#34;configuración&#34;&gt;Configuración&lt;/h3&gt;

&lt;p&gt;Ya que está todo listo, vamos a realizar unos cuantos ajustes a la configuración por defecto:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;user  www-data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;worker_processes  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pid        /var/run/nginx.pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;error_log  logs/error.log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;events &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    worker_connections  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;http &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    include       mime.types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    default_type  application/octet-stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    gzip on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    gzip_buffers &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;&#34;&gt; 8k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    gzip_disable &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;MSIE [1-6]\.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    gzip_proxied any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    log_format  main  &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    access_log  logs/access.log  main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    sendfile        on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    keepalive_timeout  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    index              index.html index.htm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    server &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;        listen       &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;        server_name localhost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;        root html&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    access_log  logs/host.access.log  main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;        location ~ /&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;                deny all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;                access_log off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;                log_not_found off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Los cambios más relevantes sobre la configuración por defecto son:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Se ha cambiado el usuario del servidor de &lt;em&gt;nobody&lt;/em&gt; a &lt;em&gt;www-data&lt;/em&gt;, éste último es el usuario por defecto para servidores webs.&lt;/li&gt;
&lt;li&gt;Se define el archivo donde se localizará el PID (Process ID) del servidor. Esto permite al script que hemos instalado iniciar o detener nginx.&lt;/li&gt;
&lt;li&gt;Se habilita la compresión gzip para reducir el ancho de banda consumido.&lt;/li&gt;
&lt;li&gt;Se define el formato que tendrán los ficheros de log.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Cambiamos los permisos del directorio donde se alojan los recursos web a este último usuario y reiniciamos nginx:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;chown -R www-data:www-data /usr/local/nginx/html/
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;service nginx destroy &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; service nginx start&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;tabla-de-contenidos-1&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (II)&#34;&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (III)&#34;&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Instalación y optimización de un servidor web con Nginx (II)</title>
            <link>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii/</guid>
            <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34;&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (III)&#34;&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Continuando con el artículo anterior, ahora procedemos a instalar PHP-FPM.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;instalar-php-fpm&#34;&gt;Instalar PHP-FPM&lt;/h1&gt;

&lt;p&gt;En lugar de instalar php5, instalaremos php5-fpm (FastCGI Process Manager), una implementación alternativa con algunas características adicionales. En Ubuntu se puede instalar desde repositorios, para debian los agregamos a mano al &lt;em&gt;sources.list&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;deb http://packages.dotdeb.org stable all
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;deb-src http://packages.dotdeb.org stable all&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Es necesario agregar la &lt;a href=&#34;https://elbauldelprogramador.com/editar-y-crear-archivos-cifrados-con-gpg-en-vim/&#34; title=&#34;Editar y crear archivos cifrados con GPG en Vim&#34;&gt;llave GnuPG&lt;/a&gt;, instalamos php5-fpm y lo iniciamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;apt-get update
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;wget http://www.dotdeb.org/dotdeb.gpg
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;cat dotdeb.gpg &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; sudo apt-key add -
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apt-get install php5-cli php5-suhosin php5-fpm php5-cgi php5-mysql
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;service php5-fpm start&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Ahora probaremos que php funciona bajo nginx, para ello es necesario modificar ligeramente el archivo &lt;em&gt;nginx.conf&lt;/em&gt;, concretamente:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;En el bloque &lt;em&gt;http&lt;/em&gt; hay que añadir index.php a la directiva index, para que quede index &lt;em&gt;index.php index.html index.htm;&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Necesitamos crear la comunicación entre nginx y php mediante un socket, para ello añadimos lo siguiente en el bloque &lt;em&gt;http&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;upstream php &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    server unix://var/run/php-fpm.socket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Por último, dentro del bloque &lt;em&gt;server&lt;/em&gt;, añadimos una regla que permita manejar los archivos php:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;location ~ &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;&lt;span class=&#34;&#34;&gt;php$ &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    include fastcgi_params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    fastcgi_index index.php&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    fastcgi_param SCRIPT_FILENAME &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$document_root$fastcgi_script_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    fastcgi_pass php&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Una última modificación al archivo &lt;em&gt;/etc/php5/fpm/pool.d/www.conf&lt;/em&gt; y agregamos la línea &lt;em&gt;listen = /var/run/php-fpm.socket&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;probando-php&#34;&gt;Probando PHP&lt;/h2&gt;

&lt;p&gt;Para comprobar que PHP funciona crearemos un fichero simple que mostrará un mensaje, hemos de colocarlo en &lt;em&gt;/usr/local/nginx/http/&lt;/em&gt; y asignarle como grupo y usuario &lt;em&gt;www-data&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;n&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;&amp;lt;?php echo &amp;#34;Probando que PHP funciona&amp;#34;;??&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &amp;gt; /usr/local/nginx/html/index.php
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;chown www-data:www-data /usr/local/nginx/html/index.php&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;De nuevo nos dirigimos al &lt;em&gt;localhost&lt;/em&gt; y deberíamos ver el mensaje, lo cual indica que se está ejecutando PHP.&lt;/p&gt;

&lt;h1 id=&#34;tabla-de-contenidos&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34;&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (III)&#34;&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Instalación y optimización de un servidor web con Nginx (III)</title>
            <link>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/</guid>
            <description>&lt;h1 id=&#34;tabla-de-contenidos&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34;&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (II)&#34;&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;En éste último artículo se verá cómo realizar optimizaciones al servidor web nginx, PHP y se cubrirá la instalación del sistema de caches APC y el módulo Page Speed de Google.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h2 id=&#34;optimizando&#34;&gt;Optimizando&lt;/h2&gt;

&lt;h3 id=&#34;pools-en-php&#34;&gt;Pools en PHP&lt;/h3&gt;

&lt;p&gt;La configuración por defecto de PHP no suele ser la óptima, dependiendo de nuestras necesidades y hardware deberemos ajustar algunos parámetros. En esta sección nos centraremos en el número de procesos y recursos que se dedicarán a una aplicación web. Estos parámetros se encuentran en el directorio &lt;em&gt;/etc/php/fpm/pools.d&lt;/em&gt;, se debe tener una archivo por cada aplicación, en nuestro caso será &lt;em&gt;www.conf&lt;/em&gt;.
Los parámetros a ajustar son:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pm&lt;/strong&gt;: Decide cómo el controlador de procesos administra los procesos hijos, es recomendable establecerlo a dinámico.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pm.max_children&lt;/strong&gt;: Cuando pm es estático, el número de hijos a crear, cuando es dinámico, el máximo número de hijos que se podrán tener.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pm.start_servers&lt;/strong&gt;: Número de hijos a crear al inicio.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pm.min_spare_servers&lt;/strong&gt;: El número mínimo de procesos libres (Sin hacer nada).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pm.max_spare_servers&lt;/strong&gt;: Número máximo de procesos libres.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;pm.max_requests&lt;/strong&gt;: El número de peticiones que cada hijo aceptará antes de reiniciarse, útil para evitar pérdidas de memoria.&lt;/p&gt;

&lt;p&gt;Hay varias aproximaciones para determinar el valor adecuado de estos parámetros, en esta guía se verán 3, y todas con &lt;em&gt;pm = dynamic&lt;/em&gt;.&lt;/p&gt;

&lt;h4 id=&#34;primer-método&#34;&gt;Primer método&lt;/h4&gt;

&lt;p&gt;El primero (&lt;a href=&#34;http://nls.io/optimize-nginx-and-php-fpm-max_children/&#34; title=&#34;Optimize nginx and PHP-FPM (max_children)&#34; target=&#34;_blank&#34;&gt;Guillaume Moigneu&lt;/a&gt;) consiste en calcular &lt;em&gt;pm.max_children&lt;/em&gt; basándonos en la fórmula:&lt;/p&gt;

&lt;p&gt;\[pm.max\_children = (RAM_{total} - RAM_{resto Proc})/ RAM_{mediaPHP}\]&lt;/p&gt;

&lt;p&gt;Donde \(RAM_{restoProc}\) es la memoria usada por los otros procesos y \(RAM_{mediaPHP}\) es la media de memoria usada por los procesos de PHP. La memoria consumida por el resto de procesos se puede calcular mediante este comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;ps -ylA --sort:rss &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; grep -v php5-fpm &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; awk &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;!/RSS/ { s+=$8 } END { printf &amp;#34;%s\n&amp;#34;, &amp;#34;Memoria total usada por otros procesos&amp;#34;; printf &amp;#34;%dM\n&amp;#34;, s/1024 }&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Y la consumida por PHP:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;ps -ylC php5-fpm --sort:rss  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; awk &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;!/RSS/ { s+=$8 } END { printf &amp;#34;%s\n&amp;#34;, &amp;#34;Memoria consumida por PHP: &amp;#34;; printf &amp;#34;%dM\n&amp;#34;, s/1024 }&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Al número anterior lo dividimos por los procesos de PHP y obtenemos la media. Una vez calculado el valor de &lt;em&gt;max_children&lt;/em&gt;, &lt;em&gt;min_spare_servers&lt;/em&gt; y &lt;em&gt;max_spare_servers&lt;/em&gt; se suelen calcular evaluando el rendimiento y &lt;em&gt;start_servers&lt;/em&gt;, suele ser:&lt;/p&gt;

&lt;p&gt;\[start\_servers = \frac{min\_spare\_servers + (max\_spare\_servers - min\_spare\_servers)}{2}\]&lt;/p&gt;

&lt;h4 id=&#34;segundo-método&#34;&gt;Segundo método&lt;/h4&gt;

&lt;p&gt;El segundo método (&lt;a href=&#34;http://myshell.co.uk/index.php/adjusting-child-processes-for-php-fpm-nginx/&#34; title=&#34;Adjusting child processes for PHP-FPM (Nginx)&#34; target=&#34;_blank&#34;&gt;myshell.co.uk&lt;/a&gt;) es calcularlo en base a:&lt;/p&gt;

&lt;p&gt;\[pm.max\_children = RAM_{total} / RAM_{maxPHP}\]&lt;/p&gt;

&lt;p&gt;Donde \(RAM_{maxPHP}\) es el process PHP que ocupe más memoria. El resto de parámetros se calculan en base a éste.&lt;/p&gt;

&lt;h4 id=&#34;tercer-método&#34;&gt;Tercer método&lt;/h4&gt;

&lt;p&gt;Por último, otro método (&lt;a href=&#34;https://github.com/perusio/php-fpm-example-config&#34; title=&#34;Example configuration of php-fpm&#34; target=&#34;_blank&#34;&gt;Perusio&lt;/a&gt;) es realizando la operación siguiente:&lt;/p&gt;

&lt;p&gt;\[pm.max\_children = 1.2 \cdot RAM_{total}/RAM_{mediaPHP}\]&lt;/p&gt;

&lt;h3 id=&#34;optimizando-nginx&#34;&gt;Optimizando Nginx&lt;/h3&gt;

&lt;p&gt;FastCGI es un protocolo que hace de interfaz entre programas y servidores web. En esta sección veremos cómo configurar nginx para cachear páginas y aumentar su rendimiento.&lt;/p&gt;

&lt;p&gt;Para aprovechar todos los núcleos de un procesador, nginx necesita ajustar el parámetro &lt;em&gt;worker_processes&lt;/em&gt; acorde al número de procesadores. Para determinar el número de procesadores podemos ejecutar el siguiente comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;cat /proc/cpuinfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; grep processor &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; wc -l&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;En la directiva &lt;em&gt;worker_connections&lt;/em&gt; dentro del bloque &lt;em&gt;events&lt;/em&gt; escribiremos un 1024. Con esto nginx tendrá un proceso por núcleo y cada proceso podrá procesar hasta 1024 conexiones.&lt;/p&gt;

&lt;p&gt;Estableceremos ahora los parámetros que permitirán cachear los resultados para servirlos más rápido al cliente, para ello haremos uso de las directivas &lt;em&gt;fastcgi_cache&lt;/em&gt;. En el bloque &lt;em&gt;http&lt;/em&gt; necesitaremos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;fastcgi_cache_path /var/cache/nginx &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;levels&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt;:2 &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;keys_zone&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;microcache:500m &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_size&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;1000m &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inactive&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;60m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;fastcgi_cache_key &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$scheme$request_method$host$request_uri&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;fastcgi_cache_use_stale updating error timeout invalid_header http_500&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Lo cual establece el directorio donde se guardarán los objetos cacheados, los niveles de cache, un nombre y el espacio reservado (500Mb), así como un tope máximo (1Gb). La segunda directiva establece bajo qué nombre se almacenará la clave para la cache. Por último la tercera servirá contenido antiguo en la caché cuando haya errores en el servidor web, cuando se esté actualizando la caché, cuando haya errores del tipo 5xx o cuando la cabecera de la petición sea inválida.&lt;/p&gt;

&lt;p&gt;El siguiente paso es decidir qué objetos se almacenarán en caché y cuales no. Para ello, dentro de un bloque &lt;em&gt;server&lt;/em&gt; escribiremos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;n&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$no_cache&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$request_method&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt; POST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$no_cache&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$query_string&lt;/span&gt;&lt;span class=&#34;&#34;&gt; !&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$no_cache&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    location ~ &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;&lt;span class=&#34;&#34;&gt;php$ &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ....
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      fastcgi_cache_bypass &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$no_cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      fastcgi_no_cache &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$no_cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      fastcgi_cache microcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      fastcgi_cache_valid 60m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;En esta porción de código hemos declarado una variable que determinará qué peticiones se cachean y cuales no. No cachearemos ninguna petición POST ni nada que tenga consultas en la URL (?arg&amp;#8230;&amp;arg1;&amp;#8230;). Con ayuda de esta variable podremos decidir en el bloque &lt;em&gt;location&lt;/em&gt; si cacheamos la petición (directivas bypass y no_cache), aquí hacemos referencia al nombre que dimos anteriormente al espacio de caché y fijamos un periodo de validez.&lt;/p&gt;

&lt;h3 id=&#34;page-speed&#34;&gt;Page Speed&lt;/h3&gt;

&lt;p&gt;En esta sección veremos cómo compilar y configurar el módulo desarrollado por Google que optimizará al máximo todos los recursos de nuestra web, minimizando considerablemente el tiempo de respuesta y aplicando algunos cambios a los archivos para que cumplan con los estándares de rendimiento que Google usa para puntuar las páginas web.&lt;/p&gt;

&lt;p&gt;Algunas de las características que ofrece son comprimir los archivos CSS y JavaScript de forma que ocupen lo menos posible. Unificar (cuando sea posible) la mayor cantidad de archivos CSS y JS en uno solo para reducir el número de peticiones al servidor. Optimizar las imágenes para reducir su tamaño. Cargar de forma asíncrona los programas JS. Mover los elementos bloqueantes que impiden que la página se renderize correctamente a lugares donde no sean perjudiciales para el renderizado. Éstas son solo algunas de las funcionalidades principales.&lt;/p&gt;

&lt;h4 id=&#34;preparando-el-entorno&#34;&gt;Preparando el entorno&lt;/h4&gt;

&lt;p&gt;Antes de poder compilar, será necesario instalar algunas dependencias:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;apt-get install build-essential zlib1g-dev libpcre3 libpcre3-dev&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Una vez hecho, estamos en condiciones para descargar y compilar:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;n&#34;&gt;cd&lt;/span&gt;&lt;span class=&#34;&#34;&gt; ~
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;wget https://github.com/pagespeed/ngx_pagespeed/archive/v1.7.30.1-beta.zip
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;unzip v1.7.30.1-beta.zip &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# or unzip v1.7.30.1-beta
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cd&lt;/span&gt;&lt;span class=&#34;&#34;&gt; ngx_pagespeed-1.7.30.1-beta/
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;wget https://dl.google.com/dl/page-speed/psol/1.7.30.1.tar.gz
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;tar -xzvf &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.7.30.1.tar.gz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Hecho esto, será necesario recompilar nginx con este módulo, como comentamos al inicio de esta guía, para ello simplemente ejecutamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;nginx -V &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Para ver con qué módulos está compilado el ejecutable actual
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;configure arguments: --with-http_gzip_static_module --sbin-path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cd&lt;/span&gt;&lt;span class=&#34;&#34;&gt; ~/nginx-1.4.4/ &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# compilaremos nginx con el nuevo módulo (--ad-module)
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;./configure --with-http_gzip_static_module --sbin-path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module --add-module&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$HOME&lt;/span&gt;&lt;span class=&#34;&#34;&gt;/ngx_pagespeed-1.7.30.1-beta
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;make -j &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# compilamos
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;service nginx destroy &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# detenemos la instancia actual de nginx
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;make install # instalamos la nueva versión con pagespeed&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h4 id=&#34;configurando-pagespeed&#34;&gt;Configurando PageSpeed&lt;/h4&gt;

&lt;p&gt;Solo resta configurar nginx para activar &lt;em&gt;pagespeed&lt;/em&gt; con los filtros deseados. La documentación se puede encontrar en &lt;a href=&#34;https://developers.google.com/speed/pagespeed/module/config_filters&#34; title=&#34;Configuring PageSpeed Filters&#34; target=&#34;_blank&#34;&gt;Configuring PageSpeed Filters&lt;/a&gt;. Por defecto los filtros habilitados son:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;add_head
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;combine_css
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;combine_javascript
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;convert_meta_tags
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;extend_cache
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;fallback_rewrite_css_urls
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;flatten_css_imports
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;inline_css
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;inline_import_to_link
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;inline_javascript
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;rewrite_css
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;rewrite_images
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;rewrite_javascript
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;rewrite_style_attributes_with_url&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Veamos cómo habilitar pagespeed en nginx, para ello crearemos un fichero y un directorio en &lt;em&gt;/usr/local/nginx/conf/global/pagespeed.conf&lt;/em&gt; conteniendo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;pagespeed on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Needs to exist and be writable by nginx.
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed FileCachePath /var/ngx_pagespeed_cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Ensure requests for pagespeed optimized resources go to the pagespeed handler
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# and no extraneous headers get set.
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;location ~ &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;\.pagespeed\.([a-z]\.)?[a-z]{2}\.[^.]{10}\.[^.]+&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      add_header &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;location ~ &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;^/ngx_pagespeed_static/&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;location ~ &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;^/ngx_pagespeed_beacon&lt;/span&gt;&lt;span class=&#34;&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# This page shows statistics about the ngx_pagespeed module.
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;location /ngx_pagespeed_statistics &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    allow &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;127&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.0.0.1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    allow TuIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    deny all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Recent log messages. Like statistics, these are generally not to be shown
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# to the public, so this has access controls as well.
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed MessageBufferSize &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;location /ngx_pagespeed_message &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    allow &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;127&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.0.0.1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#    allow TuIP;
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    deny all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# This page lets you view a graphical console displaying statistics about
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# the ngx_pagespeed module.  As with statistics and messages, you may
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# want access control.
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed Statistics on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed StatisticsLogging on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed LogDir /var/log/pagespeed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed StatisticsLoggingIntervalMs &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;60000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed StatisticsLoggingMaxFileSizeKb &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;location /pagespeed_console &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    allow &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;127&lt;/span&gt;&lt;span class=&#34;&#34;&gt;.0.0.1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#    allow TuIP;
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    deny all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Honoring no-transform Cache-Control Headers
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed DisableRewriteOnNoTransform off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed RewriteLevel CoreFilters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Specifying the value for the PageSpeed header
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;pagespeed XHeaderValue &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Gracias a ngx_pagespeed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Esto debería ser suficiente para la mayoría de webs, es posible habilitar más filtros usando la directiva &lt;em&gt;pagespeed EnableFilters&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Por último hay que añadir la configuración a nginx, dentro del bloque &lt;em&gt;server&lt;/em&gt; que deseemos incluimos la línea &lt;em&gt;include global/pagespeed.conf;&lt;/em&gt; y recargamos la configuración de nginx:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;service nginx reload&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Podemos comprobar que todo funciona correctamente ojeando las cabeceras de la respuesta del servidor como se muestra en la figura:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&#34;https://elbauldelprogramador.com/img/2014/02/pagespeed.png&#34;&gt;&lt;img sizes=&#34;(min-width: 255px) 255px, 100vw&#34; on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2014/02/pagespeed.png&#34; title=&#34;Configuración pagespeed nginx&#34; alt=&#34;Configuración pagespeed nginx&#34; width=&#34;255px&#34; height=&#34;135px&#34; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;Como vemos, la cabecera de pagespeed está presente, luego está habilitado.&lt;/p&gt;

&lt;h2 id=&#34;apc&#34;&gt;APC&lt;/h2&gt;

&lt;p&gt;APC viene de Alternative PHP Cache y es un opcode libre y gratuito para PHP. Su objetivo es proporcionar un marco robusto, libre y abierto para optimizar código intermedio de PHP mediante su almacenamiento en caché.&lt;/p&gt;

&lt;h3 id=&#34;instalando-y-configurando-apc&#34;&gt;Instalando y configurando APC&lt;/h3&gt;

&lt;p&gt;Para instalarlo basta con ejecutar:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;apt-get install php-apc&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;El archivo de configuración reside en &lt;em&gt;/etc/php5/fpm/conf.d/apc.ini&lt;/em&gt;, un ejemplo de configuración es el siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;apc.enabled&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.shm_segments&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.shm_size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;128M
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;Relative to the number of cached files &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;&#34;&gt;you may need to watch your stats &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;&#34;&gt; a day or two to find out a good number&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.num_files_hint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;768&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;Relative to the size of your site
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.user_entries_hint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;The number of seconds a cache entry is allowed to idle in a slot before APC dumps the cache
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;7200&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.user_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;7200&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.gc_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;Setting this to &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt; will give you the best performance, as APC will
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;not have to check the IO &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;&#34;&gt; changes. However, you must clear
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;the APC cache to recompile already cached files. If you are still
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;developing, updating your site daily in WP-ADMIN, and running W3TC
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;&#34;&gt; this to &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.stat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;This MUST be &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;, WP can have errors otherwise!
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.include_once_override&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;Only &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;&#34;&gt; to &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;&#34;&gt; debugging
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.enable_cli&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;Allow &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;&#34;&gt; seconds after a file is created before it is cached to prevent users from seeing half-written/weird pages
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.file_update_protection&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;Leave at 2M or lower. WordPress doest have any file sizes close to 2M
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.max_file_size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;1M
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.cache_by_default&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.use_request_time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.slam_defense&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.mmap_file_mask&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;/tmp/apc.XXXXXX
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.stat_ctime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.canonicalize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.write_lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.report_autofilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.rfc1867&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.rfc1867_prefix &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;upload_
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.rfc1867_name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;APC_UPLOAD_PROGRESS
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.rfc1867_freq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.rfc1867_ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.lazy_classes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.lazy_functions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.localcache &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;The size of the &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;&#34;&gt; process shadow-cache, should be &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;&#34;&gt; to a sufficiently large value, approximately half of apc.num_files_hint.
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;apc.localcache.size &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;384&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&#34;https://elbauldelprogramador.com/solucionar-fallo-de-segmentacion-en-php-cuando-se-usa-apc/&#34; title=&#34;Solucionar fallo de segmentación en PHP cuando se usa APC&#34;&gt;APC&lt;/a&gt; proporciona una mejora considerable en cuanto al rendimiento, ya que no es necesario volver a interpretar el código PHP cada vez que el servidor recibe una petición, el código quedará compilado en cache listo para ser servido. Uno de los parámetros más importantes es &lt;em&gt;apc.shm_size=&lt;/em&gt;, el cual establece el tamaño reservado para la caché.&lt;/p&gt;

&lt;h2 id=&#34;consideraciones-sobre-seguridad&#34;&gt;Consideraciones sobre seguridad&lt;/h2&gt;

&lt;p&gt;Algunos valores por defecto de la configuración de nginx no son adecuados en términos de seguridad, basándonos en las recomendaciones de &lt;a href=&#34;http://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html&#34; title=&#34;Top 20 Nginx WebServer Best Security Practices&#34; target=&#34;_blank&#34;&gt;NIX Craft&lt;/a&gt; podemos ajustar éstos parámetros según nuestras necesidades para obtener una mayor seguridad frente a ataques. Todos estos parámetros irán en el bloque &lt;em&gt;http&lt;/em&gt; de nginx.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c&#34;&gt;## Start: Size Limits &amp;amp; Buffer Overflows ##
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      client_body_buffer_size  8K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      client_header_buffer_size 1k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      client_max_body_size 1m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      large_client_header_buffers &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;&#34;&gt; 1k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;## END: Size Limits &amp;amp; Buffer Overflows ##
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;## Start: Timeouts ##
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      client_body_timeout   &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      client_header_timeout &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      keepalive_timeout     &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      send_timeout          &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;## End: Timeouts ##
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;### Directive describes the zone, in which the session states are stored i.e. store in slimits. ###
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;### 1m can handle 32000 sessions with 32 bytes/session, set to 5m x 32000 session ###
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      limit_conn_zone &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;$binary_remote_addr&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;zone&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;&#34;&gt;addr:5m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;### Control maximum number of simultaneous connections for one session i.e. ###
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;### restricts the amount of connections from a single ip address ###
&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;&#34;&gt;      limit_conn addr &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Una breve explicación del propósito de cada directiva:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;client_body_buffer_size&lt;/strong&gt;: El tamaño máximo del buffer de petición del cliente.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client_header_buffer_size&lt;/strong&gt;: Normalmente el tamaño de las cabeceras de la mayoría de peticiones son inferiores a 1k, si hay problemas deberemos subir el valor.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client_max_body_size&lt;/strong&gt;: Si vamos a aceptar que se suban archivos a nuestra web, este valor debería ser dado en Megas, de lo contrario podremos establecer un valor bajo, como 1k.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;large_client_header_buffers&lt;/strong&gt;: Número máximo y tamaño de los buffers para peticiones que tengan cabeceras de mayor tamaño enviadas por el cliente. Útil para combatir bad bots y ataques DoS.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client_body_timeout&lt;/strong&gt;: Establece el tiempo de espera para leer el cuerpo de la petición del cliente. Si tras pasar el tiempo el cliente no envía nada, nginx devolverá un error 408 (Request timeout).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client_header_timeout&lt;/strong&gt;: Similar al anterior pero para la cabecera.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;keepalive_timeout&lt;/strong&gt;: El primer parámetro asigna el tiempo de espera para mantener la conexión activa con el cliente, el servidor cerrará la conxión tras pasar éste tiempo. El segundo parámetro establece el valor de la cabecera &lt;em&gt;Keep-Alive:timeout=time&lt;/em&gt; en la respuesta del servidor, esta cabecera puede hacer que algunos navegadore cierren la conexión para que no sea el servidor el que tenga que hacerlo.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;send_timeout&lt;/strong&gt;: Asigna el tiempo de espera al cliente.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;limit_conn_zone&lt;/strong&gt;: Controla el número de conexiones simultaneas de un mismo cliente.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Con esto concluyen los tres artículos sobre instalación y optimización de un servidor web con nginx, espero que haya resultado útil.&lt;/p&gt;

&lt;h1 id=&#34;tabla-de-contenidos-1&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34;&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (II)&#34;&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Recibir alertas de correo al acceder al  sistema mediante SSH</title>
            <link>https://elbauldelprogramador.com/recibir-alertas-de-correo-ssh/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/recibir-alertas-de-correo-ssh/</guid>
            <description>&lt;p&gt;Hemos visto en otros artículos varias maneras de mejorar la seguridad en un servidor, medidas tales como:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/combatir-los-comentarios-de-spam-en-wordpress/&#34; title=&#34;Combatir los comentarios de spam en WordPress&#34;&gt;Combatir los comentarios de Spam en WordPress&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/bloquear-ataques-de-fuerza-bruta-en-nginx-y-wordpress-con-fail2ban/&#34; title=&#34;Bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban&#34;&gt;Bloquear ataques de fuerza bruta en nginx y WordPress con Fail2Ban&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/bloquear-una-ip-atacanto-el-servidor-mediante-iptables/&#34; title=&#34;Bloquear una IP atacando el servidor mediante iptables&#34;&gt;Bloquear una IP atacando el servidor mediante IPtables&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hoy veremos cómo recibir alertas de correo SSH cada vez que un usuario logre acceder al sistema mediante este protocolo. El artículo original es de &lt;a href=&#34;http://www.tecmint.com&#34; title=&#34;TecMint&#34; target=&#34;_blank&#34;&gt;tecmint&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;En linux, cada vez que un usuario accede al sistema, el archivo &lt;em&gt;.bashrc&lt;/em&gt; se ejecuta. De modo que si añadimos a dicho archivo una sentencia que nos envíe un correo, lograremos monitorizar los accesos al sistema. Antes hay que instalar un cliente de correo, aunque al ser un servidor, es probable que ya exista uno instalado.&lt;/p&gt;

&lt;h1 id=&#34;instalar-mailx&#34;&gt;Instalar MailX&lt;/h1&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;apt-get install mailx&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;modificar-el-archivo-bashrc&#34;&gt;Modificar el archivo .bashrc&lt;/h1&gt;

&lt;p&gt;Para cada usuario del que deseemos recibir alertas, habrá que añadir la siguiente línea a su &lt;em&gt;bashrc&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;n&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;ALERTA - Acceso a la Shell (ServerName) el:&amp;#39;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;&#34;&gt;who&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; mail -s &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Alerta: Acceso shell de `who | cut -d&amp;#39;(&amp;#39; -f2 | cut -d&amp;#39;)&amp;#39; -f1`&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; correo@electrónico.com&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Listo, ahora recibiremos un correo por cada acceso al sistema.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;How to Get Root and User SSH Login Email Alerts&lt;/em&gt; »» &lt;a href=&#34;http://www.tecmint.com/get-root-ssh-login-email-alerts-in-linux&#34; target=&#34;_blank&#34;&gt;tecmint.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Solucionar fallo de segmentación en PHP cuando se usa APC</title>
            <link>https://elbauldelprogramador.com/solucionar-fallo-de-segmentacion-en-php-cuando-se-usa-apc/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/solucionar-fallo-de-segmentacion-en-php-cuando-se-usa-apc/</guid>
            <description>&lt;p&gt;Hace algún tiempo, el blog se caía de forma aleatoria y dejaba de funcionar. Tras investigar un poco descubrí que era PHP el que estaba causando el problema. En concreto ocurría un fallo de segmentación en PHP que no conseguía averiguar de dónde procedían. Buscando y buscando al final dí con el problema, en realidad lo que provocaba el problema no era PHP, si no una consecuencia de usar APC y el parámetro &lt;code&gt;apc.shm_size&lt;/code&gt; junto con el parámetro del kernel &lt;code&gt;kernel.shmmax&lt;/code&gt;. El propósito de este artículo es dejar constancia de cómo se solucionó el problema por si alguien se encontrara en la misma situación.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;para-qué-sirve-el-parámetro-proc-sys-kernel-shmmax&#34;&gt;Para qué sirve el parámetro /proc/sys/kernel/shmmax&lt;/h1&gt;

&lt;p&gt;Según la documentación del kernel:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;shmmax:&lt;/p&gt;

&lt;p&gt;This value can be used to query and set the run time limit
on the maximum shared memory segment size that can be created.
Shared memory segments up to 1Gb are now supported in the
kernel. This value defaults to SHMMAX.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Traducido:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;shmmax:&lt;/p&gt;

&lt;p&gt;Este valor puede usarse para consultar y establecer el límite máximo del segmento de memoria compartida que puede crearse. Se soportan segmentos de memoria compartida de hasta 1Gb. Su valor por defecto está definido por la constante SHMMAX.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;para-qué-sirve-el-parámetro-apc-shm-size&#34;&gt;Para qué sirve el parámetro apc.shm_size&lt;/h1&gt;

&lt;p&gt;Según la documentación de APC:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;El tamaño de cada segmento de memoria compartida en MB. Por defecto, algunos sistemas (incluidos la mayoría de variantes de BSD) tienen límites muy bajos del tamaño de un segmento de memoria compartida.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Sabiendo para qué sirve cada parámetro, en un foro encontré la respuesta a la solución:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;From my Linux experience, this bug is caused only by one thing:&lt;/p&gt;

&lt;p&gt;Wrongly set SHM size in kernel and/or APC settings. With standard apc.shm_size = 30, i get segfault (11) every time i try to spawn php-cgi processes. But once i do the following:&lt;/p&gt;

&lt;p&gt;echo &amp;#8220;512000000&amp;#8221; &amp;gt; /proc/sys/kernel/shmmax
set apc.shm_size = 64M&lt;/p&gt;

&lt;p&gt;Then the problem completely disappears. PHP with APC becomes ROCK-solid, and NEVER segfaults running &lt;sup&gt;24&lt;/sup&gt;&amp;frasl;&lt;sub&gt;7&lt;/sub&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Por tanto, incrementando el valor del parámetro &lt;code&gt;/proc/sys/kernel/shmmax&lt;/code&gt; a un valor igual o mayor que el del parámetro &lt;code&gt;apc.shm_size&lt;/code&gt; de APC soluciona el problema. Desde que apliqué este cambio no he vuelto a tener caídas en los procesos de PHP.&lt;/p&gt;

&lt;h1 id=&#34;algunas-notas-a-tener-en-cuenta&#34;&gt;Algunas notas a tener en cuenta&lt;/h1&gt;

&lt;p&gt;El parámetro del kernel se puede cambiar de varias formas, tal y como mencionaba el usuario del foro se cambia únicamente durante la sesión activa del Sistema Operativo, tras reiniciar el servidor se establecerá su valor por defecto (30Mb). Para hacer los cambios permanentes, debemos escribir el valor del parámetro en el fichero &lt;em&gt;/etc/sysctl.conf&lt;/em&gt; o en &lt;em&gt;/etc/sysctl.d/99-sysctl.conf&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Por ejemplo, para establecer el valor a 256 Mb escribiríamos al final de uno de estos archivos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;kernel.shmmax&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;268435456&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Y luego cargamos el fichero para aplicar los cambios:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;sysctl -p&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Para comprobar que se actualizó el valor:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;cat /proc/sys/kernel/shmmax
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;268435456&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Créditos de la imagen&lt;/em&gt; »» &lt;a href=&#34;http://icons8.com/&#34; target=&#34;_blank&#34;&gt;icons8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;APC causes PHP fast-cgi to segfault&lt;/em&gt; »» &lt;a href=&#34;https://bugs.php.net/bug.php?id=56894&#34; target=&#34;_blank&#34;&gt;bugs.php.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Documentación Sysctl&lt;/em&gt; »» &lt;a href=&#34;https://www.kernel.org/doc/Documentation/sysctl/kernel.txt&#34; target=&#34;_blank&#34;&gt;kernel.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Visualiza las visitas a tu web al estilo Pong con Logstalgia</title>
            <link>https://elbauldelprogramador.com/visualiza-las-visitas-a-tu-web-al-estilo-pong-con-logstalgia/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/visualiza-las-visitas-a-tu-web-al-estilo-pong-con-logstalgia/</guid>
            <description>&lt;p&gt;Hace poco he descubierto un programa muy curioso, &lt;strong&gt;Logstalgia&lt;/strong&gt;, que a partir del fichero de log de acceso a una web crea una pantalla del juego Pong en la que cada línea del log representa una bola en el juego. Es una buena representación gráfica de lo que está pasando en el servidor web. Y su uso es bastante simple. Empecemos instalándolo:&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;# aptitude install logstalgia&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Para usarlo localmente, basta con ejecutar el siguiente comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;tail -f /var/www/mySitio/log/access.log &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; logstalgia -1280x720 --sync&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Por contra, si el servidor no es local, nos conectamos mediante ssh:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;ssh usuario@dominio.com tail -f /var/www/mySitio/log/access.log &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; logstalgia -1280x720 --sync&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Es posible guardar el un fichero la pantalla de logstalgia pasándole los siguientes parámetros:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;logstalgia -1280x720 --output-ppm-stream output.ppm --sync&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Y luego lo convertimos al formato de vídeo mp4:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;ffmpeg -y -r &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;&#34;&gt; -f image2pipe -vcodec ppm -i output.ppm -vcodec libx264 -preset ultrafast -pix_fmt yuv420p -crf &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt; -threads &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt; -bf &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt; server.log.mp4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Os dejo un vídeo del tráfico de mi modesto blog:&lt;/p&gt;

&lt;p&gt;&lt;amp-youtube
    data-videoid=&#34;5pzMBg_vvo8&#34;
    layout=&#34;responsive&#34;
    width=&#34;480&#34; height=&#34;270&#34;&gt;&lt;/amp-youtube&gt;&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Web oficial&lt;/em&gt; »» &lt;a href=&#34;https://code.google.com/p/logstalgia/&#34; target=&#34;_blank&#34;&gt;Visitar sitio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
    </channel>
</rss>
