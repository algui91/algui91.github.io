<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Administracion De Servidores on El Baúl del programador</title>
        <link>https://elbauldelprogramador.com/categories/administracion-de-servidores/</link>
        <description>Recent content in Administracion De Servidores on El Baúl del programador</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>es-ES</language>
        <lastBuildDate>Fri, 01 Jan 2016 00:00:00 +0000</lastBuildDate>
        <image>
            <url>https://elbauldelprogramador.com/img/bio-photo-rss.png</url>
            <link>https://elbauldelprogramador.com/categories/administracion-de-servidores/</link>
            <title>Administracion De Servidores on El Baúl del programador</title>
            <width>144</width>
            <height>144</height>
        </image>
        <atom:link href="https://elbauldelprogramador.com/categories/administracion-de-servidores/" rel="self" type="application/rss+xml" />
        
        <item>
            <title>Recibir alertas de correo al acceder al  sistema mediante SSH</title>
            <link>https://elbauldelprogramador.com/recibir-alertas-de-correo-ssh/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/recibir-alertas-de-correo-ssh/</guid>
            <description>&lt;p&gt;Hemos visto en otros artículos varias maneras de mejorar la seguridad en un servidor, medidas tales como:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/combatir-los-comentarios-de-spam-en-wordpress/&#34; title=&#34;Combatir los comentarios de spam en WordPress&#34;&gt;Combatir los comentarios de Spam en WordPress&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/bloquear-ataques-de-fuerza-bruta-en-nginx-y-wordpress-con-fail2ban/&#34; title=&#34;Bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban&#34;&gt;Bloquear ataques de fuerza bruta en nginx y WordPress con Fail2Ban&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/bloquear-una-ip-atacanto-el-servidor-mediante-iptables/&#34; title=&#34;Bloquear una IP atacando el servidor mediante iptables&#34;&gt;Bloquear una IP atacando el servidor mediante IPtables&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hoy veremos cómo recibir alertas de correo SSH cada vez que un usuario logre acceder al sistema mediante este protocolo. El artículo original es de &lt;a href=&#34;http://www.tecmint.com&#34; title=&#34;TecMint&#34; target=&#34;_blank&#34;&gt;tecmint&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;En linux, cada vez que un usuario accede al sistema, el archivo &lt;em&gt;.bashrc&lt;/em&gt; se ejecuta. De modo que si añadimos a dicho archivo una sentencia que nos envíe un correo, lograremos monitorizar los accesos al sistema. Antes hay que instalar un cliente de correo, aunque al ser un servidor, es probable que ya exista uno instalado.&lt;/p&gt;

&lt;h1 id=&#34;instalar-mailx&#34;&gt;Instalar MailX&lt;/h1&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;apt-get install mailx&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;modificar-el-archivo-bashrc&#34;&gt;Modificar el archivo .bashrc&lt;/h1&gt;

&lt;p&gt;Para cada usuario del que deseemos recibir alertas, habrá que añadir la siguiente línea a su &lt;em&gt;bashrc&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;n&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;ALERTA - Acceso a la Shell (ServerName) el:&amp;#39;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;&#34;&gt;who&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; mail -s &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Alerta: Acceso shell de `who | cut -d&amp;#39;(&amp;#39; -f2 | cut -d&amp;#39;)&amp;#39; -f1`&amp;#34;&lt;/span&gt;&lt;span class=&#34;&#34;&gt; correo@electrónico.com&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Listo, ahora recibiremos un correo por cada acceso al sistema.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;How to Get Root and User SSH Login Email Alerts&lt;/em&gt; »» &lt;a href=&#34;http://www.tecmint.com/get-root-ssh-login-email-alerts-in-linux&#34; target=&#34;_blank&#34;&gt;tecmint.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Solucionar fallo de segmentación en PHP cuando se usa APC</title>
            <link>https://elbauldelprogramador.com/solucionar-fallo-de-segmentacion-en-php-cuando-se-usa-apc/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/solucionar-fallo-de-segmentacion-en-php-cuando-se-usa-apc/</guid>
            <description>&lt;p&gt;Hace algún tiempo, el blog se caía de forma aleatoria y dejaba de funcionar. Tras investigar un poco descubrí que era PHP el que estaba causando el problema. En concreto ocurría un fallo de segmentación en PHP que no conseguía averiguar de dónde procedían. Buscando y buscando al final dí con el problema, en realidad lo que provocaba el problema no era PHP, si no una consecuencia de usar APC y el parámetro &lt;code&gt;apc.shm_size&lt;/code&gt; junto con el parámetro del kernel &lt;code&gt;kernel.shmmax&lt;/code&gt;. El propósito de este artículo es dejar constancia de cómo se solucionó el problema por si alguien se encontrara en la misma situación.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;para-qué-sirve-el-parámetro-proc-sys-kernel-shmmax&#34;&gt;Para qué sirve el parámetro /proc/sys/kernel/shmmax&lt;/h1&gt;

&lt;p&gt;Según la documentación del kernel:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;shmmax:&lt;/p&gt;

&lt;p&gt;This value can be used to query and set the run time limit
on the maximum shared memory segment size that can be created.
Shared memory segments up to 1Gb are now supported in the
kernel. This value defaults to SHMMAX.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Traducido:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;shmmax:&lt;/p&gt;

&lt;p&gt;Este valor puede usarse para consultar y establecer el límite máximo del segmento de memoria compartida que puede crearse. Se soportan segmentos de memoria compartida de hasta 1Gb. Su valor por defecto está definido por la constante SHMMAX.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;para-qué-sirve-el-parámetro-apc-shm-size&#34;&gt;Para qué sirve el parámetro apc.shm_size&lt;/h1&gt;

&lt;p&gt;Según la documentación de APC:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;El tamaño de cada segmento de memoria compartida en MB. Por defecto, algunos sistemas (incluidos la mayoría de variantes de BSD) tienen límites muy bajos del tamaño de un segmento de memoria compartida.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Sabiendo para qué sirve cada parámetro, en un foro encontré la respuesta a la solución:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;From my Linux experience, this bug is caused only by one thing:&lt;/p&gt;

&lt;p&gt;Wrongly set SHM size in kernel and/or APC settings. With standard apc.shm_size = 30, i get segfault (11) every time i try to spawn php-cgi processes. But once i do the following:&lt;/p&gt;

&lt;p&gt;echo &amp;#8220;512000000&amp;#8221; &amp;gt; /proc/sys/kernel/shmmax
set apc.shm_size = 64M&lt;/p&gt;

&lt;p&gt;Then the problem completely disappears. PHP with APC becomes ROCK-solid, and NEVER segfaults running &lt;sup&gt;24&lt;/sup&gt;&amp;frasl;&lt;sub&gt;7&lt;/sub&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Por tanto, incrementando el valor del parámetro &lt;code&gt;/proc/sys/kernel/shmmax&lt;/code&gt; a un valor igual o mayor que el del parámetro &lt;code&gt;apc.shm_size&lt;/code&gt; de APC soluciona el problema. Desde que apliqué este cambio no he vuelto a tener caídas en los procesos de PHP.&lt;/p&gt;

&lt;h1 id=&#34;algunas-notas-a-tener-en-cuenta&#34;&gt;Algunas notas a tener en cuenta&lt;/h1&gt;

&lt;p&gt;El parámetro del kernel se puede cambiar de varias formas, tal y como mencionaba el usuario del foro se cambia únicamente durante la sesión activa del Sistema Operativo, tras reiniciar el servidor se establecerá su valor por defecto (30Mb). Para hacer los cambios permanentes, debemos escribir el valor del parámetro en el fichero &lt;em&gt;/etc/sysctl.conf&lt;/em&gt; o en &lt;em&gt;/etc/sysctl.d/99-sysctl.conf&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Por ejemplo, para establecer el valor a 256 Mb escribiríamos al final de uno de estos archivos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;kernel.shmmax&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;268435456&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Y luego cargamos el fichero para aplicar los cambios:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;sysctl -p&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Para comprobar que se actualizó el valor:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;cat /proc/sys/kernel/shmmax
&lt;/span&gt;&lt;span class=&#34;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;268435456&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Créditos de la imagen&lt;/em&gt; »» &lt;a href=&#34;http://icons8.com/&#34; target=&#34;_blank&#34;&gt;icons8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;APC causes PHP fast-cgi to segfault&lt;/em&gt; »» &lt;a href=&#34;https://bugs.php.net/bug.php?id=56894&#34; target=&#34;_blank&#34;&gt;bugs.php.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Documentación Sysctl&lt;/em&gt; »» &lt;a href=&#34;https://www.kernel.org/doc/Documentation/sysctl/kernel.txt&#34; target=&#34;_blank&#34;&gt;kernel.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Visualiza las visitas a tu web al estilo Pong con Logstalgia</title>
            <link>https://elbauldelprogramador.com/visualiza-las-visitas-a-tu-web-al-estilo-pong-con-logstalgia/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/visualiza-las-visitas-a-tu-web-al-estilo-pong-con-logstalgia/</guid>
            <description>&lt;p&gt;Hace poco he descubierto un programa muy curioso, &lt;strong&gt;Logstalgia&lt;/strong&gt;, que a partir del fichero de log de acceso a una web crea una pantalla del juego Pong en la que cada línea del log representa una bola en el juego. Es una buena representación gráfica de lo que está pasando en el servidor web. Y su uso es bastante simple. Empecemos instalándolo:&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;# aptitude install logstalgia&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Para usarlo localmente, basta con ejecutar el siguiente comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;tail -f /var/www/mySitio/log/access.log &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; logstalgia -1280x720 --sync&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Por contra, si el servidor no es local, nos conectamos mediante ssh:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;ssh usuario@dominio.com tail -f /var/www/mySitio/log/access.log &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;&#34;&gt; logstalgia -1280x720 --sync&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Es posible guardar el un fichero la pantalla de logstalgia pasándole los siguientes parámetros:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;logstalgia -1280x720 --output-ppm-stream output.ppm --sync&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Y luego lo convertimos al formato de vídeo mp4:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;&#34;&gt;ffmpeg -y -r &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;&#34;&gt; -f image2pipe -vcodec ppm -i output.ppm -vcodec libx264 -preset ultrafast -pix_fmt yuv420p -crf &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;&#34;&gt; -threads &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt; -bf &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;&#34;&gt; server.log.mp4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Os dejo un vídeo del tráfico de mi modesto blog:&lt;/p&gt;

&lt;p&gt;&lt;amp-youtube
    data-videoid=&#34;5pzMBg_vvo8&#34;
    layout=&#34;responsive&#34;
    width=&#34;480&#34; height=&#34;270&#34;&gt;&lt;/amp-youtube&gt;&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Web oficial&lt;/em&gt; »» &lt;a href=&#34;https://code.google.com/p/logstalgia/&#34; target=&#34;_blank&#34;&gt;Visitar sitio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
    </channel>
</rss>
