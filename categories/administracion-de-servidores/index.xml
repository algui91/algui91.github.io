<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Administracion De Servidores on El Baúl del programador</title>
        <link>https://elbauldelprogramador.com/categories/administracion-de-servidores/</link>
        <description>Recent content in Administracion De Servidores on El Baúl del programador</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>es-ES</language>
        <lastBuildDate>Fri, 01 Jan 2016 00:00:00 +0000</lastBuildDate>
        <image>
            <url>https://elbauldelprogramador.com/img/bio-photo-rss.png</url>
            <link>https://elbauldelprogramador.com/categories/administracion-de-servidores/</link>
            <title>Administracion De Servidores on El Baúl del programador</title>
            <width>144</width>
            <height>144</height>
        </image>
        <atom:link href="https://elbauldelprogramador.com/categories/administracion-de-servidores/" rel="self" type="application/rss+xml" />
        
        <item>
            <title>Bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban</title>
            <link>https://elbauldelprogramador.com/bloquear-ataques-de-fuerza-bruta-en-nginx-y-wordpress-con-fail2ban/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/bloquear-ataques-de-fuerza-bruta-en-nginx-y-wordpress-con-fail2ban/</guid>
            <description>&lt;figure&gt;
  &lt;img on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2013/11/Bloquear-ataques-de-fuerza-bruta-en-Nginx-y-Wordpress-con-Fail2Ban2.png&#34; title=&#34;{{ page.title }}&#34; alt=&#34;{{ page.title }}&#34; width=&#34;600px&#34; height=&#34;600px&#34;&gt;&lt;/img&gt;
&lt;/figure&gt;

&lt;p&gt;Cuando se administra un servidor, te das cuenta de la cantidad de máquinas automatizadas que existen realizando ataques de fuerza bruta hacia tu servidor. Para poner fin a algunos de estos ataques existe una herramienta llamada &lt;strong&gt;&lt;em&gt;Fail2Ban&lt;/em&gt;&lt;/strong&gt;, que monitoriza los logs del sistema para detectar estos ataques y mitigarlos. En este artículos veremos cómo configurar &lt;strong&gt;Fail2Ban&lt;/strong&gt; para bloquear el acceso a nuestra máquina a robots atacando por &lt;a href=&#34;https://elbauldelprogramador.com/bloquear-una-ip-atacanto-el-servidor-mediante-iptables/&#34; title=&#34;Bloquear una IP atacando el servidor mediante iptables&#34;&gt;fuerza bruta&lt;/a&gt; a &lt;em&gt;WordPress&lt;/em&gt; y al servidor web &lt;em&gt;&lt;a href=&#34;https://elbauldelprogramador.com/como-instalar-nginx-con-php5-fpm/&#34; title=&#34;Cómo instalar y configurar Nginx con php5-fpm&#34;&gt;Nginx&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;instalar-fail2ban&#34;&gt;Instalar Fail2Ban&lt;/h1&gt;

&lt;p&gt;Si no se encuentra instalado en nuestro sistema:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install fail2ban
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;antes-de-empezar&#34;&gt;Antes de empezar&lt;/h1&gt;

&lt;p&gt;Antes de modificar el archivo &lt;em&gt;/etc/fail2ban/jail.conf&lt;/em&gt;, es recomendable -y de hecho lo menciona el propio archivo en su cabecera &amp;#8212; realizar una copia y trabajar sobre ella:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /etc/fail2ban &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; cp jail.conf jail.local
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;bloquear-ataques-de-fuerza-bruta-a-wordpress&#34;&gt;Bloquear ataques de fuerza bruta a WordPress&lt;/h1&gt;

&lt;p&gt;La siguiente configuración bloqueará durante 20 minutos cualquier intento de loggearse en WordPress de forma incorrecta más de 3 veces. Hay que escribirla en el &lt;em&gt;jail.local&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;nginx-wp-login&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;

&lt;span class=&#34;nv&#34;&gt;enabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; http,https
&lt;span class=&#34;nv&#34;&gt;filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; nginx-wp-login
&lt;span class=&#34;nv&#34;&gt;logpath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /ruta/log/wordpress/access.log
&lt;span class=&#34;nv&#34;&gt;maxretry&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 3
&lt;span class=&#34;nv&#34;&gt;findtime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 120
&lt;span class=&#34;nv&#34;&gt;bantime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 1200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ahora queda añadir el filtro para esta regla, en el archivo &lt;em&gt;filter.d/nginx-wp-login.conf&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Definition&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;

&lt;span class=&#34;nv&#34;&gt;failregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &amp;lt;host&amp;gt;.*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;POST /wp-login.php&lt;/span&gt;
&lt;span class=&#34;s2&#34;&gt;ignoreregex =&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;inconvenientes-a-tener-en-cuenta&#34;&gt;Inconvenientes a tener en cuenta&lt;/h1&gt;

&lt;p&gt;Con esta configuración, hay que considerar que:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Los usuarios que no recuerden su contraseña se autobloquearán.&lt;/li&gt;
&lt;li&gt;No te protegerá eficientemente de un ataque distribuido.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;configurar-nginx-con-fail2ban&#34;&gt;Configurar Nginx con Fail2Ban&lt;/h2&gt;

&lt;p&gt;Las siguientes configuraciones serán a nivel del servidor web nginx, no de WordPress, los objetivos son:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Bloquear a todo aquel intentando ejecutar scripts (.pl, .cgi, .exe etc).&lt;/li&gt;
&lt;li&gt;Bloquear a todo aquel intentando usar el servidor como un proxy.&lt;/li&gt;
&lt;li&gt;Bloquear a todo aquel que falle al usar la autentificación básica de nginx.&lt;/li&gt;
&lt;li&gt;Bloquear a todo aquel que falle al autentificarse en nuestra aplicación.&lt;/li&gt;
&lt;li&gt;Bloquear &lt;strong&gt;bad bots&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Al igual que antes, en el fichero &lt;em&gt;jail.local&lt;/em&gt; añadimos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;nginx-auth&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;enabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; nginx-auth
&lt;span class=&#34;nv&#34;&gt;action&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; iptables-multiport&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;NoAuthFailures, &lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;http,https&amp;quot;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;logpath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /var/log/nginx*/*error*.log
&lt;span class=&#34;nv&#34;&gt;bantime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;600&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 10 minutes&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;maxretry&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 6

&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;nginx-login&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;enabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; nginx-login
&lt;span class=&#34;nv&#34;&gt;action&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; iptables-multiport&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;NoLoginFailures, &lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;http,https&amp;quot;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;logpath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /var/log/nginx*/*access*.log
&lt;span class=&#34;nv&#34;&gt;bantime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;600&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 10 minutes&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;maxretry&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 6

&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;nginx-badbots&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;enabled&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; apache-badbots
&lt;span class=&#34;nv&#34;&gt;action&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; iptables-multiport&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;BadBots, &lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;http,https&amp;quot;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;logpath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /var/log/nginx*/*access*.log
&lt;span class=&#34;nv&#34;&gt;bantime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;86400&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 1 day&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;maxretry&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 1

&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;nginx-noscript&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;enabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;action&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; iptables-multiport&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;NoScript, &lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;http,https&amp;quot;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; nginx-noscript
&lt;span class=&#34;nv&#34;&gt;logpath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /var/log/nginx*/*access*.log
&lt;span class=&#34;nv&#34;&gt;maxretry&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 6
&lt;span class=&#34;nv&#34;&gt;bantime&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;86400&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 1 day&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;nginx-proxy&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;enabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;action&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; iptables-multiport&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;NoProxy, &lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;http,https&amp;quot;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; nginx-proxy
&lt;span class=&#34;nv&#34;&gt;logpath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /var/log/nginx*/*access*.log
&lt;span class=&#34;nv&#34;&gt;maxretry&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 0
&lt;span class=&#34;nv&#34;&gt;bantime&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;86400&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 1 day&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Y sus correspondientes filtros en &lt;em&gt;/etc/fail2ban/filter.d/&lt;/em&gt; (Cada uno en un fichero separado, con el mismo nombre que aparece en la primera línea):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Proxy filter /etc/fail2ban/filter.d/proxy.conf:&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Block IPs trying to use server as proxy.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Matches e.g.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# 192.168.1.1 - - &amp;quot;GET http://www.something.com/&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Definition&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;failregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; ^&amp;lt;host&amp;gt; -.*GET http.*
&lt;span class=&#34;nv&#34;&gt;ignoreregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Noscript filter /etc/fail2ban/filter.d/nginx-noscript.conf:&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Block IPs trying to execute scripts such as .php, .pl, .exe and other funny scripts.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Matches e.g.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# 192.168.1.1 - - &amp;quot;GET /something.php&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Definition&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;failregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; ^&amp;lt;host&amp;gt; -.*GET.*&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;php&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;asp&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;exe&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;pl&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;cgi&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;cgi&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;ignoreregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Auth filter /etc/fail2ban/filter.d/nginx-auth.conf:&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Blocks IPs that fail to authenticate using basic authentication&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Definition&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;

&lt;span class=&#34;nv&#34;&gt;failregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; no user/password was provided &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; basic authentication.*client: &amp;lt;host&amp;gt;
            user .* was not found in.*client: &amp;lt;host&amp;gt;
            user .* password mismatch.*client: &amp;lt;host&amp;gt;

&lt;span class=&#34;nv&#34;&gt;ignoreregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Login filter /etc/fail2ban/filter.d/nginx-login.conf:&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Blocks IPs that fail to authenticate using web application&amp;#39;s log in page&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Scan access log for HTTP 200 + POST /sessions =&amp;gt; failed log in&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Definition&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;failregex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; ^&amp;lt;host&amp;gt; -.*POST /sessions HTTP/1&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;.&lt;span class=&#34;s2&#34;&gt;&amp;quot; 200&lt;/span&gt;
&lt;span class=&#34;s2&#34;&gt;ignoreregex =&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;enviar-por-correo-los-bloqueos&#34;&gt;Enviar por correo los bloqueos&lt;/h1&gt;

&lt;p&gt;Para terminar, si queremos recibir un correo por cada bloqueo que se produzca, basta con añadir estas dos líneas al fichero &lt;em&gt;jail.local&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;destemail&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; direccion@correo
&lt;span class=&#34;nv&#34;&gt;mta&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; sendmail
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;¿Administras un servidor? ¿Qué técnicas usas?, deja un comentario.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Fail2Ban para wordpress&lt;/em&gt; »» &lt;a href=&#34;http://codepoets.co.uk/2013/fail2ban-filter-for-wordpress/&#34; target=&#34;_blank&#34;&gt;codepoets.co.uk&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Fail2Ban para Nginx&lt;/em&gt; »» &lt;a href=&#34;http://snippets.aktagon.com/snippets/554-how-to-secure-an-nginx-server-with-fail2ban&#34; target=&#34;_blank&#34;&gt;snippets.aktagon.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Combatir los comentarios de spam en WordPress</title>
            <link>https://elbauldelprogramador.com/combatir-los-comentarios-de-spam-en-wordpress/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/combatir-los-comentarios-de-spam-en-wordpress/</guid>
            <description>&lt;figure&gt;
        &lt;a href=&#34;https://elbauldelprogramador.com/img/2013/11/Bloquear-ataques-de-fuerza-bruta-en-Nginx-y-Wordpress-con-Fail2Ban2.png&#34;&gt;
          &lt;img
            on=&#34;tap:lightbox1&#34;
            role=&#34;button&#34;
            tabindex=&#34;0&#34;
            layout=&#34;responsive&#34;
            src=&#34;https://elbauldelprogramador.com/img/2013/11/Bloquear-ataques-de-fuerza-bruta-en-Nginx-y-Wordpress-con-Fail2Ban2.png&#34;
            alt=&#34;Combatir los comentarios de spam en Wordpress&#34;
            title=&#34;Combatir los comentarios de spam en Wordpress&#34;
            sizes=&#34;(min-width: 600px) 600px, 100vw&#34;
            width=&#34;600&#34;
            height=&#34;600&#34;&gt;
          &lt;/img&gt;
        &lt;/a&gt;
        &lt;figcaption&gt;Combatir los comentarios de spam en Wordpress&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Los comentarios de spam son algo frecuente en internet, y WordPress no es una excepción. Hace poco vimos cómo &lt;a href=&#34;https://elbauldelprogramador.com/bloquear-ataques-de-fuerza-bruta-en-nginx-y-wordpress-con-fail2ban/&#34; title=&#34;Bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban&#34;&gt;bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban&lt;/a&gt;. Hoy veremos cómo evitar que se nos inunde la cola de comentarios pendientes o de spam, en mi caso rondan los 200-300 comentarios diarios.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;p&gt;Existe un plugin llamado &lt;a href=&#34;http://akismet.com/&#34; title=&#34;Plugins Askimet&#34; target=&#34;_blank&#34;&gt;Askimet&lt;/a&gt; que facilita muchísimo la tarea de detectar comentarios de spam y enviarlos a su correspondiente sección en WordPress. Quizá por eso me ha resultado tan sencillo contruir esta solución para bloquear el acceso a todos los bots que continuamente publican comentarios de este tipo.&lt;/p&gt;

&lt;h1 id=&#34;recopilar-las-direcciones-ips-de-los-spammers&#34;&gt;Recopilar las direcciones IPs de los spammers&lt;/h1&gt;

&lt;p&gt;Esto es algo trivial, WordPress siempre muestra la IP desde la que se realiza el comentario. Sin embargo recopilar la dirección de 200 comentarios puede ser una tarea ardua. Será más sencillo extraer esta información de la &lt;a href=&#34;https://elbauldelprogramador.com/bases-de-datos/&#34; title=&#34;Bases de Datos&#34;&gt;base de datos&lt;/a&gt; con una consulta &lt;a href=&#34;https://elbauldelprogramador.com/consulta-de-datos-clausula-select/&#34; title=&#34;Consulta de Datos – Cláusula Select&#34;&gt;SELECT&lt;/a&gt;. La tabla en la que nos interesa realizar la consulta es &lt;strong&gt;wp_comments&lt;/strong&gt;, y el único campo que deseamos extraer es la dirección IP (Columna &lt;strong&gt;comment_author_IP&lt;/strong&gt; de la tabla anterior). Para evitar que se repitan la direcciones IPs usaremos la opción &lt;strong&gt;DISTINC&lt;/strong&gt;. Seleccionaremos únicamente los comentarios que estén marcados como spam, lo cual corresponde a que el campo &lt;strong&gt;comment_approved&lt;/strong&gt; tenga el valor &amp;#8220;&lt;strong&gt;spam&lt;/strong&gt;&amp;#8220;. La consulta quedará así:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DISTINCT&lt;/span&gt;  &lt;span class=&#34;ss&#34;&gt;`comment_author_IP`&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;  &lt;span class=&#34;ss&#34;&gt;`wp_comments`&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;  &lt;span class=&#34;ss&#34;&gt;`comment_approved`&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;s1&#34;&gt;&amp;#39;spam&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Usando &lt;em&gt;phpmyadmin&lt;/em&gt; podremos exportar el resultado a un archivo de texto para tener las IPs almacenadas con el siguiente formato:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;x.x.x.x
y.y.y.y
z.z.z.z
.......
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Almacenarlas así nos facilitará la automatización para bloquearles el acceso.&lt;/p&gt;

&lt;h1 id=&#34;bloquear-el-spam&#34;&gt;Bloquear el spam&lt;/h1&gt;

&lt;p&gt;Una vez tenemos el archivo con las IPs de los spammers, procedemos bloquearlos mediante &lt;a href=&#34;https://elbauldelprogramador.com/20-ejemplos-de-iptables-para-sysadmins/&#34; title=&#34;20 ejemplos de iptables para SysAdmins novatos&#34;&gt;iptables&lt;/a&gt;, de tal forma que no lograrán ni acceder al sitio web, ya que Iptables les denegará el acceso. Usaremos el siguiente &lt;a href=&#34;https://elbauldelprogramador.com/&#34; title=&#34;Scripts del blog&#34;&gt;script&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;ch&#34;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&#34;nv&#34;&gt;inet_if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;eth0

&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$#&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
    &lt;span class=&#34;nv&#34;&gt;esta&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;iptables -nL &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -z &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$e&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;sta&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;Bloqueado &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;
        iptables -i &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;inet_if&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -A INPUT -s &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt; -j LOG --log-prefix &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$2&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &amp;quot;&lt;/span&gt;
        iptables -i &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;inet_if&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -A INPUT -s &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt; -j DROP
    &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;Ya está bloqueado&amp;quot;&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$e&lt;/span&gt;sta
    &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$0&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &amp;lt;ip&amp;gt; &amp;lt;comentario&amp;gt;&amp;quot;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Tras guardar el script con el nombre deseado, el uso es el siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;./nombre_script.sh &amp;lt;/comentario&amp;gt;&amp;lt;/ip&amp;gt;&amp;lt;ip&amp;gt; &amp;lt;mensaje &lt;span class=&#34;nv&#34;&gt;en&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;en&amp;quot;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;el&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;el&amp;quot;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;log&amp;quot;&lt;/span&gt;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Si la IP ya está bloqueada, no se añadirá otra entrada a Iptables, el segundo parámetro aparecerá en los logs del sistema, algo así:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;Dec  &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; 18:40:36 nombreServidor kernel: &amp;lt;/mensaje&amp;gt;&amp;lt;mensaje &lt;span class=&#34;nv&#34;&gt;en&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;EN&amp;quot;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;el&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;EL&amp;quot;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;LOG&amp;quot;&lt;/span&gt;&amp;gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;eth0 &lt;span class=&#34;nv&#34;&gt;OUT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;MAC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XXXXXXXXXXXXXX &lt;span class=&#34;nv&#34;&gt;SRC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X.X.X.X &lt;span class=&#34;nv&#34;&gt;DST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Y.Y.Y.Y &lt;span class=&#34;nv&#34;&gt;LEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X &lt;span class=&#34;nv&#34;&gt;TOS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X &lt;span class=&#34;nv&#34;&gt;PREC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X &lt;span class=&#34;nv&#34;&gt;TTL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X &lt;span class=&#34;nv&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X DF &lt;span class=&#34;nv&#34;&gt;PROTO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;TCP &lt;span class=&#34;nv&#34;&gt;SPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XX &lt;span class=&#34;nv&#34;&gt;DPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XX &lt;span class=&#34;nv&#34;&gt;WINDOW&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XXX &lt;span class=&#34;nv&#34;&gt;RES&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XXX SYN &lt;span class=&#34;nv&#34;&gt;URGP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Para automatizar el bloqueo, recorreremos cada una de las líneas del archivo que hemos exportado de la base de datos con las direcciones IPs de los spammers:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;cat spammers.txt&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
   ./nombre_script.sh &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;i&amp;quot;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;Comentario SPAM&amp;quot;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Y listo, si listamos las reglas de Iptables tendremos algo parecido a esto:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;iptables -L
Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
DROP       all  --  X.X.X.X        anywhere
LOG        all  --  X.X.X.X        anywhere            LOG level warning prefix &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;Comentario SPAM&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;span class=&#34;s1&#34;&gt;DROP       all  --  Y.Y.Y.Y        anywhere&lt;/span&gt;
&lt;span class=&#34;s1&#34;&gt;LOG        all  --  Y.Y.Y.Y        anywhere            LOG level warning prefix `Comentario SPAM&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A partir de ahora, se notará un descenso drástico en los comentarios de spam. Espero que haya servido de ayuda.&lt;/p&gt;</description>
        </item>
        
        <item>
            <title>Cómo cifrar archivos con openssl</title>
            <link>https://elbauldelprogramador.com/como-cifrar-archivos-con-openssl/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/como-cifrar-archivos-con-openssl/</guid>
            <description>&lt;figure&gt;
          &lt;img
            on=&#34;tap:lightbox1&#34;
            role=&#34;button&#34;
            tabindex=&#34;0&#34;
            layout=&#34;responsive&#34;
            src=&#34;https://elbauldelprogramador.com/img/2012/11/Apps-preferences-desktop-cryptography-icon1.png&#34;
            alt=&#34;Cómo cifrar archivos con openssl&#34;
            title=&#34;Cómo cifrar archivos con openssl&#34;
            sizes=&#34;(min-width: 256px) 256px, 100vw&#34;
            width=&#34;256&#34;
            height=&#34;256&#34;&gt;
          &lt;/img&gt;
&lt;/figure&gt;

&lt;p&gt;Las copias de seguridad son algo que debemos tener a buen resguardo por si algún dia le ocurre algo a nuestros datos. Si bien lo anterior es cierto, de igual modo hemos de tener bien protegidas éstas copias de seguridad para que no puedan ser usadas por terceros de caer en manos maliciosas. Hoy veremos cómo &lt;strong&gt;cifrar archivos con openssl&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;generar-las-claves-públicas-y-privadas&#34;&gt;Generar las claves públicas y privadas&lt;/h1&gt;

&lt;p&gt;Al igual que en &lt;a href=&#34;https://elbauldelprogramador.com/editar-y-crear-archivos-cifrados-con-gpg-en-vim/&#34;&gt;GPG&lt;/a&gt;, necesitaremos generar un par de claves, pública y privada, para poder cifrar archivos con openssl:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ openssl genrsa -out clave.pem 4096
$ openssl rsa -in clave.pem -out clave.pub.pem -outform PEM -pubout
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Con el primer comando generamos la clave, en &lt;em&gt;clave.pem&lt;/em&gt; se encuentran tanto la clave privada como la pública, con el segundo comando extraemos la pública a un archivo distinto.&lt;/p&gt;

&lt;h1 id=&#34;método-elegido-para-cifrar-los-archivos&#34;&gt;Método elegido para cifrar los archivos&lt;/h1&gt;

&lt;p&gt;El sistema de claves pública/privada no puede cifrar archivos de gran tamaño. Por tanto usaremos un &lt;a href=&#34;http://es.wikipedia.org/wiki/Criptograf%C3%ADa_sim%C3%A9trica&#34; target=&#34;_blank&#34;&gt;cifrado simétrico&lt;/a&gt; para el cifrado normal. Cada vez que cifremos un fichero se usará una clave simétrica generada aleatoriamente. Esta clave simétrica es la que &lt;strong&gt;cifraremos de forma &lt;a href=&#34;http://es.wikipedia.org/wiki/Criptograf%C3%ADa_asim%C3%A9trica&#34; target=&#34;_blank&#34;&gt;asimétrica&lt;/a&gt;&lt;/strong&gt; con la &lt;strong&gt;llave pública&lt;/strong&gt; que hemos generado con los comandos de arriba. En resumen:&lt;/p&gt;

&lt;h2 id=&#34;para-cifrar-los-archivos&#34;&gt;Para cifrar los archivos&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;Generamos una clave aleatoriamente, de gran longitud (40-50 caracteres por ejemplo).&lt;/li&gt;
&lt;li&gt;Ciframos el archivo con la clave generada en 1.&lt;/li&gt;
&lt;li&gt;Ciframos la clave generada en 1 con nuestra clave pública.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;para-descifrar-los-archivos&#34;&gt;Para descifrar los archivos&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;Desciframos la clave generada en 1 y cifrada con la llave pública en 3&lt;/li&gt;
&lt;li&gt;Desciframos el archivo con la clave que acabamos de descifrar en 1&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&#34;aplicar-los-pasos-con-openssl&#34;&gt;Aplicar los pasos con openssl&lt;/h1&gt;

&lt;p&gt;Ahora procedemos a aplicar los pasos descritos anteriormente con openssl:&lt;/p&gt;

&lt;h2 id=&#34;cifrando-los-archivos&#34;&gt;Cifrando los archivos&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Paso 1, generar clave aleatoria&lt;/span&gt;
$ openssl rand -base64 &lt;span class=&#34;m&#34;&gt;48&lt;/span&gt; -out key.txt
&lt;span class=&#34;c1&#34;&gt;# Paso 2, cifrar el archivo con la clave simétrica&lt;/span&gt;
$ openssl enc -aes-256-cbc -pass file:key.txt -in archivoSINcifrar -out archivoCIFRADO.encrypted
&lt;span class=&#34;c1&#34;&gt;# Paso 3, cifrar la clave generada en el paso 1 con la llave pública&lt;/span&gt;
$ openssl rsautl -encrypt -in key.txt -out key.enc -inkey clave.pub.pem -pubin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Los argumentos significan:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;enc -aes-256-cbc:&lt;/strong&gt; Tipo de cifrado simétrico.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-pass file:key.txt:&lt;/strong&gt; La clave con la que cifrar el archivo.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-in:&lt;/strong&gt; Fichero de entrada.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-out:&lt;/strong&gt; Fichero de salida.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rsautl:&lt;/strong&gt; Indica que vamos a usar RSA para firmar, verificar, cifrar o descifrar.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-encrypt:&lt;/strong&gt; Encriptar el fichero de entrada con una llave RSA pública.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-inkey:&lt;/strong&gt; Llave con la que cifrar&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-pubin:&lt;/strong&gt; Indica que vamos a firmar con una llave pública.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;descifrado-de-archivos&#34;&gt;Descifrado de archivos&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Paso 1, desciframos la clave generada en 1 y cifrada con la llave pública en 3&lt;/span&gt;
$ openssl rsautl -decrypt -inkey ./clave.pem -in key.enc -out key.txt
&lt;span class=&#34;c1&#34;&gt;# Paso 2, Descifrar el archivo con la clave&lt;/span&gt;
$ openssl enc -aes-256-cbc -d -pass file:key.txt -in archivoCIFRADO.encrypted -out archivoSINcifrar
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Donde:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;-d:&lt;/strong&gt; Descifra los datos de entrada.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;script-para-descifrar-varios-archivos-de-una-vez&#34;&gt;Script para descifrar varios archivos de una vez&lt;/h1&gt;

&lt;p&gt;Como suele ser habitual, los &lt;a href=&#34;https://elbauldelprogramador.com/&#34;&gt;scripts bash&lt;/a&gt; nos facilitan las tareas repetitivas, con los comandos de arriba, es trivial escribir un &lt;strong&gt;script&lt;/strong&gt; que automatize el proceso de descrifrar todos los archivos de un directorio:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#/bin/bash&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$#&lt;/span&gt; -ne &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;Usage: &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$0&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &amp;lt;directorio a=&amp;quot;&lt;/span&gt;a&lt;span class=&#34;s2&#34;&gt;&amp;quot; los=&amp;quot;&lt;/span&gt;los&lt;span class=&#34;s2&#34;&gt;&amp;quot; archivos=&amp;quot;&lt;/span&gt;archivos&lt;span class=&#34;s2&#34;&gt;&amp;quot; cifrados=&amp;quot;&lt;/span&gt;cifrados&lt;span class=&#34;s2&#34;&gt;&amp;quot;&amp;gt;&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;

openssl rsautl -decrypt -inkey ./clave.pem -in &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/key.enc&amp;quot;&lt;/span&gt; -out &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/key.txt&amp;quot;&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;openssl rsautl -decrypt -inkey ./clave.pem -in \&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/key.enc\&amp;quot; -out \&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/key.txt\&amp;quot;&amp;quot;&lt;/span&gt;

&lt;span class=&#34;nv&#34;&gt;OIFS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;IFS&amp;quot;&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;IFS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;$&amp;#39;\n&amp;#39;&lt;/span&gt;


&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;find &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt; -type f -name &lt;span class=&#34;s2&#34;&gt;&amp;quot;*.encrypted&amp;quot;&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;Decrypting &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;i&amp;quot;&lt;/span&gt;
    openssl enc -aes-256-cbc -d -pass file:&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/key.txt&amp;quot;&lt;/span&gt; -in &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;i&amp;quot;&lt;/span&gt; -out &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;/&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;basename &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;i&amp;quot;&lt;/span&gt; .encrypted&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;

&lt;span class=&#34;nv&#34;&gt;IFS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;OIFS&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Espero que os sea de utilidad.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Encrypt tar.gz file on create&lt;/em&gt; »» &lt;a href=&#34;http://askubuntu.com/questions/95920/encrypt-tar-gz-file-on-create/96182#96182&#34; target=&#34;_blank&#34;&gt;askubuntu.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;how to encrypt a large file in openssl using public key&lt;/em&gt; »» &lt;a href=&#34;http://stackoverflow.com/questions/7143514/how-to-encrypt-a-large-file-in-openssl-using-public-key&#34; target=&#34;_blank&#34;&gt;stackoverflow.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Documentación oficial de openssl&lt;/em&gt; »» &lt;a href=&#34;http://www.openssl.org/docs/apps/openssl.html&#34; target=&#34;_blank&#34;&gt;Visitar sitio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Cómo configurar un balanceador de carga en entornos cloud</title>
            <link>https://elbauldelprogramador.com/como-configurar-un-balanceador-de-carga-en-entornos-cloud/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/como-configurar-un-balanceador-de-carga-en-entornos-cloud/</guid>
            <description>&lt;p&gt;Hoy vamos a hablar de cómo configurar un Balanceador de carga para un servidor. Veremos dos alternativas, configurarlo todo a mano, o desde un entorno cloud virtualizado, desde el panel de control de &lt;a href=&#34;http://www.arsys.es/servidores/cloud?utm_source=cooperation&amp;amp;utm;_medium=baul&amp;amp;utm;_term=balanceador&amp;amp;utm;_content=online&amp;amp;utm;_campaign=cloud&#34;&gt;Arsys&lt;/a&gt;. Está claro que, la segunda opción, será mucho más sencilla. Aún así, con la primera se aprenderá qué está pasando realmente por debajo.&lt;/p&gt;

&lt;h1 id=&#34;tecnologías-a-usar&#34;&gt;Tecnologías a usar&lt;/h1&gt;

&lt;p&gt;Para configurar el load balancer a mano, usaremos nginx.&lt;/p&gt;

&lt;h1 id=&#34;introducción&#34;&gt;Introducción&lt;/h1&gt;

&lt;p&gt;Balancear cargas a lo largo de múltiples instancias de aplicaciones es una técnica muy usada para optimizar la utilización de recursos, maximizar el rendimiento, reducir latencia, y asegurar tolerancia a fallos.&lt;/p&gt;

&lt;p&gt;Nginx puede configurarse para hacer las veces de un balanceador de carga Http para distribuir el tráfico a varios servidores de aplicaciones.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;métodos-de-balanceo-en-nginx&#34;&gt;Métodos de balanceo en nginx&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Round-Robin&lt;/em&gt;: Las peticiones a los servidores se distribuyen al estilo round robin.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;least-connected&lt;/em&gt;: La siguiente petición se asigna al servidor con menos conexiones activas.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ip-hash&lt;/em&gt;: Se usa una función hash para determinar el servidor al que debería enviarse la siguiente petición, basándose en la ip del cliente.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;configuraciones-por-defecto&#34;&gt;Configuraciones por defecto&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;http &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    upstream myapp1 &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        server srv1.example.com&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server srv2.example.com&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server srv3.example.com&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    server &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        listen 80&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

        location / &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            proxy_pass http://myapp1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;En este ejemplo, hay 3 instancias de la misma aplicación. ejecutándose en srv1-srv3. Si no se especifíca ningún método de balanceo, se aplica round-robin. Todas las peticiones se redirigen al grupo de servidores &lt;code&gt;myapp1&lt;/code&gt; y nginx se encarga de realizar el balanceo Http mediante round-robin.&lt;/p&gt;

&lt;h2 id=&#34;balanceo-least-connected&#34;&gt;Balanceo Least Connected&lt;/h2&gt;

&lt;p&gt;En este método de balanceo, se permite controlar la carga que reciben los servidores. Nginx intentará no sobrecargar un servidor ocupado con demasiadas peticiones, enviándolas a los servidores menos ocupados.&lt;/p&gt;

&lt;p&gt;Para activar este método, hay que añadir la directiva &lt;code&gt;least_conn&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;upstream myapp1 &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        least_conn&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server srv1.example.com&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server srv2.example.com&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server srv3.example.com&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;balanceo-ponderado&#34;&gt;Balanceo ponderado&lt;/h1&gt;

&lt;p&gt;Si se quiere dar más ponderación, es posible usar el parámetro &lt;code&gt;weight&lt;/code&gt; en los servidores, para asignarles más “peso” a la hora de tomar decisiones de balanceo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;upstream myapp1 &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        server srv1.example.com &lt;span class=&#34;nv&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;3&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server srv2.example.com&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server srv3.example.com&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Con esta configuración, 5 peticiones nuevas se distribuirán de la siguiente forma: 3 a srv1, 1 a srv2 y 1 a srv3.&lt;/p&gt;

&lt;h1 id=&#34;control-de-estado-health-checks&#34;&gt;Control de estado (Health checks)&lt;/h1&gt;

&lt;p&gt;Si un servidor falla, nginx lo marcará como en mal estado y evitará enviarle peticiones.&lt;/p&gt;

&lt;h1 id=&#34;configurar-el-balanceo-de-carga-en-entornos-cloud&#34;&gt;Configurar el balanceo de carga en entornos cloud&lt;/h1&gt;

&lt;p&gt;Visto cómo crear el balanceo de carga a mano, ahora pasemos a administrar y crear de forma sencilla un sistema de balanceo. En este caso usando &lt;em&gt;Arsys&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Para ello, en el panel de control hacemos click en &lt;em&gt;Red&lt;/em&gt; » Balanceadores. Allí crearemos uno nuevo&lt;/p&gt;

&lt;p&gt;&lt;img on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2015/03/Balanceadoresdecarga1.png&#34; alt=&#34;Balanceadoresdecarga1&#34; width=&#34;815px&#34; height=&#34;531px&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Donde se especifica el nombre, puertos y direcciones a usar.&lt;/p&gt;

&lt;p&gt;El siguiente paso es elegir el tipo de Control de estado a realizar, y el método de balanceo (Round robin o least connections)&lt;/p&gt;

&lt;p&gt;&lt;img on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2015/03/Balanceadoresdecarga2.png&#34; alt=&#34;Balanceadoresdecarga2&#34; width=&#34;812px&#34; height=&#34;532px&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Por último, se especifica la aplicación que será balanceada entre todos los servidores virtuales disponibles.&lt;/p&gt;

&lt;p&gt;&lt;img on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2015/03/Balanceadoresdecarga3.png&#34; alt=&#34;Balanceadoresdecarga3&#34; width=&#34;815px&#34; height=&#34;529px&#34; /&gt;&lt;/p&gt;

&lt;h1 id=&#34;ventajas-y-desventajas&#34;&gt;Ventajas y desventajas&lt;/h1&gt;

&lt;p&gt;La opción de crear y configurar el balanceador a mano puede ser buena para aprender, pero a la larga, conforme las necesidades de la aplicación vayan aumentando será más y más tedioso. Sin embargo, con un entorno cloud, podremos crear, modificar y borrar servidores y balanceadores a golpe de click.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Nginx Docs&lt;/em&gt; »» &lt;a href=&#34;http://nginx.org/en/docs/http/load_balancing.html&#34; target=&#34;_blank&#34;&gt;nginx.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Cómo configurar un servidor DNS - Parte 1 (Introducción)</title>
            <link>https://elbauldelprogramador.com/como-configurar-un-servidor-dns/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/como-configurar-un-servidor-dns/</guid>
            <description>&lt;figure&gt;
        &lt;a href=&#34;https://elbauldelprogramador.com/img/2013/04/dns.jpg&#34;&gt;
          &lt;img
            on=&#34;tap:lightbox1&#34;
            role=&#34;button&#34;
            tabindex=&#34;0&#34;
            layout=&#34;responsive&#34;
            src=&#34;https://elbauldelprogramador.com/img/2013/04/dns.jpg&#34;
            alt=&#34;Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)&#34;
            title=&#34;Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)&#34;
            sizes=&#34;(min-width: 450px) 450px, 100vw&#34;
            width=&#34;450&#34;
            height=&#34;361&#34;&gt;
          &lt;/img&gt;
        &lt;/a&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;Cómo configurar un servidor DNS - Parte 1 (Introducción)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns2/&#34; title=&#34;Cómo configurar un servidor DNS – Parte 2 (La Zona Primaria)&#34;&gt;Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns3/&#34; title=&#34;Cómo configurar un servidor DNS – Parte 3 (Zona Inversa y DNS secundario)&#34;&gt;Cómo configurar un servidor DNS - Parte 3 (Zona Inversa y DNS secundario)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;En esta serie de artículos, intentaré explicar lo mejor posible el funcionamiento de los servidores DNS, y cómo configurar el tuyo propio. Habrá una parte más teórica sobre el funcionamiento del sistema, que es una traducción de un artículo en howtoforge.&lt;/p&gt;

&lt;p&gt;Ya que los artículos están basados en distintas fuentes de información que he ido recopilando, no sé de cuantas partes estará formada esta serie, así que la lista de arriba irá cambiando hasta que estén completos todos los artículos.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Debo reconocer que el tema de los DNS me ha dado muchos problemas, es algo que para mí ha sido dificil de entender. A base de leer y releer muchos artículos por internet, aprendí a configurar un servidor DNS manualmente. Hoy voy a explicar cómo.&lt;/p&gt;

&lt;p&gt;En Linux, &lt;strong&gt;BIND&lt;/strong&gt; es el encargado de gestionar los DNS, como su página de ayuda indica (&lt;em&gt;bind - bind a name to a socket&lt;/em&gt;), asocia un nombre a un socket. Es importante que antes de continuar compruebes que la versión de &lt;strong&gt;BIND&lt;/strong&gt; es superior a la 4. Lo ideal sería tener la 8 o 9. Puedes comprobarlo con el siguiente comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ nslookup -type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;txt -class&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;chaos version.bind servidor
Server:     servidor
Address:    IP#53

version.bind   &lt;span class=&#34;nv&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;VERSION&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;BIND&lt;/strong&gt; tiene tres componentes, el primero es llamado &lt;em&gt;named&lt;/em&gt; o &lt;em&gt;name-dee&lt;/em&gt;, es un demonio que ejecuta el lado servidor del DNS.&lt;/p&gt;

&lt;p&gt;El segundo componente es llamado &lt;em&gt;resolver library&lt;/em&gt; o biblioteca de resolución, encargada de realizar peticiones a servidores DNS para intentar traducir un nombre a una dirección IP. El archivo de configuración para este componente es &lt;strong&gt;resolv.conf&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;El tercer y último componente de &lt;strong&gt;BIND&lt;/strong&gt; proporciona herramientas para probar el servidor DNS. Entre estas herramientas se encuentran comandos como &lt;strong&gt;dig&lt;/strong&gt;, que se verá más adelante.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;cual-es-tu-responsabilidad-como-parte-del-sistema-dns&#34;&gt;¿Cual es tu responsabilidad como parte del sistema DNS?&lt;/h1&gt;

&lt;p&gt;DNS es una &lt;a href=&#34;https://elbauldelprogramador.com/bases-de-datos/&#34;&gt;base de datos&lt;/a&gt; distribuida. Cuando pagas por un dominio, debes configurar dos servidores de nombres, y éstos deben ser registrados en el sistema DNS.&lt;/p&gt;

&lt;p&gt;La base de datos del sistema DNS tiene tres niveles. Al primer grupo de servidores se les llama “&lt;strong&gt;servidores root&lt;/strong&gt;”. Al segundo, “&lt;strong&gt;Top Level Domains (TLDs)&lt;/strong&gt;” o dominios de primer nivel. Cuando se necesita conocer la dirección de una web, el segundo componente de &lt;strong&gt;BIND&lt;/strong&gt; (resolver library) realiza una petición, (De aquí en adelante lo llamaremos &lt;em&gt;resolver&lt;/em&gt;).&lt;/p&gt;

&lt;p&gt;Por ejemplo, supongamos que quieres encontrar a &lt;strong&gt;google.com&lt;/strong&gt;. Tu resolver pide a los servidores root que identifique la IP de google.com. El servidor root responde, “ &lt;em&gt;No lo sé, pero sí sé donde puedes encontrar la respuesta, comienza con los servidores TLD para COM&lt;/em&gt; ”.&lt;/p&gt;

&lt;p&gt;Así, el servidor root envia la petición a un servidor COM. Éste último servidor dice: “&lt;em&gt;No tengo esa información, pero sé de un servidor de nombres que sí, tiene dirección 173.194.34.6 y nombre ns1.google.com. Dirígete a esa dirección y te dirá la dirección del sitio web google.com.”&lt;/em&gt;&lt;/p&gt;

&lt;figure&gt;
&lt;img on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; alt=&#34;Esquema servidores DNS&#34; src=&#34;https://elbauldelprogramador.com/img/2013/02/dns.png&#34; width=&#34;513px&#34; height=&#34;399px&#34; /&gt;
&lt;/figure&gt;

&lt;p&gt;En la figura de arriba, la parte superior izquierda representa los servidores root. En la jerga DNS, éstos servidores reprensentan el comienzo del camino en el sistema DNS. Suelen representarse con un punto (“.”). En los archivos de configuración, el mapeo entre IP y nombre acabará en un punto. A lo largo de esta series de artículos quedará más claro este concepto.&lt;/p&gt;

&lt;p&gt;Los servidores root son los principales de la base de datos distribuida. Poseen información sobre los &lt;strong&gt;Top Level Domains (TLDs)&lt;/strong&gt; o dominios de primer nivel. En los TLDs se incluyen &lt;em&gt;com, net, org, mil, gov, edu etc&lt;/em&gt;. Al contratar un nombre de dominio, es necesario elegir qué TLD se desea, este blog se encuentra en el espacio de nombres COM y se llama &lt;em&gt;elbauldelprogramador.com&lt;/em&gt;.&lt;/p&gt;

&lt;h1 id=&#34;cómo-responde-el-servidor-dns-a-las-peticiones&#34;&gt;¿Cómo responde el servidor DNS a las peticiones?&lt;/h1&gt;

&lt;p&gt;En este punto es donde &lt;strong&gt;BIND&lt;/strong&gt; entra en acción. El primer componente que mencionamos, &lt;strong&gt;named&lt;/strong&gt;; está presente en todos los servidores de nombres y es el encargado de responder a las peticiones de los resolvers. Lee sus datos del archivo de configuración &lt;em&gt;named.conf&lt;/em&gt;. Éste fichero obtiene su información de unos ficheros a los que se les suele llamar &lt;em&gt;zone files&lt;/em&gt; ó &lt;em&gt;ficheros de zona&lt;/em&gt;. Existen multidud de ellos, pero un archivo de zona en particular mantiene una base de datos de registros que proporciona named con la mayoría de sus respuestas.&lt;/p&gt;

&lt;p&gt;En la figura 2, &lt;em&gt;named&lt;/em&gt; ha recibido una petición. Busca en su fichero de configuración &lt;em&gt;named.conf&lt;/em&gt;, que busca en el archivo de zona primaria y pasa la información solicitada al resolver desde el exterior.&lt;/p&gt;

&lt;figure&gt;
&lt;img on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; alt=&#34;Figura 2 - Respondiendo a una petición&#34; src=&#34;https://elbauldelprogramador.com/img/2013/02/config.png&#34; width=&#34;411px&#34; height=&#34;185px&#34; /&gt;
&lt;figcaption&gt;Figura 2 - Respondiendo a una petición&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h1 id=&#34;usando-named-conf&#34;&gt;Usando Named.conf&lt;/h1&gt;

&lt;p&gt;El proceso &lt;em&gt;named&lt;/em&gt; escucha en el puerto 53 en los sitemas Linux. Al recibir una petición para una dirección, busca en el primer archivo de configuración que conoce, &lt;em&gt;named.conf&lt;/em&gt;. Tal y como se aprecia en la figura 2.&lt;/p&gt;

&lt;p&gt;El fichero tiene la siguiente estructura:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// This is the primary configuration file for the BIND DNS server named.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;//&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// Please read /usr/share/doc/bind9/README.Debian.gz for information on the&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// structure of BIND configuration files in Debian, *BEFORE* you customize&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// this configuration file.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;//&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// If you are just adding zones, please do that in /etc/bind/named.conf.local&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;quot;/etc/bind/named.conf.options&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;quot;/etc/bind/named.conf.local&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;quot;/etc/bind/named.conf.default-zones&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Veamos el contenido de los tres archivos que incluye:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;named.conf.options&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;options &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    directory &lt;span class=&#34;s2&#34;&gt;&amp;quot;/var/cache/bind&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Aquí se definen el directorio por defecto para named.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;named.conf.default-zones&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;zone &lt;span class=&#34;s2&#34;&gt;&amp;quot;.&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; hint&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  file &lt;span class=&#34;s2&#34;&gt;&amp;quot;/etc/bind/db.root&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

zone &lt;span class=&#34;s2&#34;&gt;&amp;quot;localhost&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; master&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    file &lt;span class=&#34;s2&#34;&gt;&amp;quot;/etc/bind/db.local&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

zone &lt;span class=&#34;s2&#34;&gt;&amp;quot;127.in-addr.arpa&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; master&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    file &lt;span class=&#34;s2&#34;&gt;&amp;quot;/etc/bind/db.127&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

zone &lt;span class=&#34;s2&#34;&gt;&amp;quot;0.in-addr.arpa&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; master&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    file &lt;span class=&#34;s2&#34;&gt;&amp;quot;/etc/bind/db.0&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

zone &lt;span class=&#34;s2&#34;&gt;&amp;quot;255.in-addr.arpa&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; master&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    file &lt;span class=&#34;s2&#34;&gt;&amp;quot;/etc/bind/db.255&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;zone &amp;#8220;.&amp;#8221;&lt;/strong&gt; contiene los nombres y direcciones de los servidores root. Como se mencionó arriba, éstos servidores saben en qué servidores autorizados existe tu dominio &amp;#8212; Siendo el primero los TLD (com, org, net etc) y el segundo el servidor autorizado para tu dominio.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;zone &amp;#8220;localhost&amp;#8221;&lt;/strong&gt;. Cada servidor de nombres administra su propio dominio loopback (127.0.0.1). El motivo de crear una zona para localhost es reducir tráfico y permitir que el mismo software funcione en el sistema como lo hace en internet.&lt;/p&gt;

&lt;p&gt;El resto de las zonas son archivos de zonas inversas. Es una copia invertida de la base de datos definida en los otros archivos. Es decir, asocia una IP a un nombre, al contrario. Se pueden indentificar por la extensión &lt;strong&gt;in-addr.arpa&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;En el siguiente artículo ser verá en detalle la estructura del archivo &lt;strong&gt;named.conf.local&lt;/strong&gt;, en el que se definen nuevas zonas que corresponden a dominios que resolverá el servidor DNS. Así como a los archivos &lt;em&gt;pri.nombredominio.com&lt;/em&gt; asociados a cada zona.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Traditional DNS Howto&lt;/em&gt; »» &lt;a href=&#34;http://www.howtoforge.com/traditional_dns_howto&#34; target=&#34;_blank&#34;&gt;Visitar sitio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)</title>
            <link>https://elbauldelprogramador.com/como-configurar-un-servidor-dns2/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/como-configurar-un-servidor-dns2/</guid>
            <description>&lt;figure&gt;
        &lt;a href=&#34;https://elbauldelprogramador.com/img/2013/04/dns.jpg&#34;&gt;
          &lt;img
            on=&#34;tap:lightbox1&#34;
            role=&#34;button&#34;
            tabindex=&#34;0&#34;
            layout=&#34;responsive&#34;
            src=&#34;https://elbauldelprogramador.com/img/2013/04/dns.jpg&#34;
            alt=&#34;Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)&#34;
            title=&#34;Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)&#34;
            sizes=&#34;(min-width: 450px) 450px, 100vw&#34;
            width=&#34;450&#34;
            height=&#34;361&#34;&gt;
          &lt;/img&gt;
        &lt;/a&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns/&#34; title=&#34;Cómo configurar un servidor DNS – Parte 1 (Introducción)&#34;&gt;Cómo configurar un servidor DNS - Parte 1 (Introducción)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns3/&#34; title=&#34;Cómo configurar un servidor DNS – Parte 3 (Zona Inversa y DNS secundario)&#34;&gt;Cómo configurar un servidor DNS - Parte 3 (Zona Inversa y DNS secundario)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Siguiendo con los artículos de cómo configurar un servidor DNS. En el anterior artículo dejamos pendiente echar un vistazo al archivo &lt;strong&gt;named.conf.local&lt;/strong&gt;, que contiene información sobre los dominios que serán resueltos por el servidor DNS. Veamos el contenido:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;zone &lt;span class=&#34;s2&#34;&gt;&amp;quot;elbauldelprogramador.com&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; master&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        allow-transfer &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;DNS_SECUNDARIO&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        file &lt;span class=&#34;s2&#34;&gt;&amp;quot;/etc/bind/pri.elbauldelprogramador.com&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;El contenido de &lt;strong&gt;/etc/bind/pri.elbauldelprogramador.com&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$TTL        3600
@       IN      SOA     ks3277174.kimsufi.com. correo.electronico.com. &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
                        &lt;span class=&#34;m&#34;&gt;2013011703&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; serial, todays date + todays serial &lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
                        &lt;span class=&#34;m&#34;&gt;7200&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; refresh, seconds
                        &lt;span class=&#34;m&#34;&gt;540&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; retry, seconds
                        &lt;span class=&#34;m&#34;&gt;604800&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; expire, seconds
                        &lt;span class=&#34;m&#34;&gt;86400&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; minimum, seconds
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

elbauldelprogramador.com. &lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt; A        5.39.89.44
elbauldelprogramador.com. &lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;      MX    &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;   mail.elbauldelprogramador.com.
elbauldelprogramador.com. &lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;      NS        ks3277174.kimsufi.com.
elbauldelprogramador.com. &lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;      NS        ns.kimsufi.com.
mail &lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt; A        5.39.89.44
www &lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt; A        5.39.89.44
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;SOA&lt;/strong&gt; es el acrónimo para &lt;em&gt;“Start Authority”&lt;/em&gt;. Si recuerdas la figura 1 del artículo anterior, recordarás que DNS es una base de datos distrubuida. Comenzando en los root servers, las peticiones se van desplazando hasta llegar a su destino, en este caso, hasta llegar al servidor DNS que estamos configurando. Por esa razón, en el fichero de zona es necesario indicar dónde comienza su autoridad(&lt;em&gt;authority&lt;/em&gt;). Ésta autoridad comienza precisamente en el fichero de zona. Los servidores &lt;strong&gt;TLD&lt;/strong&gt; (&lt;em&gt;Top Level Domain ó Dominios de primer nivel&lt;/em&gt;) esperan del servidor DNS que realice su parte del trabajo.&lt;/p&gt;

&lt;p&gt;El registro &lt;strong&gt;SOA&lt;/strong&gt; consta de varios campos. Es necesario proporcionar datos a esos campos para que otros servidores en internet puedan llevar a cabo sus peticiones. Los campos son:&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;nombre&#34;&gt;Nombre&lt;/h1&gt;

&lt;p&gt;Define el nombre principal de la zona. El &lt;em&gt;@&lt;/em&gt; es una abreviatura a la zona actual, es decir, para &lt;em&gt;/pri.elbauldelprogramador.com&lt;/em&gt; en este ejemplo. El nombre del servidor maestro para esta zona es ks3277174.kimsufi.com. Esto significa que en el archivo &lt;em&gt;named.conf&lt;/em&gt; existe una entrada que apunta y este archivo vuelve apunta a su vez a la entrada en el archivo de configuración.&lt;/p&gt;

&lt;h1 id=&#34;clase&#34;&gt;Clase&lt;/h1&gt;

&lt;p&gt;Existen varios tipos de clases DNS. En nuestro caso solo se usará la clase &lt;em&gt;IN&lt;/em&gt; o &lt;em&gt;Internet&lt;/em&gt;, usadas para definir el mapeo entre la dirección IP y &lt;em&gt;BIND&lt;/em&gt;.&lt;/p&gt;

&lt;h1 id=&#34;tipo&#34;&gt;Tipo&lt;/h1&gt;

&lt;p&gt;El tipo de registro para el recurso DNS, en el ejemplo de arriba, el tipo es &lt;em&gt;SOA&lt;/em&gt;.&lt;/p&gt;

&lt;h1 id=&#34;nombre-del-servidor&#34;&gt;Nombre del servidor&lt;/h1&gt;

&lt;p&gt;Nombre completo del servidor de nombres primario. Debe acabar en un punto.&lt;/p&gt;

&lt;h1 id=&#34;dirección-de-correo&#34;&gt;Dirección de correo&lt;/h1&gt;

&lt;p&gt;Dirección de correo de la persona responsable del dominio. Nota cómo se sustituye el símbolo @ por un punto.&lt;/p&gt;

&lt;h1 id=&#34;número-de-serie&#34;&gt;Número de serie&lt;/h1&gt;

&lt;p&gt;Normalmente tiene el formato &lt;em&gt;YYYYMMDD&lt;/em&gt; con dos dígitios más al final que indican el número de serie del día. El número de serie es útil para indicarle a servidor DNS secundario cuando debe actualizarse. Si el servidor esclavo al comprobar el número de serie ha cambiado, realizará una trasnferencia de zona (&lt;strong&gt;zone transfer&lt;/strong&gt;).&lt;/p&gt;

&lt;h1 id=&#34;refresh-o-actualización&#34;&gt;Refresh o actualización&lt;/h1&gt;

&lt;p&gt;En este campo indica al servidor DNS esclavo o secundario con qué frecuencia debería comprobar el estado del maestro. El valor está representado en segundos. En cada ciclo de refresco, el esclavo realiza la comprobación para saber cuando es necesaria una transferencia de zona (&lt;strong&gt;zone transfer&lt;/strong&gt;). En el ejemplo el valor es 7200&lt;/p&gt;

&lt;h1 id=&#34;retry-o-reintento&#34;&gt;Retry o reintento&lt;/h1&gt;

&lt;p&gt;Frecuencia con la que el esclavo debería conectarse al maestro en caso de una conexión fallida.&lt;/p&gt;

&lt;h1 id=&#34;expiry-o-expiración&#34;&gt;Expiry o expiración&lt;/h1&gt;

&lt;p&gt;Cantidad total de tiempo en la que el esclavo debería reintentar ponerse en contacto con el maestro antes de que expiren los datos que contiene. Referencias futuras serán dirigidas a los servidores root.&lt;/p&gt;

&lt;h1 id=&#34;ttl-mínimo&#34;&gt;TTL mínimo&lt;/h1&gt;

&lt;p&gt;Este campo define el tiempo de vida (&lt;em&gt;Time To Live&lt;/em&gt;) para el dominio en segundos. Sirve para responder a peticiones de subdominios que no existen en los registros. Cuando esté configurado, el servidor DNS responderá con una respuesta del tipo &lt;strong&gt;no domain&lt;/strong&gt; o &lt;strong&gt;NXDOMAIN&lt;/strong&gt;. Dicha respuesta será cacheada. El TTL establece la duración del cacheo para la respuesta.&lt;/p&gt;

&lt;p&gt;Después de estos campos, se especifican los servidores de nombres para el dominio. &lt;strong&gt;NS&lt;/strong&gt; es el acrónimo de &lt;strong&gt;Name Server&lt;/strong&gt;. Como se ha visto un poco más arriba, el servidor de nombres principal del ejemplo es &lt;em&gt;ks3277174.kimsufi.com&lt;/em&gt;. También se define el sevidor DNS secundario o esclavo, en este caso &lt;em&gt;ns.kimsufi.com&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Además de los registros &lt;em&gt;NS&lt;/em&gt;, se definen los registros &lt;strong&gt;MX&lt;/strong&gt;, que identifican el servidor de correo para el dominio, el número 10 define la prioridad del servidor de correo. Así como el registro de tipo &lt;strong&gt;A&lt;/strong&gt;, que asocia un nombre a una dirección ip.&lt;/p&gt;

&lt;p&gt;En el ejemplo existe un único registro &lt;strong&gt;MX&lt;/strong&gt;, pero puede haber más. Por ejemplo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;MX &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; mail.elbauldelprogramador.com.
MX &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; mail.otrodominio.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Si se envia un email al dominio, el servidor de correo que envía el email intenta conectarse a &lt;em&gt;mail.elbauldelprogramador.com&lt;/em&gt; ya que tiene prioridad 10, si no puede establecer conexión, lo intentará con &lt;em&gt;mail.otrodominio.com&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;El último tipo de registro que vamos a ver es el de tipo &lt;strong&gt;CNAME&lt;/strong&gt; (&lt;em&gt;Canonical Name&lt;/em&gt;). Se suele referir a ellos como registros alias del tipo &lt;strong&gt;A&lt;/strong&gt;. Por ejemplo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;ftp        CNAME www
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;significa que &lt;em&gt;ftp.elbauldelprogramador.com&lt;/em&gt; es un alias de &lt;em&gt;www.elbauldelprogramador.com&lt;/em&gt;. Es decir, &lt;em&gt;ftp.elbauldelprogramador.com&lt;/em&gt; apunta al mismo servidor que &lt;em&gt;www.elbauldelprogramador.com&lt;/em&gt;. Un registro &lt;strong&gt;CNAME&lt;/strong&gt; debe apuntar a un registro de tipo &lt;strong&gt;A&lt;/strong&gt; y solo de tipo &lt;strong&gt;A&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;En el siguiente artículo se verá el archivo de zona inversa y la configuración del servidor DNS secundario, así como el uso del comando &lt;em&gt;dig&lt;/em&gt;.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Traditional DNS Howto&lt;/em&gt; »» &lt;a href=&#34;http://www.howtoforge.com/traditional_dns_howto&#34; target=&#34;_blank&#34;&gt;Visitar sitio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Cómo configurar un servidor DNS - Parte 3 (Zona Inversa y DNS secundario)</title>
            <link>https://elbauldelprogramador.com/como-configurar-un-servidor-dns3/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/como-configurar-un-servidor-dns3/</guid>
            <description>&lt;figure&gt;
        &lt;a href=&#34;https://elbauldelprogramador.com/img/2013/04/dns.jpg&#34;&gt;
          &lt;img
            on=&#34;tap:lightbox1&#34;
            role=&#34;button&#34;
            tabindex=&#34;0&#34;
            layout=&#34;responsive&#34;
            src=&#34;https://elbauldelprogramador.com/img/2013/04/dns.jpg&#34;
            alt=&#34;Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)&#34;
            title=&#34;Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)&#34;
            sizes=&#34;(min-width: 450px) 450px, 100vw&#34;
            width=&#34;450&#34;
            height=&#34;361&#34;&gt;
          &lt;/img&gt;
        &lt;/a&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns/&#34; title=&#34;Cómo configurar un servidor DNS – Parte 1 (Introducción)&#34;&gt;Cómo configurar un servidor DNS - Parte 1 (Introducción)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns2/&#34; title=&#34;Cómo configurar un servidor DNS – Parte 2 (La Zona Primaria)&#34;&gt;Cómo configurar un servidor DNS - Parte 2 (La Zona Primaria)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Cómo configurar un servidor DNS - Parte 3 (Zona Inversa y DNS secundario)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Ya se ha visto que existe una base de datos centralizada que asocia nombres de dominios a direccines IP, también se mencionó el caso inverso, una copia inversa de dicha base de datos, que asocia IP&amp;#8217;s a nombres de dominios. Ésta búsqueda inversa es usada por muchos programas, que rechazarán establecer una conexión si la búsqueda inversa y la búsqueda directa (&lt;em&gt;Dominio»IP&lt;/em&gt;) no coinciden. Muchos proveedores de correo usan la búsqueda inversa para clasificar correos como spam.&lt;/p&gt;

&lt;p&gt;Con objetivo de que los emails enviados desde el dominio que se está configurando no sean clasificados como spam, es necesario crear la zona inversa en el archivo &lt;strong&gt;named.conf.local&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;zone &lt;span class=&#34;s2&#34;&gt;&amp;quot;89.39.5.in-addr.arpa&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
 &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; master&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    file &lt;span class=&#34;s2&#34;&gt;&amp;quot;pri.89.39.5.in-addr.arpa&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Los números son la dirección ip del servidor escritos en orden inverso. Es decir, la ip es &lt;strong&gt;5.39.89.x&lt;/strong&gt;, así pues, la zona ha de llamarse &lt;em&gt;89.39.5.in-addr.arpa&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Es necesario crear el archivo de zone inversa también, &lt;em&gt;pri.89.39.5.in-addr.arpa&lt;/em&gt;. Este archivo es necesario crearlo en el mismo directorio en el que se encuentra el archivo de zona primario (&lt;em&gt;pri.elbauldelprogramador.com&lt;/em&gt;).&lt;/p&gt;

&lt;p&gt;El principio de este archivo es exáctamente igual que &lt;em&gt;pri.elbauldelprogramador.com&lt;/em&gt;:&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;@       IN      SOA     ks3277174.kimsufi.com. contacto.elbauldelprogramador.com. &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
                        &lt;span class=&#34;m&#34;&gt;2013021001&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; serial, todays date + todays serial &lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
                        &lt;span class=&#34;m&#34;&gt;7200&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; refresh, seconds
                        &lt;span class=&#34;m&#34;&gt;540&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; retry, seconds
                        &lt;span class=&#34;m&#34;&gt;604800&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; expire, seconds
                        &lt;span class=&#34;m&#34;&gt;86400&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; minimum, seconds
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  NS      ks3277174.kimsufi.com.
  NS      ns.kimsufi.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A continuación, es necesario añadir un registro del tipo &lt;strong&gt;PTR&lt;/strong&gt;. Los registros &lt;strong&gt;PTR&lt;/strong&gt; son punteros. Apuntan a un nombre de dominio. Quedaría así:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;44&lt;/span&gt;   PTR elbauldelprogramador.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;El 44 es el último valor de la dirección IP del servidor.&lt;/p&gt;

&lt;p&gt;Eso es todo, en este punto usaremos el comando &lt;strong&gt;dig&lt;/strong&gt; para comprobar la configuración.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ dig elbauldelprogramador.com

&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.8.4-P1 &amp;lt;&amp;lt;&amp;gt;&amp;gt; elbauldelprogramador.com
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; global options: +cmd
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; Got answer:
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; -&amp;gt;&amp;gt;HEADER&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;- opco&lt;/span&gt;de: QUERY, status: NOERROR, id: 10156
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; flags: qr rd ra&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;elbauldelprogramador.com.    IN  A

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; ANSWER SECTION:
elbauldelprogramador.com. &lt;span class=&#34;m&#34;&gt;532&lt;/span&gt;    IN  A   5.39.89.44

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; Query time: &lt;span class=&#34;m&#34;&gt;50&lt;/span&gt; msec
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; SERVER: 80.58.61.250#53&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;80.58.61.250&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; WHEN: Mon Feb &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; 21:09:28 2013
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; MSG SIZE  rcvd: 58
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Así, estamos buscando la ip del dominio. Como se aprecia, devuelve el valor correcto en la sección &lt;strong&gt;ANSWER SECTION&lt;/strong&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ dig -x 5.39.89.44

&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.8.4-P1 &amp;lt;&amp;lt;&amp;gt;&amp;gt; -x 5.39.89.44
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; global options: +cmd
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; Got answer:
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; -&amp;gt;&amp;gt;HEADER&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;- opco&lt;/span&gt;de: QUERY, status: NOERROR, id: 50347
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; flags: qr rd ra&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;44.89.39.5.in-addr.arpa.    IN  PTR

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; ANSWER SECTION:
44.89.39.5.in-addr.arpa. &lt;span class=&#34;m&#34;&gt;84513&lt;/span&gt; IN  PTR elbauldelprogramador.com.

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; Query time: &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; msec
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; SERVER: 80.58.61.250#53&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;80.58.61.250&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; WHEN: Mon Feb &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; 21:10:09 2013
&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; MSG SIZE  rcvd: 76
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Esta vez, se está realizando la petición inversa, preguntamos por el dominio.&lt;/p&gt;

&lt;h1 id=&#34;el-servidor-dns-secundario&#34;&gt;El servidor DNS secundario&lt;/h1&gt;

&lt;p&gt;En caso de disponer de otro servidor DSN propio, para configurarlo de modo que haga las veces de servidor DNS secundario es necesario añadir otra zona al archivo &lt;strong&gt;named.conf.local&lt;/strong&gt; en el servidor &lt;strong&gt;secundario&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;zone &lt;span class=&#34;s2&#34;&gt;&amp;quot;DOMINIO&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; slave&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
     file &lt;span class=&#34;s2&#34;&gt;&amp;quot;sec.DOMINIO.COM&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
     masters &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; DIRECCION IP SERVIDOR PRIMARIO&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Esta vez, se declara la zona como &lt;strong&gt;slave&lt;/strong&gt; o esclava y se especifica la dirección IP del servidor maestro. En el fichero indicado en &lt;strong&gt;file&lt;/strong&gt; se almacenarán los datos de la zona esclava. Basta con reiniciar &lt;strong&gt;named&lt;/strong&gt; y dicho fichero será creado al ponserse en contacto con el servidor primario y habiendo realizado una transferencia de zona.&lt;/p&gt;

&lt;p&gt;Por último, por razones de seguridad es recomendable agregar una línea adicional en archivo de zona del servidor &lt;strong&gt;principal&lt;/strong&gt; que únicamente permita al servidor secundario realizar la transferencia de zona:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;zone &lt;span class=&#34;s2&#34;&gt;&amp;quot;elbauldelprogramador.com&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; master&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        allow-transfer &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;IP SERVIDOR DNS SECUNDARIO&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        file &lt;span class=&#34;s2&#34;&gt;&amp;quot;/etc/bind/pri.elbauldelprogramador.com&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;En mi caso, la ip corresponde al servidor DNS secundario que proporciona la compañia en la que tengo contratado el servidor.&lt;/p&gt;

&lt;p&gt;Con éste último artículo doy por terminada este conjunto de artículos que pretendían dar a conocer al lector el funcionamiento de DNS. Habiendo adquirido este conocimiento, será mucho más fácil usar las distintas herramientas que proporcionan los paneles de administración web para configurar los DNS.&lt;/p&gt;

&lt;p&gt;Para finalizar, reiterar que todos los artículos están basados en un How to de la web que se menciona en las referencias.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Traditional DNS Howto&lt;/em&gt; »» &lt;a href=&#34;http://www.howtoforge.com/traditional_dns_howto&#34; target=&#34;_blank&#34;&gt;Visitar sitio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Cómo enviar los emails de /var/mail/root a una cuenta de correo</title>
            <link>https://elbauldelprogramador.com/como-enviar-los-emails-de-varmailroot-una-cuenta-de-correo/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/como-enviar-los-emails-de-varmailroot-una-cuenta-de-correo/</guid>
            <description>&lt;p&gt;En sistemas operativos como &lt;a href=&#34;https://elbauldelprogramador.com/tags/debian&#34;&gt;Debian&lt;/a&gt;, muchos de los programas y demonios envían mensajes al usuario &lt;em&gt;root&lt;/em&gt; para informar del estado del sistema. Los mensajes se almacenan en el archivo &lt;em&gt;/var/mail/root&lt;/em&gt;. El problema es que se almacena el correo en texto plano, es decir, con todas las cabeceras típicas del protocolo de correo. Pueden usarse programas como &lt;strong&gt;mutt&lt;/strong&gt; para administrar los mensajes. Sin embargo, considero más organizado redireccionar todos los mensajes a una cuenta de correo típica.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;requisitos&#34;&gt;Requisitos&lt;/h1&gt;

&lt;p&gt;Es necesario que el sistema tenga instalado el programa &lt;strong&gt;sendmail&lt;/strong&gt;.&lt;/p&gt;

&lt;h1 id=&#34;configurar-el-reenvío&#34;&gt;Configurar el reenvío&lt;/h1&gt;

&lt;p&gt;Normalmente, la configuración del reenvío de correo se realiza en el archivo &lt;strong&gt;/etc/aliases&lt;/strong&gt;, un ejemplo del contenido de este archivo es:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# /etc/aliases&lt;/span&gt;
mailer-daemon: postmaster
postmaster: root
nobody: root
hostmaster: root
usenet: root
news: root
webmaster: root
www: root
ftp: root
abuse: root
noc: root
security: root
clamav: root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Como vemos, todo se redirecciona a la cuenta local del usuario &lt;em&gt;root&lt;/em&gt;. Bastaría con redireccionar la cuenta &lt;em&gt;root&lt;/em&gt; a una dirección de correo para obtener todos los mensajes del sistema en nuestra bandeja de entrada, y tener así nuestro servidor un poco más controlado. Para ello añadimos en el archivo anterior la siguiente línea:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Redireccionar todo el correo de root a mi cuenta&lt;/span&gt;
root: direccion@correo.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Para aplicar los cambios hay que ejecutar el comando &lt;code&gt;newaliases&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;A partir de ahora, recibiremos en nuestra bandeja de entrada los mensajes del sistema, podemos crear un filtro si usamos gmail para organizarlos y quitarlos de la bandeja principal.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;How to send emails stored in /var/spool/mail/root to a gmail inbox&lt;/em&gt; »» &lt;a href=&#34;http://serverfault.com/questions/554922/how-to-send-emails-stored-in-var-spool-mail-root-to-a-gmail-inboxbr/&#34; target=&#34;_blank&#34;&gt;serverfault.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Cómo habilitar la página de estado en Nginx</title>
            <link>https://elbauldelprogramador.com/como-hablitar-la-pagina-de-estado-en-nginx/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/como-hablitar-la-pagina-de-estado-en-nginx/</guid>
            <description>&lt;p&gt;Nginx dispone de una página que muestra el estado del servidor, que mostrará información sobre las conexiones activas junto a otra información. Para habilitar la página en cuestión no hay más que seguir éstos sencillos pasos.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;habilitar-el-módulo-httpstubstatusmodule&#34;&gt;Habilitar el módulo HttpStubStatusModule&lt;/h1&gt;

&lt;p&gt;Es necesario compilar nginx con éste módulo. Para comprobar si está compilado debe aparecer &lt;code&gt;--with-http_stub_status_module&lt;/code&gt; al ejecutar el comando&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;nginx -V
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;De no tenerlo, hay que volver a &lt;a href=&#34;https://elbauldelprogramador.com/como-instalar-nginx-con-php5-fpm/&#34; title=&#34;Cómo instalar y configurar Nginx con php5-fpm&#34;&gt;compilar nginx&lt;/a&gt; con éste módulo activo.&lt;/p&gt;

&lt;h1 id=&#34;habilitar-la-página-de-estado-en-nginx&#34;&gt;Habilitar la página de estado en nginx&lt;/h1&gt;

&lt;p&gt;Hay que editar el fichero &lt;em&gt;nginx.conf&lt;/em&gt;, y añadir en el bloque &lt;strong&gt;&lt;em&gt;server { /*&amp;#8230;*/ }&lt;/em&gt;&lt;/strong&gt; lo siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;location /nginx_status &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# Hablitar las estadísticas&lt;/span&gt;
        stub_status on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# No registrar en los logs los accesos a la página de estado&lt;/span&gt;
        access_log   off&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# Perminir que únicamente mi IP pueda visitar la página #&lt;/span&gt;
        allow X.X.X.X&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# Denegar el acceso al resto del mundo #&lt;/span&gt;
        deny all&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Tras esto, es necesario reiniciar nginx para que sea consciente de los cambios:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;service nginx reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ahora al dirigirse a la dirección &lt;strong&gt;&lt;em&gt;midominio.com/nginx_status&lt;/em&gt;&lt;/strong&gt; veremos algo así:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;Active connections: 291
server accepts handled requests
   &lt;span class=&#34;m&#34;&gt;16630948&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16630948&lt;/span&gt; 31070465
Reading: &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; Writing: &lt;span class=&#34;m&#34;&gt;179&lt;/span&gt; Waiting: 106
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;active connections&lt;/em&gt; &amp;#8212; Número de conexiones abieras.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;server accepts handled requests&lt;/em&gt; &amp;#8212; En el ejemplo, nginx ha aceptado 16630948 conexiones, procesado 16630948 de ellas (Ninguna fue cerrada) y ha procesado 31070465 (1.8 peticiones por conexión).&lt;/li&gt;
&lt;li&gt;&lt;em&gt;reading&lt;/em&gt; &amp;#8212; Peticiones de cabecera leídas.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;writing&lt;/em&gt; &amp;#8212; Peticiones leidas, procesadas, o escritas en respuesta al cliente.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;waiting&lt;/em&gt; &amp;#8212; Conexiones &lt;em&gt;keep-alive&lt;/em&gt;, activas en el momento (Lectura + Escritura)&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Enable and see current status page&lt;/em&gt; »» &lt;a href=&#34;http://www.cyberciti.biz/faq/nginx-enable-and-see-current-status-page&#34; target=&#34;_blank&#34;&gt;cyberciti&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;HttpStubStatusModule&lt;/em&gt; »» &lt;a href=&#34;http://wiki.nginx.org/HttpStubStatusModule&#34; target=&#34;_blank&#34;&gt;wiki.nginx.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Cómo instalar y configurar Nginx con php5-fpm</title>
            <link>https://elbauldelprogramador.com/como-instalar-nginx-con-php5-fpm/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/como-instalar-nginx-con-php5-fpm/</guid>
            <description>&lt;figure&gt;
        &lt;a href=&#34;https://elbauldelprogramador.com/img/2013/02/nginx-logo.png&#34;&gt;
          &lt;img
            on=&#34;tap:lightbox1&#34;
            role=&#34;button&#34;
            tabindex=&#34;0&#34;
            layout=&#34;responsive&#34;
            src=&#34;https://elbauldelprogramador.com/img/2013/02/nginx-logo.png&#34;
            alt=&#34;instalar y configurar nginx&#34;
            title=&#34;instalar y configurar nginx&#34;
            sizes=&#34;(min-width: 350px) 350px, 100vw&#34;
            width=&#34;350&#34;
            height=&#34;90&#34;&gt;
          &lt;/img&gt;
        &lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;Nginx (Pronunciado engine-x) es un servidor &lt;a href=&#34;https://elbauldelprogramador.com/como-funciona-http2-protocolo-que-acelera-considerablemente-la-navegacion-web/&#34;&gt;HTTP&lt;/a&gt; de alto rendimiento, gratuito, software libre y &lt;a href=&#34;https://es.wikipedia.org/wiki/Proxy#Reverse_Proxy_.2F_Proxy_inverso&#34; target=&#34;_blank&#34;&gt;proxy inverso&lt;/a&gt;, así como un servidor proxy &lt;a href=&#34;https://es.wikipedia.org/wiki/Internet_Message_Access_Protocol&#34; target=&#34;_blank&#34;&gt;IMAP&lt;/a&gt;/&lt;a href=&#34;https://es.wikipedia.org/wiki/Post_Office_Protocol&#34; target=&#34;_blank&#34;&gt;POP3&lt;/a&gt;. Desarrollado por Igor Sysoev. Acualmente el &lt;a href=&#34;http://news.netcraft.com/archives/2012/01/03/january-2012-web-server-survey.html&#34; target=&#34;_blank&#34;&gt;12.18%&lt;/a&gt; de las webs usan nginx como servidor HTTP. Sus aspectos más destacables son el rendimiento, estabilidad, simplicidad de configuración y un bajo consumo de recursos. En este artículo explicaré como instalar nginx desde el código fuente.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;instalando-dependencias&#34;&gt;Instalando dependencias&lt;/h1&gt;

&lt;p&gt;Antes de poder compilar nginx, es necesario instalar unos cuantos paquetes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# apt-get install build-essential libssl-dev libpcre3-dev&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;El paquete &lt;code&gt;build-essential&lt;/code&gt; contiene las herramientas básicas para compilar programas desde código fuente, las otras dos librerías son necesarias para nginx durante el proceso de compilación.&lt;/p&gt;

&lt;h1 id=&#34;descargar-y-compilar-nginx&#34;&gt;Descargar y compilar Nginx&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ wget http://nginx.org/download/nginx-1.2.6.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Descomprimimos el fichero:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ tar zxvf nginx-1.2.6.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Una vez descomprimido, entramos en el directorio y compilamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; nginx-1.2.6
~/nginx-1.2.6$ ./configure --sbin-path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module
~/nginx-1.2.6$ make
~/nginx-1.2.6$ sudo make install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Para consultar qué modulos hay disponibles hay que visitar la &lt;a href=&#34;http://wiki.nginx.org/Modules&#34; target=&#34;_blank&#34;&gt;pagina oficial de Nginx&lt;/a&gt; y decidir cuales queremos habilitar. Con la opción &lt;code&gt;--sbin-path=/usr/local/sbin&lt;/code&gt; establecemos la ruta en la que se instalará el ejecutable. Tras compilar se mostrará información de la localización de los distintos ficheros:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;nginx path prefix: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx&amp;quot;&lt;/span&gt;
nginx binary file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/sbin&amp;quot;&lt;/span&gt;
nginx configuration prefix: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/conf&amp;quot;&lt;/span&gt;
nginx configuration file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/conf/nginx.conf&amp;quot;&lt;/span&gt;
nginx pid file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/logs/nginx.pid&amp;quot;&lt;/span&gt;
nginx error log file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/logs/error.log&amp;quot;&lt;/span&gt;
nginx http access log file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/logs/access.log&amp;quot;&lt;/span&gt;
nginx http client request body temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;client_body_temp&amp;quot;&lt;/span&gt;
nginx http proxy temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;proxy_temp&amp;quot;&lt;/span&gt;
nginx http fastcgi temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;fastcgi_temp&amp;quot;&lt;/span&gt;
nginx http uwsgi temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;uwsgi_temp&amp;quot;&lt;/span&gt;
nginx http scgi temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;scgi_temp&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Es necesario descargar un script que permita detener, reiniciar e iniciar nginx, podemos descargar el siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ wget https://raw.github.com/JasonGiedymin/nginx-init-ubuntu/master/nginx
$ sudo mv nginx /etc/init.d/nginx
$ sudo chmod +x /etc/init.d/nginx
$ sudo chown root:root /etc/init.d/nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;En el tercer comando otorgamos permiso de ejecución al script, con el cuarto hacemos al usuario root propietario del mismo.&lt;/p&gt;

&lt;p&gt;Si queremos que nginx se inicie automáticamente al iniciar el sistema, hay que añadirlo a los &lt;a href=&#34;https://elbauldelprogramador.com/entendiendo-los-runlevel-en-debian-y-ubuntu/&#34;&gt;runlevel&lt;/a&gt; correspondientes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# update-rc.d nginx defaults&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ahora estamos en condiciones de ejecutar nginx:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# /etc/init.d/nginx start&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ok &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Starting Nginx Server...:.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Listo, nos dirigimos a nuestro navegador y escribimos en la barra de direcciones &lt;strong&gt;localhost&lt;/strong&gt;. Si todo ha ido bien deberíamos ver esta pantalla:&lt;/p&gt;

&lt;figure&gt;
    &lt;img on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2013/02/instalar-nginx-en-debian-1024x818.png&#34; alt=&#34;instalar nginx en debian&#34; width=&#34;1024px&#34; height=&#34;818px&#34;&gt;&lt;/img&gt;
&lt;/figure&gt;

&lt;p&gt;Usando firebug se puede comprobar que efectivamente se está corriendo un servidor nginx:&lt;/p&gt;

&lt;figure&gt;
    &lt;img on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2013/02/instalar-nginx-en-debian2.png&#34; alt=&#34;instalar nginx en debian2&#34; width=&#34;641px&#34; height=&#34;150px&#34;&gt;&lt;/img&gt;
&lt;/figure&gt;

&lt;h1 id=&#34;modificando-la-configuración-por-defecto&#34;&gt;Modificando la configuración por defecto&lt;/h1&gt;

&lt;p&gt;Sustituimos la configuración por defecto por esta:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;user  www-data&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
worker_processes  1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

pid        /var/run/nginx.pid&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

error_log  logs/error.log&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

events &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    worker_connections  1024&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

http &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    include       mime.types&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    default_type  application/octet-stream&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    gzip on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_buffers &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; 8k&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_disable &lt;span class=&#34;s2&#34;&gt;&amp;quot;MSIE [1-6]\.&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_proxied any&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    log_format  main  &lt;span class=&#34;s1&#34;&gt;&amp;#39;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;#39;&lt;/span&gt;
                      &lt;span class=&#34;s1&#34;&gt;&amp;#39;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;#39;&lt;/span&gt;
                      &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    access_log  logs/access.log  main&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    sendfile        on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    keepalive_timeout  3&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    index              index.html index.htm&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    server &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        listen       80&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server_name localhost&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        root html&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

 access_log  logs/host.access.log  main&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

        &lt;span class=&#34;c1&#34;&gt;# Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).&lt;/span&gt;
        location ~ /&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                deny all&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
                access_log off&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
                log_not_found off&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Los cambios más relevantes sobre la configuración por defecto son:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Se ha cambiado el usuario del servidor de “*nobody*” a “*www-data*”, éste último es el usuario por defecto para servidores webs.&lt;/li&gt;
&lt;li&gt;Se define el archivo donde se localizará el PID (Process ID) del servidor. Esto permite al script que hemos instalado iniciar o detener nginx.&lt;/li&gt;
&lt;li&gt;Se habilita la compresión gzip para reducir el ancho de banda consumido.&lt;/li&gt;
&lt;li&gt;Se define el formato que tendrán los ficheros de log.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Cambiamos los permisos de los ficheros que contienen la web y reiniciamos nginx para aplicar los cambios:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ sudo chown -R www-data:www-data html/
$ sudo service nginx destroy &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo service nginx start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;instalar-php5-fpm&#34;&gt;Instalar php5-fpm&lt;/h1&gt;

&lt;p&gt;En lugar de instalar php5, instalaremos php5-fpm (&lt;em&gt;FastCGI Process Manager&lt;/em&gt;), una implementación alternativa con algunas características adicionales.&lt;/p&gt;

&lt;p&gt;En ubuntu, ejecutamamos el siguiente comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# apt-get install php5-fpm&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;En debian agregamos el repositorio al &lt;em&gt;sources.list&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;deb http://packages.dotdeb.org stable all
deb-src http://packages.dotdeb.org stable all
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Agregamos la llave &lt;a href=&#34;https://elbauldelprogramador.com/como-cifrar-correos-con-gpg-con-mailvelope/&#34; title=&#34;Cómo cifrar correos con GPG usando Mailvelope&#34;&gt;GnuPG&lt;/a&gt; del repositorio:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;apt-get update
wget http://www.dotdeb.org/dotdeb.gpg
cat dotdeb.gpg &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo apt-key add -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Instalamos php:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# apt-get install php5-cli php5-suhosin php5-fpm php5-cgi php5-mysql&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Lo iniciamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# /etc/init.d/php5-fpm start&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Para lograr que nginx interprete php, hay que hacer algunas modificaciones a la configuración:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;user  www-data&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
worker_processes  1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

pid        /var/run/nginx.pid&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

error_log  logs/error.log&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

events &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    worker_connections  1024&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

http &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    include       mime.types&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    default_type  application/octet-stream&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    gzip on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_buffers &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; 8k&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_disable &lt;span class=&#34;s2&#34;&gt;&amp;quot;MSIE [1-6]\.&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_proxied any&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    log_format  main  &lt;span class=&#34;s1&#34;&gt;&amp;#39;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;#39;&lt;/span&gt;
                      &lt;span class=&#34;s1&#34;&gt;&amp;#39;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;#39;&lt;/span&gt;
                      &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    access_log  logs/access.log  main&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    sendfile        on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    keepalive_timeout  3&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    index              index.php index.html index.htm&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    upstream php &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        server 127.0.0.1:9000&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    server &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        listen       80&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server_name localhost&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        root html&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

  access_log  logs/host.access.log  main&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

        &lt;span class=&#34;c1&#34;&gt;# Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).&lt;/span&gt;
        location ~ /&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                deny all&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
                access_log off&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
                log_not_found off&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

        location ~ &lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;php$ &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                include fastcgi_params&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
                fastcgi_index index.php&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
                fastcgi_param SCRIPT_FILENAME &lt;span class=&#34;nv&#34;&gt;$d&lt;/span&gt;ocument_root&lt;span class=&#34;nv&#34;&gt;$fa&lt;/span&gt;stcgi_script_name&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
                fastcgi_pass php&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Los principales cambios realizados son los siguientes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Se ha añadido &lt;code&gt;index.php&lt;/code&gt; antes de &lt;code&gt;index.html index.htm&lt;/code&gt; para dar prioridad a los archivos php.&lt;/li&gt;
&lt;li&gt;El bloque &lt;code&gt;upstream php&lt;/code&gt; que apunta a &lt;code&gt;PHP-FPM&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Un manejador para archivos php &lt;code&gt;location ~ \.php$&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Para terminar, añadimos los siguientes parámetros al final del archivo &lt;em&gt;/usr/local/nginx/fastcgi_params&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;fastcgi_connect_timeout 60&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
fastcgi_send_timeout 180&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
fastcgi_read_timeout 180&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
fastcgi_buffer_size 128k&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
fastcgi_buffers &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; 256k&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
fastcgi_busy_buffers_size 256k&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
fastcgi_temp_file_write_size 256k&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
fastcgi_intercept_errors on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Para aplicar los cambios, reiniciamos nginx:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# service nginx restart&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Con esto, deberíamos tener instalado un servidor corriendo con nginx y ejecutando archivos php.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Learn how to setup a web server pt2: Installing Nginx and PHP&lt;/em&gt; »» &lt;a href=&#34;http://blog.bryanbibat.net/2011/12/19/learn-how-to-setup-a-web-server-pt2-installing-nginx-and-php/&#34; target=&#34;_blank&#34;&gt;blog.bryanbibat.net&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;HOWTO install php5-fpm on Debian Squeeze&lt;/em&gt; »» &lt;a href=&#34;http://fak3r.com/2011/09/27/howto-install-php5-fpm-on-debian-squeeze/&#34; target=&#34;_blank&#34;&gt;fak3r.com&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Cómo ocultar la versión de BIND (Y cómo averiguarla)</title>
            <link>https://elbauldelprogramador.com/como-ocultar-la-version-de-bind-y-como-averiguarla/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/como-ocultar-la-version-de-bind-y-como-averiguarla/</guid>
            <description>&lt;figure&gt;
    &lt;img sizes=&#34;(min-width: 300px) 300px, 100vw&#34; on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2013/04/dns-300x240.jpg&#34; alt=&#34;Cómo ocultar la versión de BIND (Y como averiguarla)&#34; width=&#34;300px&#34; height=&#34;240px&#34;&gt;&lt;/img&gt;
&lt;/figure&gt;

&lt;p&gt;Realizando un análisis en &lt;em&gt;&lt;a href=&#34;http://www.dnsinspect.com&#34; target=&#34;_blank&#34;&gt;dnsInspect&lt;/a&gt;&lt;/em&gt; me dí cuenta de que el servidor estaba mostrando la versión de &lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns/&#34;&gt;BIND&lt;/a&gt;, lo cual no es buena idea. Así que busqué cómo ocultarla y aprovecho para compartirlo con todos vosotros por si alguna vez os hace falta.&lt;/p&gt;

&lt;p&gt;Antes de proceder a ocultar la versión, comprobemos que efectivamente la estamos mostrando, usaremos &lt;strong&gt;&lt;a href=&#34;https://elbauldelprogramador.com/dig-chuleta-basica-de-comandos/&#34; title=&#34;Dig – Chuleta básica de comandos&#34;&gt;dig&lt;/a&gt;&lt;/strong&gt; para ello:&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Consultamos la versión para el dominio de la web&lt;/span&gt;
$ dig @example.com -c CH -t txt version.bind
&lt;span class=&#34;c1&#34;&gt;# Consultamos también en nuestros servidores DNS secundarios&lt;/span&gt;
$ dig @direcciónDNS -c CH -t txt version.bind
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Tras ejecutar el primer comando deberiamos ver si estamos mostrando la versión de &lt;strong&gt;BIND&lt;/strong&gt;. En mi caso la respuesta era afirmativa, sin embargo al consultar la versión en el servidor DNS secundario la respuesta era &lt;strong&gt;&lt;em&gt;&amp;#8220;[Secured]&amp;#8221;&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Una vez hecho esto, pasamos a ocultar la versión.&lt;/p&gt;

&lt;h1 id=&#34;ocultar-la-versión-de-bind-en-un-servidor&#34;&gt;Ocultar la versión de BIND en un servidor&lt;/h1&gt;

&lt;p&gt;Esto no es más que &lt;strong&gt;seguridad mediante oscuridad&lt;/strong&gt;, ya que aunque se oculte la versión, hay herramientas que detectarán la versión de BIND, como &lt;strong&gt;&lt;a href=&#34;http://www.cyberciti.biz/tips/howto-remotely-determine-dns-server-version.html&#34; target=&#34;_blank&#34;&gt;fpdns&lt;/a&gt;&lt;/strong&gt;. Sin embargo, ocultandola evitaremos que scripts automatizados buscando versiones concretas puedan aprovecharse de cualquier vulnerabilidad.&lt;/p&gt;

&lt;p&gt;Abrimos el fichero de configuración de &lt;strong&gt;BIND&lt;/strong&gt;, concretamente &lt;em&gt;/etc/bind/named.conf.options&lt;/em&gt; y añadimos la siguiente línea:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;version &lt;span class=&#34;s2&#34;&gt;&amp;quot;Texto a mostrar&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Guardamos el fichero y reiniciamos &lt;strong&gt;BIND&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# service bind9 restart&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;mostrar-versión-de-bind-aún-cuando-está-oculta&#34;&gt;Mostrar versión de BIND aún cuando está oculta&lt;/h1&gt;

&lt;p&gt;Instalamos &lt;em&gt;fpdns&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install fpdns
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Lo ejecutamos pasando como argumento el servidor del cual queremos determinar la versión:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;$ fpdns -D &amp;lt;dominio&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;La salida será algo de este estilo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;fingerprint &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;elbauldelprogramador.com, ip&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;: ISC BIND version -- version
fingerprint &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;elbauldelprogramador.com, ip&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;: ISC BIND version -- version
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Cybercity&lt;/em&gt; »» &lt;a href=&#34;http://www.cyberciti.biz/faq/hide-bind9-dns-sever-version/&#34; target=&#34;_blank&#34;&gt;Visitar sitio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Dig - Chuleta básica de comandos</title>
            <link>https://elbauldelprogramador.com/dig-chuleta-basica-de-comandos/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/dig-chuleta-basica-de-comandos/</guid>
            <description>&lt;p&gt;&lt;strong&gt;Dig (Domain Information Groper)&lt;/strong&gt; es un comando de gran utilidad para realizar consultas a registros DNS. Se usa mucho &amp;#8212; entre otras cosas &amp;#8212; para el diagnóstico de &lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns/&#34; title=&#34;Cómo configurar un servidor DNS – Parte 1 (Introducción)&#34;&gt;Servidores DNS&lt;/a&gt;. Desde que administro yo mismo el servidor del blog lo he usado bastante, y hoy voy a dar unas nociones básicas de cómo usarlo.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;actualización&#34;&gt;[Actualización]&lt;/h1&gt;

&lt;p&gt;En un comentario hecho en la página de &lt;a href=&#34;https://plus.google.com/b/108003822606696308728/108003822606696308728/posts/idbcxhy5vzG&#34; target=&#34;_blank&#34;&gt;Google+ del blog&lt;/a&gt; un usuario indicó que es posible obtener una salida simplificada de todos los comandos de abajo con la opción &lt;em&gt;+short&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;El ejemplo más básico es:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;dig ejemplo.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;obtener-distintos-tipos-de-registros-dns&#34;&gt;Obtener distintos tipos de registros DNS&lt;/h1&gt;

&lt;p&gt;La sintaxis es:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;dig @servidor-dns ejemplo.com tipo-de-registro
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ejemplo de uso:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;dig @208.67.222.222 google.com A

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;google.com.          IN  A

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; ANSWER SECTION:
google.com.      &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.231
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.226
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.230
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.228
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.238
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.229
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.227
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.225
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.232
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.224
google.com.       &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; IN  A   173.194.34.233
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;obtener-los-servidores-de-nombres&#34;&gt;Obtener los servidores de nombres&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;dig @208.67.222.222 google.com NS

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;google.com.            IN  NS

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; ANSWER SECTION:
google.com.     &lt;span class=&#34;m&#34;&gt;172749&lt;/span&gt;  IN  NS  ns2.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;172749&lt;/span&gt;  IN  NS  ns1.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;172749&lt;/span&gt;  IN  NS  ns3.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;172749&lt;/span&gt;  IN  NS  ns4.google.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;obtener-registros-mx-de-correo&#34;&gt;Obtener registros MX (De correo)&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;dig @208.67.222.222 google.com MX

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;google.com.            IN  MX

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; ANSWER SECTION:
google.com.     &lt;span class=&#34;m&#34;&gt;469&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; alt1.aspmx.l.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;469&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; aspmx.l.google.com.
google.com.       &lt;span class=&#34;m&#34;&gt;469&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt; alt3.aspmx.l.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;469&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;50&lt;/span&gt; alt4.aspmx.l.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;469&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; alt2.aspmx.l.google.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;obtener-registros-txt&#34;&gt;Obtener registros TXT&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;dig @208.67.222.222 google.com TXT

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;google.com.          IN  TXT

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; ANSWER SECTION:
google.com.        &lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;    IN  TXT &lt;span class=&#34;s2&#34;&gt;&amp;quot;v=spf1 include:_spf.google.com ip4:216.73.93.70/31 ip4:216.73.93.72/31 ~all&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;obtener-todos-los-tipos-de-registros-en-una-misma-consulta&#34;&gt;Obtener todos los tipos de registros en una misma consulta&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;dig any google.com

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;google.com.           IN  ANY

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; ANSWER SECTION:
google.com.        &lt;span class=&#34;m&#34;&gt;407&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt; alt3.aspmx.l.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;407&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; alt2.aspmx.l.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;407&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; alt1.aspmx.l.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;407&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; aspmx.l.google.com.
google.com.       &lt;span class=&#34;m&#34;&gt;407&lt;/span&gt; IN  MX  &lt;span class=&#34;m&#34;&gt;50&lt;/span&gt; alt4.aspmx.l.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;172781&lt;/span&gt;  IN  NS  ns2.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;172781&lt;/span&gt;  IN  NS  ns1.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;172781&lt;/span&gt;  IN  NS  ns3.google.com.
google.com.      &lt;span class=&#34;m&#34;&gt;172781&lt;/span&gt;  IN  NS  ns4.google.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;realizar-una-consulta-inversa&#34;&gt;Realizar una consulta inversa&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;dig -x 173.194.34.233

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;233.34.194.173.in-addr.arpa.  IN  PTR

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt; ANSWER SECTION:
233.34.194.173.in-addr.arpa. &lt;span class=&#34;m&#34;&gt;83265&lt;/span&gt; IN  PTR mad01s09-in-f9.1e100.net.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Puedes encontrar una descripción un poco más extensa sobre el funcionamiento de la consulta inversa en la &lt;a href=&#34;https://elbauldelprogramador.com/como-configurar-un-servidor-dns3/&#34;&gt;tercera&lt;/a&gt; parte del artículo &lt;em&gt;Cómo configurar un servidor DNS&lt;/em&gt;&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;dig – Linux DNS Lookup utility cheat sheet&lt;/em&gt; »» &lt;a href=&#34;http://linuxaria.com/pills/dig-linux-dns-lookup-utility-cheat-sheet&#34; target=&#34;_blank&#34;&gt;linuxaria&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Instalación y optimización de un servidor web con Nginx (I)</title>
            <link>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i/</guid>
            <description>&lt;blockquote&gt;
&lt;p&gt;La siguiente serie de artículos son el fruto de un trabajo realizado para la facultad en la asignatura Ingeniería de Servidores de la Universidad de Granada (ETSIIT [Escuela Técnica Superior de Ingenierías Informática y de Telecomunicación] )&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;em&gt;A lo largo de esta guía se pretende mostrar cómo instalar desde cero un servidor web con Nginx, realizando las operaciones necesarias para lograr el mayor rendimiento y seguridad posibles con programas tales como php-fpm, APC, y el módulo pagespeed de Google para optimizar los recursos web.&lt;/em&gt;&lt;/p&gt;

&lt;h1 id=&#34;tabla-de-contenidos&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (II)&#34;&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (III)&#34;&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hace tiempo se vío en este blog &lt;a href=&#34;https://elbauldelprogramador.com/como-instalar-nginx-con-php5-fpm/&#34; title=&#34;Cómo instalar y configurar Nginx con php5-fpm&#34;&gt;cómo instalar y configurar Nginx con php5-fpm&lt;/a&gt;, en los próximos artículos se intentará explicar de forma más detallada cómo llevar a cabo éste proceso junto con algunas mejoras adicionales en términos de optimización. Es necesario informar al lector que todas las recomendaciones aquí explicadas se basan únicamente en la experiencias del autor.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h2 id=&#34;compilar-e-instalar-nginx&#34;&gt;Compilar e instalar Nginx&lt;/h2&gt;

&lt;h3 id=&#34;preparando-el-entorno&#34;&gt;Preparando el entorno&lt;/h3&gt;

&lt;p&gt;Lo primero que debemos hacer es instalar las dependencias necesarias para la compilación, para ello:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;apt-get install build-essential libssl-dev libpcre3-dev
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Tras esto descargamos la última versión de nginx, al momento de escribir este texto la 1.4.4:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;wget http://nginx.org/download/nginx-1.4.4.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Descomprimimos el archivo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;tar xzvf nginx-1.4.4.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Antes de compilar cambiaremos un valor en el código fuente como medida de seguridad por ocultación. El valor a cambiar es la cadena asignada a la cabecera que indica el servidor usado en las peticiones HTTP. En concreto el archivo a cambiar es el alojado en &lt;code&gt;src/http/ngx_http_header_filter_module.c&lt;/code&gt;, concretamente en la línea 48:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ngx_http_server_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;quot;Server: nginx&amp;quot;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CRLF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ngx_http_server_full_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;quot;Server: &amp;quot;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NGINX_VER&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CRLF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Cambiamos estas dos líneas a algo del estilo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ngx_http_server_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;quot;Server: Mi servidor Web&amp;quot;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CRLF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ngx_http_server_full_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;quot;Server: Mi servidor Web&amp;quot;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CRLF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ya solo queda compilarlo e instalarlo, de momento necesitaremos los módulos siguientes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;--with-http_gzip_static_module --sbin-path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/sbin -with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Aquí estamos habilitando la compresión de las páginas con gzip, SSL para conexiones seguras, deshabilitando el módulo de correo POP3, IMAP y SMTP. Dependiendo de las necesidades de nuestro servidor, deberemos activar o desactivar algunos módulos. Más tarde necesitaremos recompilar para añadir el módulo &lt;strong&gt;pagespeed&lt;/strong&gt;. La lista de todos los módulos disponibles se puede consultar en la &lt;a href=&#34;http://wiki.nginx.org/Modules&#34; title=&#34;Módulos nginx&#34; target=&#34;_blank&#34;&gt;documentación de nginx&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;compilar&#34;&gt;Compilar&lt;/h3&gt;

&lt;p&gt;Ya está todo listo para compilar e instalar, dentro del directorio de nginx ejecutamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;./configure --with-http_gzip_static_module --sbin-path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/sbin &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
--with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module&lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
--without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Tras esto deberíamos ver un resumen de la operación realizada:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;Configuration summary
  + using system PCRE library
  + using system OpenSSL library
  + md5: using OpenSSL library
  + sha1: using OpenSSL library
  + using system zlib library

  nginx path prefix: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx&amp;quot;&lt;/span&gt;
  nginx binary file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/sbin&amp;quot;&lt;/span&gt;
  nginx configuration prefix: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/conf&amp;quot;&lt;/span&gt;
  nginx configuration file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/conf/nginx.conf&amp;quot;&lt;/span&gt;
  nginx pid file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/logs/nginx.pid&amp;quot;&lt;/span&gt;
  nginx error log file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/logs/error.log&amp;quot;&lt;/span&gt;
  nginx http access log file: &lt;span class=&#34;s2&#34;&gt;&amp;quot;/usr/local/nginx/logs/access.log&amp;quot;&lt;/span&gt;
  nginx http client request body temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;client_body_temp&amp;quot;&lt;/span&gt;
  nginx http proxy temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;proxy_temp&amp;quot;&lt;/span&gt;
  nginx http fastcgi temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;fastcgi_temp&amp;quot;&lt;/span&gt;
  nginx http uwsgi temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;uwsgi_temp&amp;quot;&lt;/span&gt;
  nginx http scgi temporary files: &lt;span class=&#34;s2&#34;&gt;&amp;quot;scgi_temp&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Para compilar e instalar:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;make -j &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Tras esto, es necesario descargar el script que permite iniciar, detener, reiniciar y recargar nginx mediante el comando &lt;strong&gt;service&lt;/strong&gt;, podemos descargarlo desde&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;wget https://raw.github.com/JasonGiedymin/nginx-init-ubuntu/master/nginx
mv nginx /etc/init.d/nginx
sudo chmod +x /etc/init.d/nginx
sudo chown root:root /etc/init.d/nginx
update-rc.d nginx defaults
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Con esto hemos descargaro el script, lo hemos movido al directorio en el que será llamado al inicio del sistema, dado permisos de ejecución y asignado a root como propietario. Hecho esto, para iniciar nuestro servidor web hay que ejecutar el comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;service nginx start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Como se muestra en la siguiente figura nginx, podemos comprobar que nginx está funcionando correctamente dirigiéndonos a la dirección &lt;em&gt;localhost&lt;/em&gt;, donde veremos lo siguiente:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&#34;https://elbauldelprogramador.com/img/2014/02/instalacionNginx.png&#34;&gt;&lt;img sizes=&#34;(min-width: 554px) 554px, 100vw&#34; on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2014/02/instalacionNginx.png&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34; alt=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34; width=&#34;554px&#34; height=&#34;192px&#34; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;h3 id=&#34;configuración&#34;&gt;Configuración&lt;/h3&gt;

&lt;p&gt;Ya que está todo listo, vamos a realizar unos cuantos ajustes a la configuración por defecto:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;user  www-data&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
worker_processes  1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

pid        /var/run/nginx.pid&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

error_log  logs/error.log&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

events &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    worker_connections  1024&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

http &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    include       mime.types&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    default_type  application/octet-stream&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    gzip on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_buffers &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; 8k&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_disable &lt;span class=&#34;s2&#34;&gt;&amp;quot;MSIE [1-6]\.&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_proxied any&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    log_format  main  &lt;span class=&#34;s1&#34;&gt;&amp;#39;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;#39;&lt;/span&gt;
                      &lt;span class=&#34;s1&#34;&gt;&amp;#39;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;#39;&lt;/span&gt;
                      &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    access_log  logs/access.log  main&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    sendfile        on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    keepalive_timeout  3&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    index              index.html index.htm&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    server &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        listen       80&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        server_name localhost&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        root html&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    access_log  logs/host.access.log  main&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

        &lt;span class=&#34;c1&#34;&gt;# Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).&lt;/span&gt;
        location ~ /&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                deny all&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
                access_log off&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
                log_not_found off&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Los cambios más relevantes sobre la configuración por defecto son:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Se ha cambiado el usuario del servidor de &lt;em&gt;nobody&lt;/em&gt; a &lt;em&gt;www-data&lt;/em&gt;, éste último es el usuario por defecto para servidores webs.&lt;/li&gt;
&lt;li&gt;Se define el archivo donde se localizará el PID (Process ID) del servidor. Esto permite al script que hemos instalado iniciar o detener nginx.&lt;/li&gt;
&lt;li&gt;Se habilita la compresión gzip para reducir el ancho de banda consumido.&lt;/li&gt;
&lt;li&gt;Se define el formato que tendrán los ficheros de log.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Cambiamos los permisos del directorio donde se alojan los recursos web a este último usuario y reiniciamos nginx:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;chown -R www-data:www-data /usr/local/nginx/html/
service nginx destroy &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; service nginx start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;tabla-de-contenidos-1&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (II)&#34;&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (III)&#34;&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Instalación y optimización de un servidor web con Nginx (II)</title>
            <link>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii/</guid>
            <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34;&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (III)&#34;&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Continuando con el artículo anterior, ahora procedemos a instalar PHP-FPM.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;instalar-php-fpm&#34;&gt;Instalar PHP-FPM&lt;/h1&gt;

&lt;p&gt;En lugar de instalar php5, instalaremos php5-fpm (FastCGI Process Manager), una implementación alternativa con algunas características adicionales. En Ubuntu se puede instalar desde repositorios, para debian los agregamos a mano al &lt;em&gt;sources.list&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;deb http://packages.dotdeb.org stable all
deb-src http://packages.dotdeb.org stable all
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Es necesario agregar la &lt;a href=&#34;https://elbauldelprogramador.com/editar-y-crear-archivos-cifrados-con-gpg-en-vim/&#34; title=&#34;Editar y crear archivos cifrados con GPG en Vim&#34;&gt;llave GnuPG&lt;/a&gt;, instalamos php5-fpm y lo iniciamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;apt-get update
wget http://www.dotdeb.org/dotdeb.gpg
cat dotdeb.gpg &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo apt-key add -
apt-get install php5-cli php5-suhosin php5-fpm php5-cgi php5-mysql
service php5-fpm start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ahora probaremos que php funciona bajo nginx, para ello es necesario modificar ligeramente el archivo &lt;em&gt;nginx.conf&lt;/em&gt;, concretamente:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;En el bloque &lt;em&gt;http&lt;/em&gt; hay que añadir index.php a la directiva index, para que quede index &lt;em&gt;index.php index.html index.htm;&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Necesitamos crear la comunicación entre nginx y php mediante un socket, para ello añadimos lo siguiente en el bloque &lt;em&gt;http&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;upstream php &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    server unix://var/run/php-fpm.socket&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;Por último, dentro del bloque &lt;em&gt;server&lt;/em&gt;, añadimos una regla que permita manejar los archivos php:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;location ~ &lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;php$ &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    include fastcgi_params&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    fastcgi_index index.php&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    fastcgi_param SCRIPT_FILENAME &lt;span class=&#34;nv&#34;&gt;$d&lt;/span&gt;ocument_root&lt;span class=&#34;nv&#34;&gt;$fa&lt;/span&gt;stcgi_script_name&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    fastcgi_pass php&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;Una última modificación al archivo &lt;em&gt;/etc/php5/fpm/pool.d/www.conf&lt;/em&gt; y agregamos la línea &lt;em&gt;listen = /var/run/php-fpm.socket&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;probando-php&#34;&gt;Probando PHP&lt;/h2&gt;

&lt;p&gt;Para comprobar que PHP funciona crearemos un fichero simple que mostrará un mensaje, hemos de colocarlo en &lt;em&gt;/usr/local/nginx/http/&lt;/em&gt; y asignarle como grupo y usuario &lt;em&gt;www-data&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;lt;?php echo &amp;quot;Probando que PHP funciona&amp;quot;;??&amp;gt;&amp;#39;&lt;/span&gt; &amp;gt; /usr/local/nginx/html/index.php
chown www-data:www-data /usr/local/nginx/html/index.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;De nuevo nos dirigimos al &lt;em&gt;localhost&lt;/em&gt; y deberíamos ver el mensaje, lo cual indica que se está ejecutando PHP.&lt;/p&gt;

&lt;h1 id=&#34;tabla-de-contenidos&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34;&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (III)&#34;&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Instalación y optimización de un servidor web con Nginx (III)</title>
            <link>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-iii/</guid>
            <description>&lt;h1 id=&#34;tabla-de-contenidos&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34;&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (II)&#34;&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;En éste último artículo se verá cómo realizar optimizaciones al servidor web nginx, PHP y se cubrirá la instalación del sistema de caches APC y el módulo Page Speed de Google.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h2 id=&#34;optimizando&#34;&gt;Optimizando&lt;/h2&gt;

&lt;h3 id=&#34;pools-en-php&#34;&gt;Pools en PHP&lt;/h3&gt;

&lt;p&gt;La configuración por defecto de PHP no suele ser la óptima, dependiendo de nuestras necesidades y hardware deberemos ajustar algunos parámetros. En esta sección nos centraremos en el número de procesos y recursos que se dedicarán a una aplicación web. Estos parámetros se encuentran en el directorio &lt;em&gt;/etc/php/fpm/pools.d&lt;/em&gt;, se debe tener una archivo por cada aplicación, en nuestro caso será &lt;em&gt;www.conf&lt;/em&gt;.
Los parámetros a ajustar son:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pm&lt;/strong&gt;: Decide cómo el controlador de procesos administra los procesos hijos, es recomendable establecerlo a dinámico.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pm.max_children&lt;/strong&gt;: Cuando pm es estático, el número de hijos a crear, cuando es dinámico, el máximo número de hijos que se podrán tener.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pm.start_servers&lt;/strong&gt;: Número de hijos a crear al inicio.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pm.min_spare_servers&lt;/strong&gt;: El número mínimo de procesos libres (Sin hacer nada).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pm.max_spare_servers&lt;/strong&gt;: Número máximo de procesos libres.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;pm.max_requests&lt;/strong&gt;: El número de peticiones que cada hijo aceptará antes de reiniciarse, útil para evitar pérdidas de memoria.&lt;/p&gt;

&lt;p&gt;Hay varias aproximaciones para determinar el valor adecuado de estos parámetros, en esta guía se verán 3, y todas con &lt;em&gt;pm = dynamic&lt;/em&gt;.&lt;/p&gt;

&lt;h4 id=&#34;primer-método&#34;&gt;Primer método&lt;/h4&gt;

&lt;p&gt;El primero (&lt;a href=&#34;http://nls.io/optimize-nginx-and-php-fpm-max_children/&#34; title=&#34;Optimize nginx and PHP-FPM (max_children)&#34; target=&#34;_blank&#34;&gt;Guillaume Moigneu&lt;/a&gt;) consiste en calcular &lt;em&gt;pm.max_children&lt;/em&gt; basándonos en la fórmula:&lt;/p&gt;

&lt;p&gt;$$pm.max\_children = (RAM_{total} - RAM_{resto Proc})/ RAM_{mediaPHP}$$&lt;/p&gt;

&lt;p&gt;Donde $$RAM_{restoProc}$$ es la memoria usada por los otros procesos y $$RAM_{mediaPHP}$$ es la media de memoria usada por los procesos de PHP. La memoria consumida por el resto de procesos se puede calcular mediante este comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;ps -ylA --sort:rss &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -v php5-fpm &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; awk &lt;span class=&#34;s1&#34;&gt;&amp;#39;!/RSS/ { s+=$8 } END { printf &amp;quot;%s\n&amp;quot;, &amp;quot;Memoria total usada por otros procesos&amp;quot;; printf &amp;quot;%dM\n&amp;quot;, s/1024 }&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Y la consumida por PHP:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;ps -ylC php5-fpm --sort:rss  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; awk &lt;span class=&#34;s1&#34;&gt;&amp;#39;!/RSS/ { s+=$8 } END { printf &amp;quot;%s\n&amp;quot;, &amp;quot;Memoria consumida por PHP: &amp;quot;; printf &amp;quot;%dM\n&amp;quot;, s/1024 }&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Al número anterior lo dividimos por los procesos de PHP y obtenemos la media. Una vez calculado el valor de &lt;em&gt;max_children&lt;/em&gt;, &lt;em&gt;min_spare_servers&lt;/em&gt; y &lt;em&gt;max_spare_servers&lt;/em&gt; se suelen calcular evaluando el rendimiento y &lt;em&gt;start_servers&lt;/em&gt;, suele ser:&lt;/p&gt;

&lt;p&gt;$$ start\_servers = \frac{min\_spare\_servers + (max\_spare\_servers - min\_spare\_servers)}{2} $$&lt;/p&gt;

&lt;h4 id=&#34;segundo-método&#34;&gt;Segundo método&lt;/h4&gt;

&lt;p&gt;El segundo método (&lt;a href=&#34;http://myshell.co.uk/index.php/adjusting-child-processes-for-php-fpm-nginx/&#34; title=&#34;Adjusting child processes for PHP-FPM (Nginx)&#34; target=&#34;_blank&#34;&gt;myshell.co.uk&lt;/a&gt;) es calcularlo en base a:&lt;/p&gt;

&lt;p&gt;$$ pm.max\_children = RAM_{total} / RAM_{maxPHP} $$&lt;/p&gt;

&lt;p&gt;Donde $$RAM_{maxPHP}$$ es el process PHP que ocupe más memoria. El resto de parámetros se calculan en base a éste.&lt;/p&gt;

&lt;h4 id=&#34;tercer-método&#34;&gt;Tercer método&lt;/h4&gt;

&lt;p&gt;Por último, otro método (&lt;a href=&#34;https://github.com/perusio/php-fpm-example-config&#34; title=&#34;Example configuration of php-fpm&#34; target=&#34;_blank&#34;&gt;Perusio&lt;/a&gt;) es realizando la operación siguiente:&lt;/p&gt;

&lt;p&gt;$$pm.max\_children = 1.2 \cdot RAM_{total}/RAM_{mediaPHP}$$&lt;/p&gt;

&lt;h3 id=&#34;optimizando-nginx&#34;&gt;Optimizando Nginx&lt;/h3&gt;

&lt;p&gt;FastCGI es un protocolo que hace de interfaz entre programas y servidores web. En esta sección veremos cómo configurar nginx para cachear páginas y aumentar su rendimiento.&lt;/p&gt;

&lt;p&gt;Para aprovechar todos los núcleos de un procesador, nginx necesita ajustar el parámetro &lt;em&gt;worker_processes&lt;/em&gt; acorde al número de procesadores. Para determinar el número de procesadores podemos ejecutar el siguiente comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;cat /proc/cpuinfo&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep processor &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; wc -l
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;En la directiva &lt;em&gt;worker_connections&lt;/em&gt; dentro del bloque &lt;em&gt;events&lt;/em&gt; escribiremos un 1024. Con esto nginx tendrá un proceso por núcleo y cada proceso podrá procesar hasta 1024 conexiones.&lt;/p&gt;

&lt;p&gt;Estableceremos ahora los parámetros que permitirán cachear los resultados para servirlos más rápido al cliente, para ello haremos uso de las directivas &lt;em&gt;fastcgi_cache&lt;/em&gt;. En el bloque &lt;em&gt;http&lt;/em&gt; necesitaremos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;fastcgi_cache_path /var/cache/nginx &lt;span class=&#34;nv&#34;&gt;levels&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1:2 &lt;span class=&#34;nv&#34;&gt;keys_zone&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;microcache:500m &lt;span class=&#34;nv&#34;&gt;max_size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1000m &lt;span class=&#34;nv&#34;&gt;inactive&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;60m&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
fastcgi_cache_key &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;scheme&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;request_method&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;host&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;request_uri&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
fastcgi_cache_use_stale updating error timeout invalid_header http_500&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Lo cual establece el directorio donde se guardarán los objetos cacheados, los niveles de cache, un nombre y el espacio reservado (500Mb), así como un tope máximo (1Gb). La segunda directiva establece bajo qué nombre se almacenará la clave para la cache. Por último la tercera servirá contenido antiguo en la caché cuando haya errores en el servidor web, cuando se esté actualizando la caché, cuando haya errores del tipo 5xx o cuando la cabecera de la petición sea inválida.&lt;/p&gt;

&lt;p&gt;El siguiente paso es decidir qué objetos se almacenarán en caché y cuales no. Para ello, dentro de un bloque &lt;em&gt;server&lt;/em&gt; escribiremos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; $no_cache 0&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;$&lt;span class=&#34;nv&#34;&gt;request_method&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; POST&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; $no_cache 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;$query_string !&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; $no_cache 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    location ~ &lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;php$ &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;# ....&lt;/span&gt;
      fastcgi_cache_bypass $no_cache&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      fastcgi_no_cache $no_cache&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      fastcgi_cache microcache&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      fastcgi_cache_valid 60m&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;En esta porción de código hemos declarado una variable que determinará qué peticiones se cachean y cuales no. No cachearemos ninguna petición POST ni nada que tenga consultas en la URL (?arg&amp;#8230;&amp;arg1;&amp;#8230;). Con ayuda de esta variable podremos decidir en el bloque &lt;em&gt;location&lt;/em&gt; si cacheamos la petición (directivas bypass y no_cache), aquí hacemos referencia al nombre que dimos anteriormente al espacio de caché y fijamos un periodo de validez.&lt;/p&gt;

&lt;h3 id=&#34;page-speed&#34;&gt;Page Speed&lt;/h3&gt;

&lt;p&gt;En esta sección veremos cómo compilar y configurar el módulo desarrollado por Google que optimizará al máximo todos los recursos de nuestra web, minimizando considerablemente el tiempo de respuesta y aplicando algunos cambios a los archivos para que cumplan con los estándares de rendimiento que Google usa para puntuar las páginas web.&lt;/p&gt;

&lt;p&gt;Algunas de las características que ofrece son comprimir los archivos CSS y JavaScript de forma que ocupen lo menos posible. Unificar (cuando sea posible) la mayor cantidad de archivos CSS y JS en uno solo para reducir el número de peticiones al servidor. Optimizar las imágenes para reducir su tamaño. Cargar de forma asíncrona los programas JS. Mover los elementos bloqueantes que impiden que la página se renderize correctamente a lugares donde no sean perjudiciales para el renderizado. Éstas son solo algunas de las funcionalidades principales.&lt;/p&gt;

&lt;h4 id=&#34;preparando-el-entorno&#34;&gt;Preparando el entorno&lt;/h4&gt;

&lt;p&gt;Antes de poder compilar, será necesario instalar algunas dependencias:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;apt-get install build-essential zlib1g-dev libpcre3 libpcre3-dev
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Una vez hecho, estamos en condiciones para descargar y compilar:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ~
wget https://github.com/pagespeed/ngx_pagespeed/archive/v1.7.30.1-beta.zip
unzip v1.7.30.1-beta.zip &lt;span class=&#34;c1&#34;&gt;# or unzip v1.7.30.1-beta&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ngx_pagespeed-1.7.30.1-beta/
wget https://dl.google.com/dl/page-speed/psol/1.7.30.1.tar.gz
tar -xzvf 1.7.30.1.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Hecho esto, será necesario recompilar nginx con este módulo, como comentamos al inicio de esta guía, para ello simplemente ejecutamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;nginx -V &lt;span class=&#34;c1&#34;&gt;# Para ver con qué módulos está compilado el ejecutable actual&lt;/span&gt;
configure arguments: --with-http_gzip_static_module --sbin-path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ~/nginx-1.4.4/ &lt;span class=&#34;c1&#34;&gt;# compilaremos nginx con el nuevo módulo (--ad-module)&lt;/span&gt;
./configure --with-http_gzip_static_module --sbin-path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/sbin --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module --add-module&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;$HOME/ngx_pagespeed-1.7.30.1-beta
make -j &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# compilamos&lt;/span&gt;
service nginx destroy &lt;span class=&#34;c1&#34;&gt;# detenemos la instancia actual de nginx&lt;/span&gt;
make install &lt;span class=&#34;c1&#34;&gt;# instalamos la nueva versión con pagespeed&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;configurando-pagespeed&#34;&gt;Configurando PageSpeed&lt;/h4&gt;

&lt;p&gt;Solo resta configurar nginx para activar &lt;em&gt;pagespeed&lt;/em&gt; con los filtros deseados. La documentación se puede encontrar en &lt;a href=&#34;https://developers.google.com/speed/pagespeed/module/config_filters&#34; title=&#34;Configuring PageSpeed Filters&#34; target=&#34;_blank&#34;&gt;Configuring PageSpeed Filters&lt;/a&gt;. Por defecto los filtros habilitados son:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;add_head
combine_css
combine_javascript
convert_meta_tags
extend_cache
fallback_rewrite_css_urls
flatten_css_imports
inline_css
inline_import_to_link
inline_javascript
rewrite_css
rewrite_images
rewrite_javascript
rewrite_style_attributes_with_url
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Veamos cómo habilitar pagespeed en nginx, para ello crearemos un fichero y un directorio en &lt;em&gt;/usr/local/nginx/conf/global/pagespeed.conf&lt;/em&gt; conteniendo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;pagespeed on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Needs to exist and be writable by nginx.&lt;/span&gt;
pagespeed FileCachePath /var/ngx_pagespeed_cache&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Ensure requests for pagespeed optimized resources go to the pagespeed handler&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# and no extraneous headers get set.&lt;/span&gt;
location ~ &lt;span class=&#34;s2&#34;&gt;&amp;quot;\.pagespeed\.([a-z]\.)?[a-z]{2}\.[^.]{10}\.[^.]+&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      add_header &lt;span class=&#34;s2&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
location ~ &lt;span class=&#34;s2&#34;&gt;&amp;quot;^/ngx_pagespeed_static/&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
location ~ &lt;span class=&#34;s2&#34;&gt;&amp;quot;^/ngx_pagespeed_beacon&lt;/span&gt;$&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# This page shows statistics about the ngx_pagespeed module.&lt;/span&gt;
location /ngx_pagespeed_statistics &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    allow 127.0.0.1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    allow TuIP&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    deny all&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Recent log messages. Like statistics, these are generally not to be shown&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# to the public, so this has access controls as well.&lt;/span&gt;
pagespeed MessageBufferSize 100000&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
location /ngx_pagespeed_message &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    allow 127.0.0.1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#    allow TuIP;&lt;/span&gt;
    deny all&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# This page lets you view a graphical console displaying statistics about&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# the ngx_pagespeed module.  As with statistics and messages, you may&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# want access control.&lt;/span&gt;
pagespeed Statistics on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
pagespeed StatisticsLogging on&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
pagespeed LogDir /var/log/pagespeed&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
pagespeed StatisticsLoggingIntervalMs 60000&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
pagespeed StatisticsLoggingMaxFileSizeKb 1024&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
location /pagespeed_console &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    allow 127.0.0.1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#    allow TuIP;&lt;/span&gt;
    deny all&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Honoring no-transform Cache-Control Headers&lt;/span&gt;
pagespeed DisableRewriteOnNoTransform off&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
pagespeed RewriteLevel CoreFilters&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Specifying the value for the PageSpeed header&lt;/span&gt;
pagespeed XHeaderValue &lt;span class=&#34;s2&#34;&gt;&amp;quot;Gracias a ngx_pagespeed&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Esto debería ser suficiente para la mayoría de webs, es posible habilitar más filtros usando la directiva &lt;em&gt;pagespeed EnableFilters&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Por último hay que añadir la configuración a nginx, dentro del bloque &lt;em&gt;server&lt;/em&gt; que deseemos incluimos la línea &lt;em&gt;include global/pagespeed.conf;&lt;/em&gt; y recargamos la configuración de nginx:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;service nginx reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Podemos comprobar que todo funciona correctamente ojeando las cabeceras de la respuesta del servidor como se muestra en la figura:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&#34;https://elbauldelprogramador.com/img/2014/02/pagespeed.png&#34;&gt;&lt;img sizes=&#34;(min-width: 255px) 255px, 100vw&#34; on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2014/02/pagespeed.png&#34; title=&#34;Configuración pagespeed nginx&#34; alt=&#34;Configuración pagespeed nginx&#34; width=&#34;255px&#34; height=&#34;135px&#34; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;Como vemos, la cabecera de pagespeed está presente, luego está habilitado.&lt;/p&gt;

&lt;h2 id=&#34;apc&#34;&gt;APC&lt;/h2&gt;

&lt;p&gt;APC viene de Alternative PHP Cache y es un opcode libre y gratuito para PHP. Su objetivo es proporcionar un marco robusto, libre y abierto para optimizar código intermedio de PHP mediante su almacenamiento en caché.&lt;/p&gt;

&lt;h3 id=&#34;instalando-y-configurando-apc&#34;&gt;Instalando y configurando APC&lt;/h3&gt;

&lt;p&gt;Para instalarlo basta con ejecutar:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;apt-get install php-apc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;El archivo de configuración reside en &lt;em&gt;/etc/php5/fpm/conf.d/apc.ini&lt;/em&gt;, un ejemplo de configuración es el siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;apc.enabled&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1
apc.shm_segments&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1
apc.shm_size&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;128M
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;Relative to the number of cached files &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;you may need to watch your stats &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; a day or two to find out a good number&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
apc.num_files_hint&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;768

&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;Relative to the size of your site
apc.user_entries_hint&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;4096

&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;The number of seconds a cache entry is allowed to idle in a slot before APC dumps the cache
apc.ttl&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;7200
apc.user_ttl&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;7200
apc.gc_ttl&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;3600

&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;Setting this to &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; will give you the best performance, as APC will
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;not have to check the IO &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; changes. However, you must clear
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;the APC cache to recompile already cached files. If you are still
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;developing, updating your site daily in WP-ADMIN, and running W3TC
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; this to 1
apc.stat&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0

&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;This MUST be 0, WP can have errors otherwise!
apc.include_once_override&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0

&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;Only &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; to &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; debugging
apc.enable_cli&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0

&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;Allow &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; seconds after a file is created before it is cached to prevent users from seeing half-written/weird pages
apc.file_update_protection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2

&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;Leave at 2M or lower. WordPress doest have any file sizes close to 2M
apc.max_file_size&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1M

apc.cache_by_default&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1
apc.use_request_time&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1
apc.slam_defense&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0
apc.mmap_file_mask&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/tmp/apc.XXXXXX
apc.stat_ctime&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0
apc.canonicalize&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1
apc.write_lock&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1
apc.report_autofilter&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0
apc.rfc1867&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0
apc.rfc1867_prefix &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;upload_
apc.rfc1867_name&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;APC_UPLOAD_PROGRESS
apc.rfc1867_freq&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0
apc.rfc1867_ttl&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;3600
apc.lazy_classes&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0
apc.lazy_functions&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0

apc.localcache &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;The size of the &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; process shadow-cache, should be &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; to a sufficiently large value, approximately half of apc.num_files_hint.
apc.localcache.size &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;384&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&#34;https://elbauldelprogramador.com/solucionar-fallo-de-segmentacion-en-php-cuando-se-usa-apc/&#34; title=&#34;Solucionar fallo de segmentación en PHP cuando se usa APC&#34;&gt;APC&lt;/a&gt; proporciona una mejora considerable en cuanto al rendimiento, ya que no es necesario volver a interpretar el código PHP cada vez que el servidor recibe una petición, el código quedará compilado en cache listo para ser servido. Uno de los parámetros más importantes es &lt;em&gt;apc.shm_size=&lt;/em&gt;, el cual establece el tamaño reservado para la caché.&lt;/p&gt;

&lt;h2 id=&#34;consideraciones-sobre-seguridad&#34;&gt;Consideraciones sobre seguridad&lt;/h2&gt;

&lt;p&gt;Algunos valores por defecto de la configuración de nginx no son adecuados en términos de seguridad, basándonos en las recomendaciones de &lt;a href=&#34;http://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html&#34; title=&#34;Top 20 Nginx WebServer Best Security Practices&#34; target=&#34;_blank&#34;&gt;NIX Craft&lt;/a&gt; podemos ajustar éstos parámetros según nuestras necesidades para obtener una mayor seguridad frente a ataques. Todos estos parámetros irán en el bloque &lt;em&gt;http&lt;/em&gt; de nginx.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Start: Size Limits &amp;amp; Buffer Overflows ##&lt;/span&gt;
      client_body_buffer_size  8K&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      client_header_buffer_size 1k&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      client_max_body_size 1m&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      large_client_header_buffers &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; 1k&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;## END: Size Limits &amp;amp; Buffer Overflows ##&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;## Start: Timeouts ##&lt;/span&gt;
      client_body_timeout   10&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      client_header_timeout 10&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      keepalive_timeout     &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; 5&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      send_timeout          10&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;## End: Timeouts ##&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;### Directive describes the zone, in which the session states are stored i.e. store in slimits. ###&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;### 1m can handle 32000 sessions with 32 bytes/session, set to 5m x 32000 session ###&lt;/span&gt;
      limit_conn_zone &lt;span class=&#34;nv&#34;&gt;$b&lt;/span&gt;inary_remote_addr &lt;span class=&#34;nv&#34;&gt;zone&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;addr:5m&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;### Control maximum number of simultaneous connections for one session i.e. ###&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;### restricts the amount of connections from a single ip address ###&lt;/span&gt;
      limit_conn addr 10&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Una breve explicación del propósito de cada directiva:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;client_body_buffer_size&lt;/strong&gt;: El tamaño máximo del buffer de petición del cliente.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client_header_buffer_size&lt;/strong&gt;: Normalmente el tamaño de las cabeceras de la mayoría de peticiones son inferiores a 1k, si hay problemas deberemos subir el valor.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client_max_body_size&lt;/strong&gt;: Si vamos a aceptar que se suban archivos a nuestra web, este valor debería ser dado en Megas, de lo contrario podremos establecer un valor bajo, como 1k.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;large_client_header_buffers&lt;/strong&gt;: Número máximo y tamaño de los buffers para peticiones que tengan cabeceras de mayor tamaño enviadas por el cliente. Útil para combatir bad bots y ataques DoS.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client_body_timeout&lt;/strong&gt;: Establece el tiempo de espera para leer el cuerpo de la petición del cliente. Si tras pasar el tiempo el cliente no envía nada, nginx devolverá un error 408 (Request timeout).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;client_header_timeout&lt;/strong&gt;: Similar al anterior pero para la cabecera.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;keepalive_timeout&lt;/strong&gt;: El primer parámetro asigna el tiempo de espera para mantener la conexión activa con el cliente, el servidor cerrará la conxión tras pasar éste tiempo. El segundo parámetro establece el valor de la cabecera &lt;em&gt;Keep-Alive:timeout=time&lt;/em&gt; en la respuesta del servidor, esta cabecera puede hacer que algunos navegadore cierren la conexión para que no sea el servidor el que tenga que hacerlo.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;send_timeout&lt;/strong&gt;: Asigna el tiempo de espera al cliente.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;limit_conn_zone&lt;/strong&gt;: Controla el número de conexiones simultaneas de un mismo cliente.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Con esto concluyen los tres artículos sobre instalación y optimización de un servidor web con nginx, espero que haya resultado útil.&lt;/p&gt;

&lt;h1 id=&#34;tabla-de-contenidos-1&#34;&gt;Tabla de contenidos&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-i&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (I)&#34;&gt;Instalación y optimización de un servidor web con Nginx (I)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/instalacion-optimizacion-servidor-web-nginx-ii&#34; title=&#34;Instalación y optimización de un servidor web con Nginx (II)&#34;&gt;Instalación y optimización de un servidor web con Nginx (II)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Instalación y optimización de un servidor web con Nginx (III)&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Recibir alertas de correo al acceder al  sistema mediante SSH</title>
            <link>https://elbauldelprogramador.com/recibir-alertas-de-correo-ssh/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/recibir-alertas-de-correo-ssh/</guid>
            <description>&lt;p&gt;Hemos visto en otros artículos varias maneras de mejorar la seguridad en un servidor, medidas tales como:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/combatir-los-comentarios-de-spam-en-wordpress/&#34; title=&#34;Combatir los comentarios de spam en WordPress&#34;&gt;Combatir los comentarios de Spam en WordPress&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/bloquear-ataques-de-fuerza-bruta-en-nginx-y-wordpress-con-fail2ban/&#34; title=&#34;Bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban&#34;&gt;Bloquear ataques de fuerza bruta en nginx y WordPress con Fail2Ban&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://elbauldelprogramador.com/bloquear-una-ip-atacanto-el-servidor-mediante-iptables/&#34; title=&#34;Bloquear una IP atacando el servidor mediante iptables&#34;&gt;Bloquear una IP atacando el servidor mediante IPtables&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hoy veremos cómo recibir alertas de correo SSH cada vez que un usuario logre acceder al sistema mediante este protocolo. El artículo original es de &lt;a href=&#34;http://www.tecmint.com&#34; title=&#34;TecMint&#34; target=&#34;_blank&#34;&gt;tecmint&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;En linux, cada vez que un usuario accede al sistema, el archivo &lt;em&gt;.bashrc&lt;/em&gt; se ejecuta. De modo que si añadimos a dicho archivo una sentencia que nos envíe un correo, lograremos monitorizar los accesos al sistema. Antes hay que instalar un cliente de correo, aunque al ser un servidor, es probable que ya exista uno instalado.&lt;/p&gt;

&lt;h1 id=&#34;instalar-mailx&#34;&gt;Instalar MailX&lt;/h1&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;apt-get install mailx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;modificar-el-archivo-bashrc&#34;&gt;Modificar el archivo .bashrc&lt;/h1&gt;

&lt;p&gt;Para cada usuario del que deseemos recibir alertas, habrá que añadir la siguiente línea a su &lt;em&gt;bashrc&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;ALERTA - Acceso a la Shell (ServerName) el:&amp;#39;&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;date&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;who&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; mail -s &lt;span class=&#34;s2&#34;&gt;&amp;quot;Alerta: Acceso shell de `who | cut -d&amp;#39;(&amp;#39; -f2 | cut -d&amp;#39;)&amp;#39; -f1`&amp;quot;&lt;/span&gt; correo@electrónico.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Listo, ahora recibiremos un correo por cada acceso al sistema.&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;How to Get Root and User SSH Login Email Alerts&lt;/em&gt; »» &lt;a href=&#34;http://www.tecmint.com/get-root-ssh-login-email-alerts-in-linux&#34; target=&#34;_blank&#34;&gt;tecmint.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Solucionar fallo de segmentación en PHP cuando se usa APC</title>
            <link>https://elbauldelprogramador.com/solucionar-fallo-de-segmentacion-en-php-cuando-se-usa-apc/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/solucionar-fallo-de-segmentacion-en-php-cuando-se-usa-apc/</guid>
            <description>&lt;p&gt;Hace algún tiempo, el blog se caía de forma aleatoria y dejaba de funcionar. Tras investigar un poco descubrí que era PHP el que estaba causando el problema. En concreto ocurría un fallo de segmentación en PHP que no conseguía averiguar de dónde procedían. Buscando y buscando al final dí con el problema, en realidad lo que provocaba el problema no era PHP, si no una consecuencia de usar APC y el parámetro &lt;code&gt;apc.shm_size&lt;/code&gt; junto con el parámetro del kernel &lt;code&gt;kernel.shmmax&lt;/code&gt;. El propósito de este artículo es dejar constancia de cómo se solucionó el problema por si alguien se encontrara en la misma situación.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h3 id=&#34;para-qué-sirve-el-parámetro-proc-sys-kernel-shmmax&#34;&gt;Para qué sirve el parámetro /proc/sys/kernel/shmmax&lt;/h3&gt;

&lt;p&gt;Según la documentación del kernel:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;shmmax:&lt;/p&gt;

&lt;p&gt;This value can be used to query and set the run time limit
on the maximum shared memory segment size that can be created.
Shared memory segments up to 1Gb are now supported in the
kernel. This value defaults to SHMMAX.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Traducido:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;shmmax:&lt;/p&gt;

&lt;p&gt;Este valor puede usarse para consultar y establecer el límite máximo del segmento de memoria compartida que puede crearse. Se soportan segmentos de memoria compartida de hasta 1Gb. Su valor por defecto está definido por la constante SHMMAX.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;para-qué-sirve-el-parámetro-apc-shm-size&#34;&gt;Para qué sirve el parámetro apc.shm_size&lt;/h3&gt;

&lt;p&gt;Según la documentación de APC:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;El tamaño de cada segmento de memoria compartida en MB. Por defecto, algunos sistemas (incluidos la mayoría de variantes de BSD) tienen límites muy bajos del tamaño de un segmento de memoria compartida.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Sabiendo para qué sirve cada parámetro, en un foro encontré la respuesta a la solución:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;From my Linux experience, this bug is caused only by one thing:&lt;/p&gt;

&lt;p&gt;Wrongly set SHM size in kernel and/or APC settings. With standard apc.shm_size = 30, i get segfault (11) every time i try to spawn php-cgi processes. But once i do the following:&lt;/p&gt;

&lt;p&gt;echo &amp;#8220;512000000&amp;#8221; &amp;gt; /proc/sys/kernel/shmmax
set apc.shm_size = 64M&lt;/p&gt;

&lt;p&gt;Then the problem completely disappears. PHP with APC becomes ROCK-solid, and NEVER segfaults running &lt;sup&gt;24&lt;/sup&gt;&amp;frasl;&lt;sub&gt;7&lt;/sub&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Por tanto, incrementando el valor del parámetro &lt;code&gt;/proc/sys/kernel/shmmax&lt;/code&gt; a un valor igual o mayor que el del parámetro &lt;code&gt;apc.shm_size&lt;/code&gt; de APC soluciona el problema. Desde que apliqué este cambio no he vuelto a tener caídas en los procesos de PHP.&lt;/p&gt;

&lt;h3 id=&#34;algunas-notas-a-tener-en-cuenta&#34;&gt;Algunas notas a tener en cuenta&lt;/h3&gt;

&lt;p&gt;El parámetro del kernel se puede cambiar de varias formas, tal y como mencionaba el usuario del foro se cambia únicamente durante la sesión activa del Sistema Operativo, tras reiniciar el servidor se establecerá su valor por defecto (30Mb). Para hacer los cambios permanentes, debemos escribir el valor del parámetro en el fichero &lt;em&gt;/etc/sysctl.conf&lt;/em&gt; o en &lt;em&gt;/etc/sysctl.d/99-sysctl.conf&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Por ejemplo, para establecer el valor a 256 Mb escribiríamos al final de uno de estos archivos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;kernel.shmmax&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;268435456
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Y luego cargamos el fichero para aplicar los cambios:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;sysctl -p
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Para comprobar que se actualizó el valor:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;cat /proc/sys/kernel/shmmax
268435456
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;referencias&#34;&gt;Referencias&lt;/h4&gt;

&lt;p&gt;&lt;em&gt;Créditos de la imagen&lt;/em&gt; »» &lt;a href=&#34;http://icons8.com/&#34; target=&#34;_blank&#34;&gt;icons8&lt;/a&gt;
&lt;em&gt;APC causes PHP fast-cgi to segfault&lt;/em&gt; »» &lt;a href=&#34;https://bugs.php.net/bug.php?id=56894&#34; target=&#34;_blank&#34;&gt;bugs.php.net&lt;/a&gt;
&lt;em&gt;Documentación Sysctl&lt;/em&gt; »» &lt;a href=&#34;https://www.kernel.org/doc/Documentation/sysctl/kernel.txt&#34; target=&#34;_blank&#34;&gt;kernel.org&lt;/a&gt;&lt;/p&gt;</description>
        </item>
        
        <item>
            <title>Visualiza las visitas a tu web al estilo Pong con Logstalgia</title>
            <link>https://elbauldelprogramador.com/visualiza-las-visitas-a-tu-web-al-estilo-pong-con-logstalgia/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/visualiza-las-visitas-a-tu-web-al-estilo-pong-con-logstalgia/</guid>
            <description>&lt;p&gt;Hace poco he descubierto un programa muy curioso, &lt;strong&gt;Logstalgia&lt;/strong&gt;, que a partir del fichero de log de acceso a una web crea una pantalla del juego Pong en la que cada línea del log representa una bola en el juego. Es una buena representación gráfica de lo que está pasando en el servidor web. Y su uso es bastante simple. Empecemos instalándolo:&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# aptitude install logstalgia&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Para usarlo localmente, basta con ejecutar el siguiente comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;tail -f /var/www/mySitio/log/access.log &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; logstalgia -1280x720 --sync
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Por contra, si el servidor no es local, nos conectamos mediante ssh:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;ssh usuario@dominio.com tail -f /var/www/mySitio/log/access.log &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; logstalgia -1280x720 --sync
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Es posible guardar el un fichero la pantalla de logstalgia pasándole los siguientes parámetros:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;logstalgia -1280x720 --output-ppm-stream output.ppm --sync
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Y luego lo convertimos al formato de vídeo mp4:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;ffmpeg -y -r &lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; -f image2pipe -vcodec ppm -i output.ppm -vcodec libx264 -preset ultrafast -pix_fmt yuv420p -crf &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -threads &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; -bf &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; server.log.mp4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Os dejo un vídeo del tráfico de mi modesto blog:&lt;/p&gt;

&lt;p&gt;&lt;amp-youtube
    data-videoid=&#34;5pzMBg_vvo8&#34;
    layout=&#34;responsive&#34;
    width=&#34;480&#34; height=&#34;270&#34;&gt;&lt;/amp-youtube&gt;&lt;/p&gt;

&lt;h4 id=&#34;referencias&#34;&gt;Referencias&lt;/h4&gt;

&lt;p&gt;&lt;em&gt;Web oficial&lt;/em&gt; »» &lt;a href=&#34;https://code.google.com/p/logstalgia/&#34; target=&#34;_blank&#34;&gt;Visitar sitio&lt;/a&gt;&lt;/p&gt;</description>
        </item>
        
    </channel>
</rss>
