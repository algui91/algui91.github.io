<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Iptables on El Baúl del programador</title>
        <link>https://elbauldelprogramador.com/tags/iptables/</link>
        <description>Recent content in Iptables on El Baúl del programador</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>es-ES</language>
        <lastBuildDate>Fri, 08 Sep 2017 12:10:24 +0100</lastBuildDate>
        <image>
            <url>https://elbauldelprogramador.com/img/bio-photo-rss.png</url>
            <link>https://elbauldelprogramador.com/tags/iptables/</link>
            <title>Iptables on El Baúl del programador</title>
            <width>144</width>
            <height>144</height>
        </image>
        <atom:link href="https://elbauldelprogramador.com/tags/iptables/" rel="self" type="application/rss+xml" />
        
        <item>
            <title>SelfControl, aparta las distracciones de tu pc cuando estás trabajando</title>
            <link>https://elbauldelprogramador.com/selfcontrol-aparta-las-distracciones-de-tu-pc-cuando-estas-trabajando/</link>
            <pubDate>Fri, 08 Sep 2017 12:10:24 +0100</pubDate>
            
            <guid>https://elbauldelprogramador.com/selfcontrol-aparta-las-distracciones-de-tu-pc-cuando-estas-trabajando/</guid>
            <description>&lt;figure&gt;
    &lt;img sizes=&#34;(min-width: 192px) 192px, 100vw&#34; on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; title=&#34;selfcontrol&#34; src=&#34;https://elbauldelprogramador.com/img/2012/08/selfcontrol11.png&#34; alt=&#34;&#34; width=&#34;192px&#34; height=&#34;192px&#34; /&gt;
&lt;/figure&gt;

&lt;p&gt;Es fácil distraerse cuando estás sentado enfrente de un ordenador, sobre todo cuando se tienen pocas ganas de trabajar. Leyendo mi RSS encontré una aplicación que puede llegar a ser muy útil si te distras fácilmente; SelfControl.&lt;/p&gt;

&lt;p&gt;Esta aplicación bloquea las páginas de internet durante el tiempo que digamos, es bastante fácil de usar y configurar.&lt;/p&gt;

&lt;p&gt;Antes de instalarlo es necesario resolver las dependencias del paquete instalando lo siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;sudo aptitude install libgtk2-perl libyaml-perl&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Tras instalarlos, bajamos el e instalamos SelfControl:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;wget http://svn.jklmnop.net/projects/SelfControl/selfcontrol_0.9-1_all.deb
sudo dpkg --install selfcontrol_0.9-1_all.deb&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ahora que está todo listo ejecutamos SelfControl desde la línea de comandos y nos aparecerá esta ventanita:&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;figure&gt;
    &lt;img sizes=&#34;(min-width: 415px) 415px, 100vw&#34; on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; title=&#34;Selfcontro1&#34; src=&#34;https://elbauldelprogramador.com/img/2012/08/Selfcontro11.png&#34; alt=&#34;&#34; width=&#34;415px&#34; height=&#34;378px&#34; /&gt;
&lt;/figure&gt;

&lt;p&gt;Donde aparecen las webs bloqueadas, una entrada de texto para añadir las páginas a bloquear y por cuanto tiempo.&lt;/p&gt;

&lt;p&gt;Antes de configurarlo, hay que asegurarse de que todo esté correcto, abrimos una terminal para ver el estado de &lt;a title=&#34;20 ejemplos de iptables para SysAdmins novatos&#34; href=&#34;//20-ejemplos-de-iptables-para-sysadmins/&#34; target=&#34;_blank&#34;&gt;iptables&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ sudo iptables --list
Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination

  Chain FORWARD &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination

  Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Si no sale algo parecido quizá no tengas instalado iptables, aunque la mayoría de las distribuciones lo traen por defecto.&lt;/p&gt;

&lt;p&gt;Una vez que ejecutemos el programa aparecerá algo así:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ sudo iptables --list
Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination

  Chain FORWARD &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination

  Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
  SelfControl  all  --  anywhere             anywhere

  Chain SelfControl &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
  DROP       all  --  anywhere             www.example.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Sítio Oficial | &lt;a href=&#34;http://svn.jklmnop.net/projects/SelfControl.html&#34; target=&#34;_blank&#34;&gt;SelfControl &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fuente | &lt;a href=&#34;http://www.datamation.com/open-source/15-must-have-linux-applications-1.html&#34; target=&#34;_blank&#34;&gt;15 Must Have Linux Applications&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Introducción Y Ejemplos De NfTables</title>
            <link>https://elbauldelprogramador.com/ejemplos-nftables/</link>
            <pubDate>Tue, 29 Mar 2016 06:02:46 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/ejemplos-nftables/</guid>
            <description>&lt;blockquote&gt;
&lt;p&gt;El siguiente artículo forma parte de un trabajo en grupo realizado para la asignatura &lt;em&gt;Seguridad en Sistemas Operativos&lt;/em&gt; de la facultad de Ingeniería Informática de Granada (ETSIIT), puedes leer el otro trabajo publicado en el blog, &lt;a href=&#34;https://elbauldelprogramador.com/biometria-seguridad-introduccion/&#34; title=&#34;Biometría Aplicada a La Seguridad&#34;&gt;Biometría Aplicada a La Seguridad&lt;/a&gt;. Este trabajo es autoría de Jose Maria Caballero Alba &lt;code&gt;&amp;lt;caballeroalba&amp;gt;&lt;/code&gt; y Edlin Lastenia Morel Mateo&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;qué-es-nftables&#34;&gt;Qué es nftables&lt;/h1&gt;

&lt;p&gt;&lt;a href=&#34;http://netfilter.org/projects/nftables/&#34; target=&#34;_blank&#34; title=&#34;&#34;&gt;&lt;strong&gt;nftables&lt;/strong&gt;&lt;/a&gt; es un  nuevo  framework  que  sustituye  al antiguo  &lt;strong&gt;iptables&lt;/strong&gt;. Este  nuevo  software aún  no está  desarrollado  al 100% de sus funciones, tenemos  la problemática de la implantación,   que aunque  se incluye desde el kernel  3.13, las personas  aún  no están acostumbradas a su uso y por tanto  siguen usando  &lt;strong&gt;iptables&lt;/strong&gt;  o en su defecto la nomenclatura  de sus reglas.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Quizá te interese el artículo &lt;a href=&#34;https://elbauldelprogramador.com/20-ejemplos-de-iptables-para-sysadmins/&#34; title=&#34;20 ejemplos de iptables para SysAdmins novatos&#34;&gt;20 ejemplos de &lt;strong&gt;iptables&lt;/strong&gt; para SysAdmins novatos,&lt;/a&gt; u otro de los múltiples artículos sobre &lt;a href=&#34;https://elbauldelprogramador.com/tag/#iptables&#34; title=&#34;Artículos etiquetados con iptables&#34;&gt;iptables disponibles&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;p&gt;En pocas palabras:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Disponible desde el kernel 3.13 en adelante.&lt;/li&gt;
&lt;li&gt;Trae una la nueva utilidad  &lt;code&gt;nft&lt;/code&gt; con una sintaxis diferente a la de &lt;strong&gt;iptables&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Tiene compatibilidad  con las instrucciones de &lt;strong&gt;iptables&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Infraestructura genérica  de conjuntos  que permite  construir  mapas  entre  asignaciones y acciones para  mejorar las búsquedas.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Aún está bajo desarrollo.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Las diferencias con &lt;strong&gt;iptables&lt;/strong&gt;  son notables,  estas  son algunas diferencias proporcionadas  por su página oficial:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Máquina  de pseudo-estados  en el espacio del kernel,  &lt;strong&gt;nftables&lt;/strong&gt;  interpreta el mapa  de reglas proporcionadas  por el usuario  (con la nueva  sintaxis)  , esta se compila y entra  en la máquina  de estados como bytecode y esta misma la transfiere al kernel por la api Netlink’s de netflter.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Reduce el total  del código en el espacio del kernel.  Se puede elegir que selectores  de paquetes  de todos los protocolos existentes  puede usar  la máquina de pseudo-estados,  esto significa que no necesitamos  una  extensión  en espacio  de kernel  para  cada  protocolo  si queremos  soportarlo.    Esto  supone una ventaja,  ya que no necesitamos actualizar  el kernel para  obtener  nuevas características y esto ha sido diseñado para  trabajar en el espacio lógico de usuario.&lt;/p&gt;

&lt;p&gt;Interfaz unificada para reemplazar las utilidades &lt;strong&gt;iptables/ip6tables/arptables/ebtables&lt;/strong&gt;.&lt;/p&gt;

&lt;h1 id=&#34;introducción-a-nftables&#34;&gt;Introducción a nftables&lt;/h1&gt;

&lt;p&gt;Como ya dijimos en la descripción del problema,  &lt;strong&gt;nftables&lt;/strong&gt;  es un nuevo framework que sustituye  al antiguo &lt;strong&gt;iptables&lt;/strong&gt; para el filtrado de paquetes y clasificación de estos en Linux. &lt;strong&gt;nftables&lt;/strong&gt; es una combinación del núcleo de Linux y una utilidad  de espacio de usuario (lo que sería la antigua &lt;strong&gt;iptables&lt;/strong&gt;, &lt;code&gt;nft&lt;/code&gt;).  Usa la infraestructura de Netfilter, como el connection tracking  system.&lt;/p&gt;

&lt;h2 id=&#34;requisitos-de-nftables&#34;&gt;Requisitos de nftables&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;nftables&lt;/strong&gt;  está operativo  desde el kernel 3.13, para  poder usarlo necesitamos  compilar este kernel o un kernel superior.  Además de la utilidad  nft para poder usar el framework la cual necesita las librerías libmnl (normalmente en los repositorios) y libnftnl.&lt;/p&gt;

&lt;p&gt;Necesitamos instalar un kernel superior al 3.13, en este caso vamos a usar el ultimo kernel estables de kernel.org, siendo este a la fecha actual  el 3.16.5.&lt;/p&gt;

&lt;p&gt;Por lo tanto,  para  la instalación debemos de hacer lo siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;tar -xvJf linux-3.16.tar.xz
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; linux-3.16
make menuconfig
sudo make modules_install
sudo update−grub2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Una vez hecho esto, reiniciamos y ya tendríamos el kernel disponible en la selección de inicio de grub,  para  comprobar  que esta  todo  correcto,  basta  con abrir  un terminal  y poner &lt;code&gt;iuname -r&lt;/code&gt;  debería de salir que tenemos un kernel 3.16.3&lt;/p&gt;

&lt;h2 id=&#34;instalación-de-la-utilidad-nft&#34;&gt;Instalación  de  la  utilidad nft&lt;/h2&gt;

&lt;p&gt;Para  esto instalaremos  las 2 librerías necesarias (libmnl y libnfnl), para ambas necesitamos hacer:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;git clone git://git.netflter.org/lib&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mnl o fnl&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; libnftnl
sh autogen.sh
./confgure
make
sudo make install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ahora ya podemos instalar  la utilidad  nft:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;git clone git://git.netflter.org/__nftables__
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; __nftables__
sh autogen.sh
./configure
make
make install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Y para  comprobar  su correcto funcionamiento  tecleamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;sudo nft&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Al cual debe responder &lt;code&gt;nft:  no command specified&lt;/code&gt;. Confirmando su correcta  instalación.&lt;/p&gt;

&lt;h1 id=&#34;iptables-vs-nftables&#34;&gt;&lt;strong&gt;iptables&lt;/strong&gt; vs  &lt;strong&gt;nftables&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;Es interesante comparar  el uso de &lt;strong&gt;iptables&lt;/strong&gt;  de manera  práctica  y compararlo  con lo que sería la traducción a &lt;strong&gt;nftables&lt;/strong&gt;,  tenemos  que tener  en cuenta  que algunas  opciones de &lt;strong&gt;iptables&lt;/strong&gt;  no están disponibles en &lt;strong&gt;nftables&lt;/strong&gt; por estar aún en desarrollo y viceversa.&lt;/p&gt;

&lt;h2 id=&#34;diferencias-principales-entre-nftables-y-iptables&#34;&gt;Diferencias principales entre nftables y iptables&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;La primera  y más distinguible  es la sintaxis,  en &lt;strong&gt;iptables&lt;/strong&gt;,  las flags van precedidas de dos guiones o uno (-p tcp)  en &lt;strong&gt;nftables&lt;/strong&gt; usa una sintaxis más limpia, inspirada  en tcpdump.&lt;/li&gt;
&lt;li&gt;Las tablas y las cadenas son totalmente configurables en &lt;strong&gt;nftables&lt;/strong&gt;, contrariamente a &lt;strong&gt;iptables&lt;/strong&gt;, que solo ofrece un set definido de tablas  y cadenas, &lt;strong&gt;nftables&lt;/strong&gt; permite  crear  cadenas  y tablas  propias  con sus correspondientes  configuraciones en función de lo que necesites.&lt;/li&gt;
&lt;li&gt;No hay distinción entre objetivos y targets,  en &lt;strong&gt;nftables&lt;/strong&gt; tenemos expresiones que son instrucciones  para  construir  nuestras  reglas.  Esto  es muy diferente en &lt;strong&gt;iptables&lt;/strong&gt;  que requiere sintaxis de objetivos y targets  para  usar protocolos.&lt;/li&gt;
&lt;li&gt;Se pueden especificar varias acciones en una sola línea en &lt;strong&gt;nftables&lt;/strong&gt;, con &lt;strong&gt;iptables&lt;/strong&gt; solo podemos especificar una.&lt;/li&gt;
&lt;li&gt;Los contadores  en &lt;strong&gt;iptables&lt;/strong&gt;  son establecidos de manera  fija para cada tabla  y reglas, en &lt;strong&gt;nftables&lt;/strong&gt; se puede establecer de manera opciones estos contadores.&lt;/li&gt;
&lt;li&gt;Infraestructura de manera  genérica en lo sets en &lt;strong&gt;nftables&lt;/strong&gt;,  esto permite  configuraciones avanzadas  como diccionarios, mapas.&lt;/li&gt;
&lt;li&gt;Actualizar  el kernel es una tarea que consume mucho tiempo, especial- mente si quieres mantener  más de un firewall en tu red.  Los distribuidores  normalmente usan versiones antiguas  del kernel de Linux por razones de estabilidad. Con la nueva máquina de estados de &lt;strong&gt;nftables&lt;/strong&gt; no es necesario actualizar  el kernel para  un nuevo protocolo, simplemente  es necesario actualizar  la utilidad nft.&lt;/li&gt;
&lt;li&gt;No es necesario el uso de guiones (-) o dobles guiones (-) para  el uso delas banderas&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;tablas-cadenas-y-reglas-en-nftables&#34;&gt;Tablas cadenas y reglas en nftables&lt;/h1&gt;

&lt;h2 id=&#34;creando-tablas-con-nftables&#34;&gt;Creando tablas con nftables&lt;/h2&gt;

&lt;p&gt;En &lt;strong&gt;nftables&lt;/strong&gt; seguimos contando  con las mismas tablas  que en &lt;strong&gt;iptables&lt;/strong&gt;,  que siguen siendo las zonas en las que podemos crear cadenas y después crear reglas en ellas. La diferencia principal y más notable respecto a &lt;strong&gt;iptables&lt;/strong&gt; que podemos crear nuestras  tablas  y además no nos obliga a configurar una cadena  a la hora de crearla.  Para  configurar una tabla en &lt;strong&gt;nftables&lt;/strong&gt; tenemos el siguiente formato:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft create table &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ip&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; nombre tabla&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Como vemos tenemos un formato más sencillo que además podemos crear la tabla  solamente sin configurar nada y decidir si pertenece (o no) a la familia ip. Un ejemplo muy sencillo de crear una tabla:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft create table filter&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Esto creará la tabla de tipo ip (por defecto, si no lo hemos especificado) filter, la cual no contiene cadenas ni reglas. Solo contiene la definición de la tabla en sí misma.&lt;/p&gt;

&lt;h2 id=&#34;borrando-tablas-en-nftables&#34;&gt;Borrando tablas en nftables&lt;/h2&gt;

&lt;p&gt;En &lt;strong&gt;nftables&lt;/strong&gt;  sí que se nos permite  borrar  una tabla,  con esto borraríamos la tabla,  sus cadenas y sus reglas. El formato a usar seria el siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft delete table nombretabla&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Y no es necesario nada  más, con esto podemos borrar  una tabla  en &lt;strong&gt;nftables&lt;/strong&gt;,  cosa que con &lt;strong&gt;iptables&lt;/strong&gt;  no podíamos.&lt;/p&gt;

&lt;h2 id=&#34;creando-cadenas-en-nftables&#34;&gt;Creando cadenas en nftables&lt;/h2&gt;

&lt;p&gt;En  &lt;strong&gt;nftables&lt;/strong&gt;  no tenemos  cadenas  por defecto dentro  de nuestras  tablas,  pero tenemos la posibilidad  de an˜adir las cadena  de tipo  base (input,  output, forward,  postrouting, prerouting) o crear cadenas personalizadas,  con el siguiente formato  seria para  las tipo base:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add chain ip nombreTabla nombreCadena typefilter hook &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;cadenabase&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; priority &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Y un ejemplo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add chain ip filter postrouting   &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; filter hook postrouting  priority  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Esto no crearía la cadena de tipo base postrouting  dentro  de la tabla  filter, si queremos tener cadenas personalizadas,  simplemente hacemos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add chain nombre tabla  nombre cadena&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ejemplo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add chain filter input&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;borrando-tablas-en-nftables-1&#34;&gt;Borrando tablas en nftables&lt;/h2&gt;

&lt;p&gt;En  &lt;strong&gt;nftables&lt;/strong&gt;  por  el contrario  podemos  borrar  tanto  cadenas  base  como no base,  solo necesitamos el nombre de la cadena, no nos importa  si es de un tipo u otro, tenemos el siguiente formato:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft delete chain nombreTabla nombreCadena&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ejemplo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft delete chain flter output&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;El único requisito que nos impone &lt;strong&gt;nftables&lt;/strong&gt; para poder borrar una cadena es que no esté vacía.&lt;/p&gt;

&lt;h2 id=&#34;creando-reglas-en-nftables&#34;&gt;Creando reglas en nftables&lt;/h2&gt;

&lt;p&gt;En &lt;strong&gt;nftables&lt;/strong&gt;  podemos ver a la hora de an˜adir  reglas que es mucho más comprensible para  el usuario.  El formato para  añadir una regla es:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule nombreTabla nombreCadena tcp upd ip daddr saddr dport sport drop accept reject counter&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Los parámetros están simplificados, solo están algunos de los más usuales, se ver todas las opciones posibles en man  nft  Si quisiéramos usar  el ejemplo anterior  de &lt;strong&gt;iptables&lt;/strong&gt;, bastaría con esto:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule flter input  tcp dport  &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt; drop.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Podemos  apreciar  que &lt;strong&gt;nftables&lt;/strong&gt;  ofrece una  interfaz  más clara  en la creación de reglas respecto de &lt;strong&gt;iptables&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&#34;borrando-reglas-en-nftables&#34;&gt;Borrando reglas en nftables&lt;/h2&gt;

&lt;p&gt;Para  eliminar  una  regla  en &lt;strong&gt;nftables&lt;/strong&gt;  lo podemos  hacer  de manera  similar  a  como lo hacemos en &lt;strong&gt;iptables&lt;/strong&gt;,  listando  las reglas de una  tabla  especifica (en nuestro  caso filter) con el parámetro -a para  que nos muestre  el número de las reglas dentro  de la tabla.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft list &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;table — tables&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;nombreTabla − a&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Ejemplo
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;nft list table filter -a&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;De esta manera,  identificamos la regla que queremos eliminar mediante  su handle, para ejecutar  a continuación  la orden de eliminación con el siguiente formato:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft delete rule nombreTabla nombreCadena handle númerodeRegla
&lt;span class=&#34;c1&#34;&gt;# Ejemplo
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;nft delete rule flter input  handle &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;acciones-sobre-los-paquetes&#34;&gt;Acciones sobre los  paquetes&lt;/h1&gt;

&lt;h2 id=&#34;aceptando-y-rechazando-paquetes-en-nftables&#34;&gt;Aceptando y rechazando paquetes en nftables&lt;/h2&gt;

&lt;p&gt;Suponiendo  que ya tengamos  (como lo visto en los ejemplos anteriores)  una  cadena  y una tabla,  para  aceptar  los paquetes  de una cadena especifica podemos hacer:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule nombreTabla nombreCadena &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;operadores&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; accept&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Y un ejemplo especifico, por ejemplo aceptar  el uso de ftp (hacia nuestro  host):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule filter input  tcp dport  &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt; accept&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para  rechazar  paquetes  haríamos  exactamente   lo mismo pero  cambiando  accept  por drop:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule nombreTabla nombreCadena &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;operadores&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; drop&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;saltando-a-cadenas&#34;&gt;Saltando a cadenas&lt;/h2&gt;

&lt;p&gt;De manera  similar a &lt;strong&gt;iptables&lt;/strong&gt;,  también podemos tener  cadenas personalizadas,  una vez tengamos creado alguna, podemos redirigir los paquetes  que venga por una cadena base (por ej input)  a esta cadena para  tratarlos ahí&amp;hellip;  El formato a seguir es el siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule nombreTabla nombreCadena&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;operadores&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; jump cadenaPersonalizada
&lt;span class=&#34;c1&#34;&gt;# Ejemplo
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;nft add rule filter input  tcp dport  &lt;span class=&#34;m&#34;&gt;9999&lt;/span&gt; jump pruebaCadenaPersonal&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;log-de-paquetes-en-nftales&#34;&gt;Log  de  paquetes en nftales&lt;/h2&gt;

&lt;p&gt;Para poder hacer un log de paquetes completo en &lt;strong&gt;nftables&lt;/strong&gt;, necesitamos una versión mayor o igual a la 3.17, si se usa un kernel menor, se puede usar el siguiente comando para  permitir  el log:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;modprobe iptLOG&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para  usar el log de paquetes  hacemos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule nombreTabla nombreCadena &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;operadores&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; log&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Y el mismo ejemplo que usamos en &lt;strong&gt;iptables&lt;/strong&gt;  para  el login de conexiones ssh.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule filter input  tcp dport  &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt; ct state  new log prefix &lt;span class=&#34;s2&#34;&gt;&amp;#34;Nueva conexión ssh&amp;#34;&lt;/span&gt; accept&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;nat-en-nftables&#34;&gt;NAT en nftables&lt;/h2&gt;

&lt;p&gt;Como en &lt;strong&gt;iptables&lt;/strong&gt;,  &lt;strong&gt;nftables&lt;/strong&gt;  también puede hacer nat  y de manera  más simple por su sintaxis,  de nuevo, distinguimos entre SNAT (source nat)  y DNAT (destination nat).&lt;/p&gt;

&lt;h2 id=&#34;snat-en-nftables&#34;&gt;SNAT en nftables&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;  /proc/sys/net/ipv4/ipForward&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Hecho esto, debemos hacer:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add table nat
nft add chain nat  prerouting   &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; nat  hook prerouting  priority  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
nft add chain nat  postrouting   &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; nat  hook postrouting  priority  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Con  esto  hemos  creado  la  tabla nat  con  las  cadenas  base  prerouting  y  postrouting (creamos  las 2 para  el ejemplo de snat  y dnat,  aunque  no es necesario si solo se implementa  uno de los casos).&lt;/p&gt;

&lt;p&gt;Un ejemplo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule nat  postrouting  ip saddr &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 oif wlan0 snat  &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt;.8.8.8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;De esta  manera,  si nuestro  host  es un router  que está  conectado  a la red indicada  los host que tengan  configurada  como gateway  nuestro  host,  cambiará 8.8.8.8 de los paquetes  que salgan  de nuestra  red.&lt;/p&gt;

&lt;h2 id=&#34;dnat-en-nftables&#34;&gt;DNAT en nftables&lt;/h2&gt;

&lt;p&gt;Para  hacer  dnat,  si tenemos  algún servidor  web en nuestra  red y queremos que sea accesible desde el exterior  si se está usando nat,  debemos de seguir el mismo formato que en el anterior  caso, y bastaría con lo siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule nat  prerouting  iif wlan0 tcp dport  &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; dnat  &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;De esta manera, se podrá acceder al servidor web desde el exterior de nuestra  red.  Cabe decir que &lt;strong&gt;nftables&lt;/strong&gt; nos permite  hacer tambien un set de puertos para un mismo destino.&lt;/p&gt;

&lt;h1 id=&#34;ejemplos-de-nftables&#34;&gt;Ejemplos de nftables&lt;/h1&gt;

&lt;p&gt;Para  terminar  podemos exponer un uso práctico de &lt;strong&gt;nftables&lt;/strong&gt; en una red, el problema es:&lt;/p&gt;

&lt;p&gt;Tenemos una empresa, en la cual tenemos 3 subredes: 192.168.1.0/24, 192.168.2.0/24 y 192.168.3.0/24.&lt;/p&gt;

&lt;p&gt;Para la red 192.168.1.0/24 tenemos los requisitos siguientes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Esta compuesta por 2 servidores, uno web (192.168.1.2)y otro ftp (192.168.12), en los cuales se debe implementar  nat.&lt;/li&gt;
&lt;li&gt;Los servidores SOLO deben de escuchar/responder peticiones, jamás hacerlas hacia el exterior.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Para  red 192.168.2.0/24 tenemos los siguientes requisitos:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Esta  formada  por trabajadores de la empresa,  por tanto  pueden  acceder hacia el exterior.&lt;/li&gt;
&lt;li&gt;No se permite  el uso de ciertas páginas web (facebook y twitter).&lt;/li&gt;
&lt;li&gt;No pueden recibir peticiones del exterior..&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Para  la red 192.168.3.0/24 tenemos los siguientes requisitos:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Esta  formada  por  equipos en pruebas,  por  tanto solo pueden  tener  acceso entre  ellos y nunca  pueden  recibir  peticiones  desde el exterior  ni tampoco acceder a este.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Para  la red 192.168.1.0/24:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule nat prerouting  ip daddr &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.2 tcp dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; dnat &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.2
nft add rule nat prerouting  ip daddr &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.3 tcp dport &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt; dnat &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para  la red 192.168.2.0/24:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft  add  rule  filter  input  ip saddr  &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.2.0/24  ct  state  new,  established accept
nft add rule filter input  ip daddr  &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.2.0/24 ct state  new drop
&lt;span class=&#34;c1&#34;&gt;# (Suponiendo  facebook.es - 8.8.8.8 y twitter.es - 8.8.8.4)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;nft add rule filter input  ip saddr &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.2.0/24 ip daddr  &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt;.8.8.8, &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt;.8.8.4 drop&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para  la red 192.168.3.0/24:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;nft add rule filter input  ip saddr &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.3.0/24 drop
nft add rule filter input  ip daddr  &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.3.0/24 drop&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;conclusiones&#34;&gt;Conclusiones&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;nftables&lt;/strong&gt; es un framework que su finalidad es eliminar o solventar problemas de &lt;strong&gt;iptables&lt;/strong&gt; remplazándolo, presenta una mejora en la sintaxis, las tablas y las cadenas son completamente configurables dando una flexibilidad al usuario para que defina sola las reglas que se vayan a utilizar. Ipv4 y Ipv6 se pueden utilizar en una sola tabla simplificando la administración.&lt;/p&gt;

&lt;p&gt;Se pueden especificar diferentes acciones en una sola regla lo cual nos permite el ahorro de tiempo y creación de reglas engorrosas como se solía hacer con &lt;strong&gt;iptables&lt;/strong&gt;, además soportara nuevos protocolos sin la necesidad de hacer una actualización del kernel.&lt;/p&gt;

&lt;p&gt;Como podemos analizar &lt;strong&gt;nftables&lt;/strong&gt; nos proporciona  numerosas ventajas y soluciones de problemas en la clasificación de paquetes sin embargo hay que tener en mente que aún esta en desarrollo.&lt;/p&gt;</description>
        </item>
        
        <item>
            <title>20 ejemplos de iptables para SysAdmins novatos</title>
            <link>https://elbauldelprogramador.com/20-ejemplos-de-iptables-para-sysadmins/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/20-ejemplos-de-iptables-para-sysadmins/</guid>
            <description>&lt;p&gt;Linux por defecto trae un cortafuegos llamado NetFilter. Según el sitio oficil de proyecto:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;netfiltes es un conjunto de hooks (Ganchos) dentro del kernel de linux que permiten a los módulos del kernel registrar funciones callbacks con la pila de red. Una función callback registrada se llama entonces para cada paquete que atraviesa el hook correspondiente dentro de la pila de red.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Este firewall lo controla un programa llamado iptables que gestiona el filtrado para IPv4, y ip6tables para IPv6.&lt;/p&gt;

&lt;h1 id=&#34;ejemplos-de-reglas-iptables&#34;&gt;Ejemplos de reglas IPTABLES&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Muchas de las acciones que se listan abajo requieren ejecutarse como usuario root.&lt;/li&gt;
&lt;li&gt;Los siguientes comandos deberían funcionar en cualquier distro linux moderna.&lt;/li&gt;
&lt;li&gt;Esto NO es un tutorial de como configurar iptables. Puedes ver un tutorial &lt;a target=&#34;_blank&#34; href=&#34;http://www.cyberciti.biz/faq/rhel-fedorta-linux-iptables-firewall-configuration-tutorial/&#34;&gt;aquí&lt;/a&gt;. Es más bien una referencia rápida de los comandos más comunes de iptables.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;h1 id=&#34;1-mostrando-el-estado-de-nuestro-firewall&#34;&gt;#1: Mostrando el estado de nuestro firewall&lt;/h1&gt;

&lt;p&gt;Teclea el siguiente comando como root:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -L -n -v&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ejemplos de salidas:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
Chain FORWARD &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;El resultado de arriba indica que el firewall no está activo. La siguiente salida es la del firewall activado:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy DROP &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; DROP       all  --  *      *       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state INVALID
  &lt;span class=&#34;m&#34;&gt;394&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;43586&lt;/span&gt; ACCEPT     all  --  *      *       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state RELATED,ESTABLISHED
   &lt;span class=&#34;m&#34;&gt;93&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17292&lt;/span&gt; ACCEPT     all  --  br0    *       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;142&lt;/span&gt; ACCEPT     all  --  lo     *       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
Chain FORWARD &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy DROP &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ACCEPT     all  --  br0    br0     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; DROP       all  --  *      *       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state INVALID
    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; TCPMSS     tcp  --  *      *       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           tcp flags:0x06/0x02 TCPMSS clamp to PMTU
    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ACCEPT     all  --  *      *       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state RELATED,ESTABLISHED
    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; wanin      all  --  vlan2  *       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; wanout     all  --  *      vlan2   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ACCEPT     all  --  br0    *       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;425&lt;/span&gt; packets, 113K bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
Chain wanin &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
Chain wanout &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
 pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Donde,&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;-L&lt;/strong&gt; : Muestra las reglas.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-v&lt;/strong&gt; : Muestra información detallada.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-n&lt;/strong&gt; : Muestra la dirección ip y puerto en formato numérico. No usa DNS para resolver nombres. Esto acelera la lista.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-1-para-inspeccionar-el-firewall-con-número-de-lineas&#34;&gt;#1.1:Para Inspeccionar el firewall con número de lineas:&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -n -L -v --line-numbers&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Salida:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy DROP&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;    DROP       all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state INVALID
&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;    ACCEPT     all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state RELATED,ESTABLISHED
&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;    ACCEPT     all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;    ACCEPT     all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
Chain FORWARD &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy DROP&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;    ACCEPT     all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;    DROP       all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state INVALID
&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;    TCPMSS     tcp  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           tcp flags:0x06/0x02 TCPMSS clamp to PMTU
&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;    ACCEPT     all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state RELATED,ESTABLISHED
&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;    wanin      all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
&lt;span class=&#34;m&#34;&gt;6&lt;/span&gt;    wanout     all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
&lt;span class=&#34;m&#34;&gt;7&lt;/span&gt;    ACCEPT     all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
Chain wanin &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
Chain wanout &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Podemos usar los números de línea para borrar o añadir nuevas reglas al firewall.&lt;/p&gt;

&lt;h2 id=&#34;1-2-mostrar-las-reglas-de-cadena-de-entrada-y-salida&#34;&gt;#1.2: Mostrar las reglas de cadena de entrada y salida:&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -L INPUT -n -v
iptables -L OUTPUT -n -v --line-numbers&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;2-parar-iniciar-reiniciar-el-firewall&#34;&gt;#2: Parar / Iniciar / Reiniciar el firewall&lt;/h1&gt;

&lt;p&gt;Si usas CentOS / RHEL / Fedora linux:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;service iptables stop
service iptables start
service iptables restart&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;También se puede usar propio comando iptables para detenerlo y borrar todas las reglas.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -F
iptables -X
iptables -t nat -F
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X
iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Donde:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;-F&lt;/strong&gt; : Borra todas las reglas.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-X&lt;/strong&gt; : Borra cadenas&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-t table_name&lt;/strong&gt; : Selecciona una tabla y elimina reglas&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-P&lt;/strong&gt; : Establece la política por defecto (como DROP, REJECT o ACCEPT)&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;3-borrar-reglas-del-firewall&#34;&gt;#3: Borrar reglas del firewall&lt;/h1&gt;

&lt;p&gt;Para mostrar los números de línea junto a otra información para reglas existentes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -L INPUT -n --line-numbers
iptables -L OUTPUT -n --line-numbers
iptables -L OUTPUT -n --line-numbers &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; less
iptables -L OUTPUT -n --line-numbers &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep &lt;span class=&#34;m&#34;&gt;202&lt;/span&gt;.54.1.1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Obtendrendremos la lista de IPs. Miramos el número de la izquierda y lo usamos para borrarla. Por ejemplo para borrar la línea 4:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -D INPUT &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;O para encontrar una ip de origen y borrarla de la regla&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -D INPUT -s &lt;span class=&#34;m&#34;&gt;202&lt;/span&gt;.54.1.1 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Donde:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;-D&lt;/strong&gt; : Elimina una o más reglas de la cadena seleccionada.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;4-insertar-reglas&#34;&gt;#4: Insertar reglas:&lt;/h1&gt;

&lt;p&gt;Para insertar una o más reglas en la cadena seleccionada como el número de cadena dada usamos la siguiente sintaxis. Primero encontramos el número de línea:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -L INPUT -n --line-numbers&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Salida:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy DROP&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;    DROP       all  --  &lt;span class=&#34;m&#34;&gt;202&lt;/span&gt;.54.1.1           &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;    ACCEPT     all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state NEW,ESTABLISHED&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para insertar una regla entre 1 y 2;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -I INPUT &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; -s &lt;span class=&#34;m&#34;&gt;202&lt;/span&gt;.54.1.2 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para ver las reglas actualizadas&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -L INPUT -n --line-numbers&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Salida:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy DROP&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;    DROP       all  --  &lt;span class=&#34;m&#34;&gt;202&lt;/span&gt;.54.1.1           &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;    DROP       all  --  &lt;span class=&#34;m&#34;&gt;202&lt;/span&gt;.54.1.2           &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0
&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;    ACCEPT     all  --  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0/0           state NEW,ESTABLISHED&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;5-guardar-reglas&#34;&gt;#5: Guardar reglas&lt;/h1&gt;

&lt;p&gt;Para guardar reglas en CentOS / RHEL / Fedora Linux:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;service iptables save&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;En este ejemplo, eliminamos una ip y guardamos las reglas del firewall:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;202&lt;/span&gt;.5.4.1 -j DROP
service iptables save&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para todas las dem��s distros usamos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables-save &amp;gt; /root/my.active.firewall.rules
cat /root/my.active.firewall.rules&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;6-restaurar-reglas&#34;&gt;#6: Restaurar reglas&lt;/h1&gt;

&lt;p&gt;Para restaurar reglas desde un archivo llamado /root/my.active.firewall.rules:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables-restore &amp;lt; /root/my.active.firewall.rules&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Bajo CentOS / RHEL / Fedora Linux:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;service iptables restart&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;7-estableces-políticas-de-firewall-por-defecto&#34;&gt;#7: Estableces políticas de firewall por defecto&lt;/h1&gt;

&lt;p&gt;Para borrar todo el tráfico:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP
iptables -L -v -n
&lt;span class=&#34;c1&#34;&gt;## you will not able to connect anywhere as all traffic is dropped ###
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;ping cyberciti.biz
wget http://www.kernel.org/pub/linux/kernel/v3.0/testing/linux-3.2-rc5.tar.bz2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;7-1-solo-tráfico-entrante-bloqueado&#34;&gt;#7.1: Solo tráfico entrante bloqueado&lt;/h2&gt;

&lt;p&gt;Para borrar todos los paquetes entrantes / enviados pero permitir el tráfico saliente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT
iptables -A INPUT -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -L -v -n
&lt;span class=&#34;c1&#34;&gt;# *** now ping and wget should work *** ###
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;ping cyberciti.biz
wget http://www.kernel.org/pub/linux/kernel/v3.0/testing/linux-3.2-rc5.tar.bz2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;8-borrar-direcciones-de-red-privadas-en-la-interfaz-pública&#34;&gt;#8: Borrar direcciones de red privadas en la interfaz pública&lt;/h1&gt;

&lt;p&gt;IP Spoofing es nada más que para detener los siguientes rangos de direcciones IPv4 para redes privadas en sus interfaces públicas. Los paquetes con direcciones de origen no enrutables deben rechazarse mediante la siguiente sintaxis:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -i eth1 -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.0.0/24 -j DROP
iptables -A INPUT -i eth1 -s &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;.0.0.0/8 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;9-bloqueando-una-direción-ip-block-ip&#34;&gt;#9: Bloqueando una direción IP (BLOCK IP)&lt;/h1&gt;

&lt;p&gt;PAra bloquear una ip atacante llamada 1.2.3.4:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.2.3.4 -j DROP
iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.0.0/24 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;10-bloquear-peticiones-entrantes-de-un-puerto-block-port&#34;&gt;#10: Bloquear peticiones entrantes de un puerto (BLOCK PORT)&lt;/h1&gt;

&lt;p&gt;Para bloquear todas las solicitudes de servicio en el puerto 80:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -p tcp --dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j DROP
iptables -A INPUT -i eth1 -p tcp --dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para bloquear el puerto 80 para una ip:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -p tcp -s &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.2.3.4 --dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j DROP
iptables -A INPUT -i eth1 -p tcp -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 --dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;11-bloquear-ips-de-salida&#34;&gt;#11: Bloquear ips de salida&lt;/h1&gt;

&lt;p&gt;Para bloquear el tráfico saliente a un host o dominio en concreto como por ejemplo cyberciti.biz:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;host -t a cyberciti.biz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Salida:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cyberciti.biz has address &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt;.126.153.206&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Una vez conocida la dirección ip, bloqueamos todo el tráfico saliente para dicha ip así:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A OUTPUT -d &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt;.126.153.206 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Se puede usar una subred como la siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A OUTPUT -d &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -j DROP
iptables -A OUTPUT -o eth1 -d &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;11-1-ejemplo-bloquear-el-dominio-facebook-com&#34;&gt;#11.1: Ejemplo - Bloquear el dominio facebook.com&lt;/h2&gt;

&lt;p&gt;Primero, encontrar la dirección ip de facebook.com&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;host -t a www.facebook.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Salida:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;www.facebook.com has address &lt;span class=&#34;m&#34;&gt;69&lt;/span&gt;.171.228.40&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Buscar el CIDR para 69.171.228.40:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;whois &lt;span class=&#34;m&#34;&gt;69&lt;/span&gt;.171.228.40 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep CIDR&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Salida:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;CIDR:           &lt;span class=&#34;m&#34;&gt;69&lt;/span&gt;.171.224.0/19&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para prevenir el acceso externo a facebook.com:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A OUTPUT -p tcp -d &lt;span class=&#34;m&#34;&gt;69&lt;/span&gt;.171.224.0/19 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Podemos usar también nombres de dominio:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A OUTPUT -p tcp -d www.facebook.com -j DROP
iptables -A OUTPUT -p tcp -d facebook.com -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;De la página del man de iptables:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;hellip; specifying any name to be resolved with a remote query such as DNS (e.g., facebook.com is a really bad idea), a network IP address (with /mask), or a plain IP address &amp;hellip;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;12-log-y-borrar-paquetes&#34;&gt;#12: Log y borrar paquetes&lt;/h1&gt;

&lt;p&gt;Escribe lo siguiente para añadir al log y bloquear IP spoofing en una interfaz pública llamada eth1&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -i eth1 -s &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;.0.0.0/8 -j LOG --log-prefix &lt;span class=&#34;s2&#34;&gt;&amp;#34;IP_SPOOF A: &amp;#34;&lt;/span&gt;
iptables -A INPUT -i eth1 -s &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;.0.0.0/8 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Por defecto el log está en el archivo /var/log/messages&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;tail -f /var/log/messages
grep --color &lt;span class=&#34;s1&#34;&gt;&amp;#39;IP SPOOF&amp;#39;&lt;/span&gt; /var/log/messages&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;13-log-y-borrar-paquetes-con-un-número-limitado-de-entradas-al-log&#34;&gt;#13: Log y borrar paquetes con un número limitado de entradas al log&lt;/h1&gt;

&lt;p&gt;El módulo -m limit puede limitar el número de entradas al log creadas por tiempo. Se usa para prevenir que el archivo de log se inunde. Para añadir al log y elminar spoofing cada 5 minutos, en ráfagas de 7 entradas:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -i eth1 -s &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;.0.0.0/8 -m limit --limit &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;/m --limit-burst &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; -j LOG --log-prefix &lt;span class=&#34;s2&#34;&gt;&amp;#34;IP_SPOOF A: &amp;#34;&lt;/span&gt;
iptables -A INPUT -i eth1 -s &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;.0.0.0/8 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;14-aceptar-o-denegar-tráfico-desde-dirección-mac&#34;&gt;#14: Aceptar o denegar tráfico desde dirección MAC&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -m mac --mac-source &lt;span class=&#34;m&#34;&gt;00&lt;/span&gt;:0F:EA:91:04:08 -j DROP
&lt;span class=&#34;c1&#34;&gt;## *only accept traffic for TCP port # 8080 from mac 00:0F:EA:91:04:07 * ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -p tcp --destination-port &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt; -m mac --mac-source &lt;span class=&#34;m&#34;&gt;00&lt;/span&gt;:0F:EA:91:04:07 -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;15-bloquear-o-permitir-peticiones-ping-icmp&#34;&gt;#15: Bloquear o permitir peticiones ping ICMP&lt;/h1&gt;

&lt;p&gt;Para bloquear peticiones ping ICMP&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -p icmp --icmp-type echo-request -j DROP
iptables -A INPUT -i eth1 -p icmp --icmp-type echo-request -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Las respuestas al ping también se puede limitar a ciertas redes o hosts.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -p icmp --icmp-type echo-request -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Lo siguiente solo acepta limitados tipos de peticiones ICMP:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;### ** assumed that default INPUT policy set to DROP ** #############
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT
iptables -A INPUT -p icmp --icmp-type destination-unreachable -j ACCEPT
iptables -A INPUT -p icmp --icmp-type time-exceeded -j ACCEPT
&lt;span class=&#34;c1&#34;&gt;## ** all our server to respond to pings ** ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;16-abrir-un-rango-de-puertos&#34;&gt;#16: Abrir un rango de puertos&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport &lt;span class=&#34;m&#34;&gt;7000&lt;/span&gt;:7010 -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;17-abrir-un-rango-de-direcciones-ip&#34;&gt;#17: Abrir un rango de direcciones ip&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## only accept connection to tcp port 80 (Apache) if ip is between 192.168.1.100 and 192.168.1.200 ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -p tcp --destination-port &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -m iprange --src-range &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.100-192.168.1.200 -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## nat example ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -t nat -A POSTROUTING -j SNAT --to-source &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.20-192.168.1.25&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;19-bloquear-o-abrir-puertos-comunes&#34;&gt;#19: Bloquear o abrir puertos comunes&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Replace ACCEPT with DROP to block port:

&lt;span class=&#34;c1&#34;&gt;## open port ssh tcp port 22 ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt; -j ACCEPT
iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;## open cups (printing service) udp/tcp port 631 for LAN users ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -p udp -m udp --dport &lt;span class=&#34;m&#34;&gt;631&lt;/span&gt; -j ACCEPT
iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -p tcp -m tcp --dport &lt;span class=&#34;m&#34;&gt;631&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;## allow time sync via NTP for lan users (open udp port 123) ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -m state --state NEW -p udp --dport &lt;span class=&#34;m&#34;&gt;123&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;## open tcp port 25 (smtp) for all ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;# open dns server ports for all ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -m state --state NEW -p udp --dport &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt; -j ACCEPT
iptables -A INPUT -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;## open http/https (Apache) server port to all ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j ACCEPT
iptables -A INPUT -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;## open tcp port 110 (pop3) for all ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;110&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;## open tcp port 143 (imap) for all ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;143&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;## open access to Samba file server for lan users only ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;137&lt;/span&gt; -j ACCEPT
iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;138&lt;/span&gt; -j ACCEPT
iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;139&lt;/span&gt; -j ACCEPT
iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;## open access to proxy server for lan users only ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.1.0/24 -m state --state NEW -p tcp --dport &lt;span class=&#34;m&#34;&gt;3128&lt;/span&gt; -j ACCEPT

&lt;span class=&#34;c1&#34;&gt;## open access to mysql server for lan users only ##
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;iptables -I INPUT -p tcp --dport &lt;span class=&#34;m&#34;&gt;3306&lt;/span&gt; -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;20-restringir-el-número-de-conexiones-paralelas-a-un-servidor-por-direccion-ip-del-cliente&#34;&gt;#20: Restringir el número de conexiones paralelas a un servidor por direccion Ip del cliente.&lt;/h1&gt;

&lt;p&gt;Se puede usar connlimit para crear algunas restricciones. Para permitir 3 conexiones ssh por cliente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -p tcp --syn --dport &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt; -m connlimit --connlimit-above &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; -j REJECT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Establecer las peticiones HTTP a 20:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -p tcp --syn --dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -m connlimit --connlimit-above &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; --connlimit-mask &lt;span class=&#34;m&#34;&gt;24&lt;/span&gt; -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;donde:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&amp;ndash;connlimit-above 3&lt;/strong&gt; : Coincide si el número de conexiones existentes está por encima de 3.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&amp;ndash;connlimit-mask 24&lt;/strong&gt; : Grupos de hosts usando el prefijo de longitud. Para IPv4, debe ser un número entre 0 y 32 (incluyéndolos.)&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;21-howto-use-iptables-like-a-pro&#34;&gt;#21: HowTO: Use iptables Like a Pro&lt;/h1&gt;

&lt;p&gt;Para más información sobre iptables, échale un vistazo al manual:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;man iptables&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para ver la ayuda en general o de un comando específico:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -h
iptables -j DROP -h&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;21-1-probando-nuestro-firewall&#34;&gt;#21.1: Probando nuestro firewall&lt;/h2&gt;

&lt;p&gt;Conocer si hay puertos abiertos o no:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;netstat -tulpn&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Es recomendable instalarse un &lt;a href=&#34;https://elbauldelprogramador.com/esnifando-la-red-pruebas-de-seguridad&#34;&gt;sniffer&lt;/a&gt; como tcpdupm y ngrep para probar la configuración de nuestro firewall.&lt;/p&gt;

&lt;h1 id=&#34;conclusión&#34;&gt;Conclusión&lt;/h1&gt;

&lt;blockquote&gt;
&lt;p&gt;Esta entrada solo lista las reglas básicas para los usuarios nuevos en linux. Se pueden crear reglas más complejas. Requiere una buena comprensión de TCP/IP, tunning del kernel linux via sysctl.conf y un buen conocimiento de nuestra configuración.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Fuente original: &lt;a target=&#34;_blank&#34; href=&#34;http://www.cyberciti.biz/tips/linux-iptables-examples.html&#34;&gt;cyberciti&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&#34;más-reglas-cortesía-de-jker&#34;&gt;Más reglas cortesía de Jker&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Reestablece las reglas por defecto.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;sudo su
iptables -F
iptables -t nat -F
iptables -t mangle -F
iptables -X&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;IPtables -nL para ver que estan vacias&lt;/p&gt;

&lt;h2 id=&#34;configura-la-máquina-para-que-sólo-se-pueda-acceder-desde-ella-a-las-webs-http-www-google-es-y-http-www-iesgoya-com-y-a-ninguna-otra&#34;&gt;Configura la máquina para que sólo se pueda acceder desde ella a las webs &lt;a href=&#34;http://www.google.es&#34;&gt;http://www.google.es&lt;/a&gt; y &lt;a href=&#34;http://www.iesgoya.com&#34;&gt;http://www.iesgoya.com&lt;/a&gt; y a ninguna otra.&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A OUTPUT -d http://www.google.es -j ACCEPT
iptables -A OUTPUT -d http://www.iesgoya.com -j ACCEPT
iptables -A OUTPUT -p tcp –dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j DROP # Mas exigente –&amp;gt; iptables -A OUTPUT -p all -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;como-google-tiene-muchas-ips-puede-que-tengamos-un-problema-para-ello-realizamos-lo-siguiente-antes-de-la-regla-exigente&#34;&gt;Como google tiene muchas IPs puede que tengamos un problema para ello realizamos lo siguiente antes de la regla EXIGENTE:&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -I OUTPUT &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -d &lt;span class=&#34;m&#34;&gt;212&lt;/span&gt;.106.221.0/24 -j ACCEPT
iptables -I OUTPUT &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -d &lt;span class=&#34;m&#34;&gt;173&lt;/span&gt;.194.0.0/16 -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;mostrar-las-reglas-que-llevamos-hasta-el-momento&#34;&gt;Mostrar las reglas que llevamos hasta el momento:&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -nL –line-numbers&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;si-queremos-borrar-reglas&#34;&gt;Si queremos borrar reglas:&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -D OUTPUT &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;cierra-todos-los-puertos-bien-conocidos-menos-los-necesarios-para-acceder-a-estas-dos-webs&#34;&gt;Cierra todos los puertos bien conocidos menos los necesarios para acceder a estas dos webs.&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A OUTPUT -p TCP –dport &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt; -j ACCEPT
iptables -A OUTPUT -p UDP –dport &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt; -j ACCEPT
iptables -A OUTPUT -p TCP –dport &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;:1024 -j DROP
iptables -A OUTPUT -p UDP –dport &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;:1024 -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;investiga-de-qué-forma-podrías-hacer-que-las-peticiones-entrantes-a-tu-máquina-virtual-al-puerto-81-por-http-vayan-mediante-nat-al-puerto-80-de-la-máquina-local-arranca-wamp-para-comprobar-que-funciona&#34;&gt;Investiga de qué forma podrías hacer que las peticiones entrantes a tu máquina virtual al puerto 81 por http vayan mediante NAT al puerto 80 de la máquina local (arranca WAMP para comprobar que funciona).&lt;/h2&gt;

&lt;p&gt;Arrancamos wamp en la maquina fisica y comprobamos que accedemos a wamp desde localhost.Comprobamos que podemos acceder desde la maquina virtual y se encuentra cortado&lt;/p&gt;

&lt;p&gt;Miramos la IP de la maquina virtual. Ahora desde la maquina fisica intentamos acceder desde el puerto 81 con la IP esa.&lt;/p&gt;

&lt;p&gt;Habilitamos el enrutamiento entre tarjetas de red de nuestro equipo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/ip_forward&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ejecutamos las siguientes reglas&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -t nat -A PREROUTING -p tcp –dport &lt;span class=&#34;m&#34;&gt;81&lt;/span&gt; -j DNAT –to- destination &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.203.200:80

iptables -t nat -A POSTROUTING -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.203.0/24 -j MASQUERADE&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;para-ver-las-reglas-introducidas&#34;&gt;Para ver las reglas introducidas:&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -t nat -nL –line-numbers&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;permite-sólo-los-mensajes-entrantes-desde-la-ip-del-compañero-de-tu-máquina-física-prueba-desde-otro-sitio-para-ver-si-funciona&#34;&gt;Permite sólo los mensajes entrantes desde la IP del compañero de tu máquina física (prueba desde otro sitio para ver si funciona).&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -A INPUT -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.203.200 -j ACCEPT
iptables -A INPUT -j DROP

iptables -A FORWARD -s &lt;span class=&#34;m&#34;&gt;192&lt;/span&gt;.168.203.200 -j ACCEPT
iptables -A FORWARD -s -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;activa-el-log-sobre-todas-las-reglas-y-verifica-que-se-anotan-los-mensajes&#34;&gt;Activa el log sobre todas las reglas y verifica que se anotan los mensajes.&lt;/h2&gt;

&lt;p&gt;Insertamos en IPTABLEs las reglas para activar el log:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -I FORWARD &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -j LOG –log-prefix ‘IPTABLESFORWARD: ‘
iptables -I INPUT &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -j LOG –log-prefix ‘IPTABLESINPUT: ‘

iptables -t nat -I PREROUTING &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -j LOG –log-prefix ‘IPTABLESPREROUTING: ‘
iptables -t nat -I POSTROUTING &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -j LOG –log-prefix ‘IPTABLESPREROUTING: ‘

iptables -I OUTPUT &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -j LOG –log-prefix ‘IPTABLESOUTPUT: ‘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;NOTA: hay que ponerlas las primeras para que haga log antes de rechazarlo.&lt;/p&gt;

&lt;p&gt;Ahora editamos el archivo:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;gedit /etc/rsyslog.d/50-default.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;E incluimos al final:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kern.warning /var/log/iptables.log&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        
        <item>
            <title>Bloquear una IP atacando el servidor mediante iptables</title>
            <link>https://elbauldelprogramador.com/bloquear-una-ip-atacanto-el-servidor-mediante-iptables/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/bloquear-una-ip-atacanto-el-servidor-mediante-iptables/</guid>
            <description>&lt;figure&gt;
    &lt;img sizes=&#34;(min-width: 256px) 256px, 100vw&#34; on=&#34;tap:lightbox1&#34; role=&#34;button&#34; tabindex=&#34;0&#34; layout=&#34;responsive&#34; src=&#34;https://elbauldelprogramador.com/img/2013/02/Applic-Firewall-icon.png&#34; alt=&#34;Applic-Firewall-icon&#34; width=&#34;256px&#34; height=&#34;256px&#34; /&gt;
&lt;/figure&gt;

&lt;p&gt;Ayer ojeando el archivo de log detecté que había una ip mandando peticiones POST indiscriminadamente a la página de login del blog y decidí investigar un poco.&lt;/p&gt;

&lt;p&gt;Por la frecuencia con las que se realizaban las peticiones debía ser un ataque automatizado, y probaba cadenas de texto aleatorias, lo primero que hice fué bloquear a dicha ip cualquier intento de conexión al servidor mediante &lt;a href=&#34;https://elbauldelprogramador.com/?s=iptables&#34;&gt;iptables&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Además de bloquearlo, añadí una regla a las directivas de iptables para que quedara registrado en el log cada intento de conexión. Las reglas en cuestión son las siguientes:&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -i ethX -A INPUT -s xx.xx.xx.xx -j LOG --log-prefix &lt;span class=&#34;s2&#34;&gt;&amp;#34;IP DROP SPOOF A:&amp;#34;&lt;/span&gt;
iptables -i ethX -A INPUT -s xx.xx.xx.xx -j DROP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Estas directivas bloquean el tráfico entrante hacia la interfaz &lt;em&gt;ethX&lt;/em&gt; a la dirección especificada tras el parámetro &lt;em&gt;-s&lt;/em&gt;, además, en las entradas del log aparecerá como &lt;strong&gt;IP DROP SPOOF A:&lt;/strong&gt; cada vez que el firewall bloquee el intento de conexión.&lt;/p&gt;

&lt;p&gt;El primer comando es el que define cómo se registrará en el log, el segundo es el que bloquea la dirección.&lt;/p&gt;

&lt;p&gt;Para comprobar que efectivamente se está bloqueando al atacante, basta con mirar al log:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Feb  &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;02&lt;/span&gt;:15:30 NOMBRESERVIDOR kernel: IP DROP SPOOF A:IN&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ethX &lt;span class=&#34;nv&#34;&gt;OUT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;MAC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX &lt;span class=&#34;nv&#34;&gt;SRC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;IPBLOQUEADA &lt;span class=&#34;nv&#34;&gt;DST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;IPSERVIDOR &lt;span class=&#34;nv&#34;&gt;LEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;LONGITUDPAQUETE &lt;span class=&#34;nv&#34;&gt;TOS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0x00 &lt;span class=&#34;nv&#34;&gt;PREC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0x00 &lt;span class=&#34;nv&#34;&gt;TTL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;117&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15234&lt;/span&gt; DF &lt;span class=&#34;nv&#34;&gt;PROTO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;TCP &lt;span class=&#34;nv&#34;&gt;SPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;17652&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;DPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;PUERTODESTINO &lt;span class=&#34;nv&#34;&gt;WINDOW&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;RES&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0x00 SYN &lt;span class=&#34;nv&#34;&gt;URGP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Decidí investigar desde cuando se estaba produciendo el ataque, y, para mi sorpresa, se estaba intentando acceder por fuerza bruta al blog desde hacía 8 días. Concretamente, hubo &lt;strong&gt;18209&lt;/strong&gt; intentos de conexión. Este número puede sacarse fácilmente contando las líneas del log en las que estaba involucrada la ip atacante:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;cat /ruta/log/acceso.log &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep xx.xx.xx.xx &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; wc -l&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Donde &lt;strong&gt;xx.xx.xx.xx&lt;/strong&gt; debe ser la ip del atacante. El comando wc con el parámetro -l es el encargado de contar las líneas.&lt;/p&gt;

&lt;p&gt;En las referencias puedes encontrar más información sobre iptables. También puedes leer los &lt;strong&gt;&lt;a href=&#34;https://elbauldelprogramador.com/20-ejemplos-de-iptables-para-sysadmins/&#34;&gt;20 ejemplos de iptables para SysAdmins novatos&lt;/a&gt;&lt;/strong&gt; o &lt;a href=&#34;https://elbauldelprogramador.com/bloquear-ataques-de-fuerza-bruta-en-nginx-y-wordpress-con-fail2ban/&#34; title=&#34;Bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban&#34;&gt;Bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&#34;referencias&#34;&gt;Referencias&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Iptables Drop IP Address&lt;/em&gt; »» &lt;a href=&#34;http://www.cyberciti.biz/faq/linux-iptables-drop/&#34; target=&#34;_blank&#34;&gt;Visitar sitio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
        <item>
            <title>Combatir los comentarios de spam en WordPress</title>
            <link>https://elbauldelprogramador.com/combatir-los-comentarios-de-spam-en-wordpress/</link>
            <pubDate>Fri, 01 Jan 2016 00:00:00 +0000</pubDate>
            
            <guid>https://elbauldelprogramador.com/combatir-los-comentarios-de-spam-en-wordpress/</guid>
            <description>&lt;figure&gt;
        &lt;a href=&#34;https://elbauldelprogramador.com/img/2013/11/Bloquear-ataques-de-fuerza-bruta-en-Nginx-y-Wordpress-con-Fail2Ban2.png&#34;&gt;
          &lt;img
            on=&#34;tap:lightbox1&#34;
            role=&#34;button&#34;
            tabindex=&#34;0&#34;
            layout=&#34;responsive&#34;
            src=&#34;https://elbauldelprogramador.com/img/2013/11/Bloquear-ataques-de-fuerza-bruta-en-Nginx-y-Wordpress-con-Fail2Ban2.png&#34;
            alt=&#34;Combatir los comentarios de spam en Wordpress&#34;
            title=&#34;Combatir los comentarios de spam en Wordpress&#34;
            sizes=&#34;(min-width: 600px) 600px, 100vw&#34;
            width=&#34;600&#34;
            height=&#34;600&#34;&gt;
          &lt;/img&gt;
        &lt;/a&gt;
        &lt;figcaption&gt;Combatir los comentarios de spam en Wordpress&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Los comentarios de spam son algo frecuente en internet, y WordPress no es una excepción. Hace poco vimos cómo &lt;a href=&#34;https://elbauldelprogramador.com/bloquear-ataques-de-fuerza-bruta-en-nginx-y-wordpress-con-fail2ban/&#34; title=&#34;Bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban&#34;&gt;bloquear ataques de fuerza bruta en Nginx y WordPress con Fail2Ban&lt;/a&gt;. Hoy veremos cómo evitar que se nos inunde la cola de comentarios pendientes o de spam, en mi caso rondan los 200-300 comentarios diarios.&lt;/p&gt;

&lt;p&gt;&lt;!--ad--&gt;&lt;/p&gt;

&lt;p&gt;Existe un plugin llamado &lt;a href=&#34;http://akismet.com/&#34; title=&#34;Plugins Askimet&#34; target=&#34;_blank&#34;&gt;Askimet&lt;/a&gt; que facilita muchísimo la tarea de detectar comentarios de spam y enviarlos a su correspondiente sección en WordPress. Quizá por eso me ha resultado tan sencillo contruir esta solución para bloquear el acceso a todos los bots que continuamente publican comentarios de este tipo.&lt;/p&gt;

&lt;h1 id=&#34;recopilar-las-direcciones-ips-de-los-spammers&#34;&gt;Recopilar las direcciones IPs de los spammers&lt;/h1&gt;

&lt;p&gt;Esto es algo trivial, WordPress siempre muestra la IP desde la que se realiza el comentario. Sin embargo recopilar la dirección de 200 comentarios puede ser una tarea ardua. Será más sencillo extraer esta información de la &lt;a href=&#34;https://elbauldelprogramador.com/bases-de-datos/&#34; title=&#34;Bases de Datos&#34;&gt;base de datos&lt;/a&gt; con una consulta &lt;a href=&#34;https://elbauldelprogramador.com/consulta-de-datos-clausula-select/&#34; title=&#34;Consulta de Datos – Cláusula Select&#34;&gt;SELECT&lt;/a&gt;. La tabla en la que nos interesa realizar la consulta es &lt;strong&gt;wp_comments&lt;/strong&gt;, y el único campo que deseamos extraer es la dirección IP (Columna &lt;strong&gt;comment_author_IP&lt;/strong&gt; de la tabla anterior). Para evitar que se repitan la direcciones IPs usaremos la opción &lt;strong&gt;DISTINC&lt;/strong&gt;. Seleccionaremos únicamente los comentarios que estén marcados como spam, lo cual corresponde a que el campo &lt;strong&gt;comment_approved&lt;/strong&gt; tenga el valor &amp;#8220;&lt;strong&gt;spam&lt;/strong&gt;&amp;#8220;. La consulta quedará así:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DISTINCT&lt;/span&gt;  &lt;span class=&#34;ss&#34;&gt;`comment_author_IP`&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;  &lt;span class=&#34;ss&#34;&gt;`wp_comments`&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;  &lt;span class=&#34;ss&#34;&gt;`comment_approved`&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;s1&#34;&gt;&amp;#39;spam&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Usando &lt;em&gt;phpmyadmin&lt;/em&gt; podremos exportar el resultado a un archivo de texto para tener las IPs almacenadas con el siguiente formato:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;x.x.x.x
y.y.y.y
z.z.z.z
.......&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Almacenarlas así nos facilitará la automatización para bloquearles el acceso.&lt;/p&gt;

&lt;h1 id=&#34;bloquear-el-spam&#34;&gt;Bloquear el spam&lt;/h1&gt;

&lt;p&gt;Una vez tenemos el archivo con las IPs de los spammers, procedemos bloquearlos mediante &lt;a href=&#34;https://elbauldelprogramador.com/20-ejemplos-de-iptables-para-sysadmins/&#34; title=&#34;20 ejemplos de iptables para SysAdmins novatos&#34;&gt;iptables&lt;/a&gt;, de tal forma que no lograrán ni acceder al sitio web, ya que Iptables les denegará el acceso. Usaremos el siguiente &lt;a href=&#34;https://elbauldelprogramador.com/&#34; title=&#34;Scripts del blog&#34;&gt;script&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;inet_if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;eth0

&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$#&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
    &lt;span class=&#34;nv&#34;&gt;esta&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;iptables -nL &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -z &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$esta&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Bloqueado &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
        iptables -i &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;inet_if&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -A INPUT -s &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt; -j LOG --log-prefix &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$2&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &amp;#34;&lt;/span&gt;
        iptables -i &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;inet_if&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -A INPUT -s &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt; -j DROP
    &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Ya está bloqueado&amp;#34;&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$esta&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$0&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &amp;lt;ip&amp;gt; &amp;lt;comentario&amp;gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Tras guardar el script con el nombre deseado, el uso es el siguiente:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;./nombre_script.sh &amp;lt;ip&amp;gt; &amp;lt;mensaje en el log&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Si la IP ya está bloqueada, no se añadirá otra entrada a Iptables, el segundo parámetro aparecerá en los logs del sistema, algo así:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Dec  &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt;:40:36 nombreServidor kernel: &amp;gt;&amp;lt;mensaje en el log&amp;gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;eth0 &lt;span class=&#34;nv&#34;&gt;OUT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;MAC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XXXXXXXXXXXXXX &lt;span class=&#34;nv&#34;&gt;SRC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X.X.X.X &lt;span class=&#34;nv&#34;&gt;DST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Y.Y.Y.Y &lt;span class=&#34;nv&#34;&gt;LEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X &lt;span class=&#34;nv&#34;&gt;TOS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X &lt;span class=&#34;nv&#34;&gt;PREC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X &lt;span class=&#34;nv&#34;&gt;TTL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X &lt;span class=&#34;nv&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X DF &lt;span class=&#34;nv&#34;&gt;PROTO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;TCP &lt;span class=&#34;nv&#34;&gt;SPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XX &lt;span class=&#34;nv&#34;&gt;DPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XX &lt;span class=&#34;nv&#34;&gt;WINDOW&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XXX &lt;span class=&#34;nv&#34;&gt;RES&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;XXX SYN &lt;span class=&#34;nv&#34;&gt;URGP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para automatizar el bloqueo, recorreremos cada una de las líneas del archivo que hemos exportado de la base de datos con las direcciones IPs de los spammers:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;cat spammers.txt&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
   ./nombre_script.sh &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Comentario SPAM&amp;#34;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Y listo, si listamos las reglas de Iptables tendremos algo parecido a esto:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;iptables -L
Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
DROP       all  --  X.X.X.X        anywhere
LOG        all  --  X.X.X.X        anywhere            LOG level warning prefix &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;Comentario SPAM&lt;span class=&#34;s1&#34;&gt;&amp;#39;
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;DROP       all  --  Y.Y.Y.Y        anywhere
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;LOG        all  --  Y.Y.Y.Y        anywhere            LOG level warning prefix `Comentario SPAM&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A partir de ahora, se notará un descenso drástico en los comentarios de spam. Espero que haya servido de ayuda.&lt;/p&gt;</description>
        </item>
        
    </channel>
</rss>
